<html lang="en-US"><head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1"/>

<title>TTM4175</title>
<meta property="og:title" content="TTM4175">
<meta property="og:locale" content="en_US">
<meta name="description" content="Introduction to Communication Technology and Digital Security">
<meta property="og:description" content="Introduction to Communication Technology and Digital Security">


<link rel="stylesheet" href="assets/bootstrap.min.css">
<script src="assets/jquery-3.5.1.min.js"></script>
<script src="assets/bootstrap.min.js"></script>
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.1/css/all.css" integrity="sha384-gfdkjb5BdAXd+lj+gudLWI+BXq4IuLW5IT+brZEZsLFm++aCMlF1V92rMkPaX4PP" crossorigin="anonymous">
<link rel="stylesheet" type="text/css" href="assets/style.css" />
<script src="assets/anchor.js"></script>
<script src="assets/script-aside.js"></script>
</head>
<body id="top">

<nav class="navbar navbar-expand-md navbar-dark " style="background-color:#666666"#2B65EC"> <!-- fixed-top -->
        <ul class="nav nav-pills">
        <li class="nav-item">
    <a class="nav-link" href="index.html" style="font-weight: bold")>TTM4175</a>
  </li>

  <li class="nav-item dropdown">
    <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">Teknostart</a>
    <div class="dropdown-menu">
      <a class="dropdown-item" href="day0-2021.html">Oppstart</a>
      <a class="dropdown-item" href="day2-2021.html">Dag 2</a>
      <a class="dropdown-item" href="day3-2021.html">Dag 3</a>
      <div class="dropdown-divider"></div>
      <a class="dropdown-item" href="day0-2020.html">(2020) Dag 0: Getting Started</a>
      <a class="dropdown-item" href="day1-2020.html">(2020) Dag 1: Virtual Box</a>
      <a class="dropdown-item" href="day2-2020.html">(2020) Dag 2: Linux Command Line</a>
      <a class="dropdown-item" href="day3-2020.html">(2020) Dag 3: SSH and HTML</a>
      <div class="dropdown-divider"></div>
      <a class="dropdown-item" href="tips.html">Tips</a>
    </div>
  </li>
        
  <li class="nav-item dropdown">
    <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">Preparation</a>
    <div class="dropdown-menu">
      <a class="dropdown-item disabled"><strong>Security</strong></a>
      <a class="dropdown-item" href="prep-security-1-2021.html">Security 1</a>
      <a class="dropdown-item" href="prep-security-2-2021.html">Security 2</a>
      <a class="dropdown-item" href="prep-security-3-2021.html">Security 3</a>
      <a class="dropdown-item" href="prep-security-4-2021.html">Security 4</a>
      <a class="dropdown-item" href="prep-security-5-2021.html">Security 5</a>
      <div class="dropdown-divider"></div>
      <a class="dropdown-item disabled"><strong>Networking (2020)</strong></a>
      <a class="dropdown-item" href="prep-networking-1-2020.html">Binary and IP addresses</a>
      <a class="dropdown-item" href="prep-networking-2-2020.html">Layers and Docker</a>
      <a class="dropdown-item" href="prep-networking-3-2020.html">Webservers and DNS</a>
      <div class="dropdown-divider"></div>
      <a class="dropdown-item disabled"><strong>Security (2020)</strong></a>
      <a class="dropdown-item" href="prep-security-1-2020.html">Security 1: Cyber Security and Ethical Hacking </a>
      <a class="dropdown-item" href="prep-security-2-2020.html">Security 2: Authentication, Authorization, and Password Storage</a>
      <a class="dropdown-item" href="prep-security-3-2020.html">Security 3: Passwords and Cryptography</a>
      <a class="dropdown-item" href="prep-security-4-2020.html">Security 4: Security Vulnerabilities</a>
      <div class="dropdown-divider"></div>
      <a class="dropdown-item disabled"><strong>Internet of Things (2020)</strong></a>
      <a class="dropdown-item" href="prep-iot-intro.html">IoT 1: Introduction</a>
      <a class="dropdown-item" href="prep-iot-devices.html">IoT 1: Installation</a>
      <a class="dropdown-item" href="prep-iot-stm.html">IoT 2: State Machines</a>
      <a class="dropdown-item" href="prep-iot-stmpy.html">IoT 2: State Machines in Micro Python</a>
      <a class="dropdown-item" href="prep-iot-http-json.html">IoT 3: HTTP and JSON</a>
      <a class="dropdown-item" href="prep-iot-mqtt.html">IoT 4: MQTT</a>
      <!--
      <a class="dropdown-item" href="prep-iot-api.html">IoT 4: APIs</a>
      <a class="dropdown-item" href="prep-iot-nb-iot.html">NB-IoT (Extra)</a>-->
    </div>
  </li>
  
  <li class="nav-item dropdown">
    <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">Labs</a>
    <div class="dropdown-menu">
        <a class="dropdown-item disabled"><strong>Security</strong></a>
        <a class="dropdown-item" href="security-1-2021.html">Security 1</a>
        <a class="dropdown-item" href="security-2-2021.html">Security 2</a>
        <a class="dropdown-item" href="security-3-2021.html">Security 3</a>
        <a class="dropdown-item" href="security-4-2021.html">Security 4</a>
        <a class="dropdown-item" href="security-5-2021.html">Security 5</a>
        <div class="dropdown-divider"></div>
        <a class="dropdown-item disabled"><strong>Networking (2020)</strong></a>
        <a class="dropdown-item" href="networking-1-2020.html">Binary and IP addresses</a>
        <a class="dropdown-item" href="networking-2-2020.html">Layers and Docker</a>
        <a class="dropdown-item" href="networking-3-2020.html">Webservers and DNS</a>
        <div class="dropdown-divider"></div>
        <a class="dropdown-item disabled"><strong>Security (2020)</strong></a>
        <a class="dropdown-item" href="security-1-2020.html">Security 1</a>
        <a class="dropdown-item" href="security-2-2020.html">Security 2</a>
        <a class="dropdown-item" href="security-3-2020.html">Security 3</a>
        <a class="dropdown-item" href="security-4-2020.html">Security 4</a>
        <div class="dropdown-divider"></div>
        <a class="dropdown-item disabled"><strong>Internet of Things (2020)</strong></a>
        <a class="dropdown-item" href="iot-devices.html">IoT 1: Programming Devices</a>
        <a class="dropdown-item" href="iot-stm.html">IoT 2: State Machines</a>
        <a class="dropdown-item" href="iot-http-json-2020.html">IoT 3: HTTP and JSON</a>
        <a class="dropdown-item" href="iot-http-json-2020-solution.html">IoT 3: HTTP and JSON (Solution and Revised Tasks)</a>
        <a class="dropdown-item" href="iot-mqtt-chat.html">IoT 4: MQTT Chat</a>
        <!--
        <a class="dropdown-item" href="iot-lopy.html">LoPy</a>
        <a class="dropdown-item" href="iot-mqtt.html">MQTT</a>
        <a class="dropdown-item" href="iot-lorawan.html">LoRaWAN / NB-IoT</a>
        <a class="dropdown-item" href="iot-api.html">API</a>-->
      </div>
  </li>
  
  <li class="nav-item dropdown">
    <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">Extra</a>
    <div class="dropdown-menu">
      <a class="dropdown-item disabled"><strong>Learning</strong></a>
      <a class="dropdown-item" href="learning-rats.html">RATs</a>
      <a class="dropdown-item" href="feedback.html">Tilbakemelding</a>
      <a class="dropdown-item" href="reports.html">Rapporter</a>
      <a class="dropdown-item" href="teams.html">Teams</a>
      <a class="dropdown-item" href="working-in-teams.html">Working in Teams</a>
      <a class="dropdown-item" href="tools.html">Learning Tools</a>
      <div class="dropdown-divider"></div>
      <a class="dropdown-item disabled"><strong>Material</strong></a>
      <a class="dropdown-item" href="commands-help.html">Help on Commands</a>
      <a class="dropdown-item" href="commands.html">List of Commands</a>
      <a class="dropdown-item" href="computer-history.html">Extra Videos</a>
      <div class="dropdown-divider"></div>
      <a class="dropdown-item disabled"><strong>Tools</strong></a>
      <a class="dropdown-item" href="virtual-box-mac.html">Virtual Box for Mac</a>
      <a class="dropdown-item" href="virtual-box-win.html">Virtual Box for Windows</a>
      <a class="dropdown-item" href="shell-mac.html">Terminal and SSH on Mac</a>
      <a class="dropdown-item" href="shell-win.html">Terminal and SSH on Windows</a>
    </div>
  </li>
  
  <!--
  <li class="nav-item">
    <a class="nav-link" href="#">Blackboard</a>
  </li>-->
</ul>

<div class="navbar-nav flex-row ml-md-auto d-none d-md-flex"></div>
             <a class="navbar-brand" href="https://ntnu.edu">
      	<svg width="100" height="30">
      		<image xlink:href="https://innsida.ntnu.no/innsida-theme/images/ntnu-graphics/ntnu_logo_white.svg" 
      		src="https://innsida.ntnu.no/innsida-theme/images/ntnu-graphics/ntnu_logo_white.png" width="100%" height="100%"></image>
      	</svg>
      </a>
    </nav>


<div class="page">
    </section>
    <section class="content">
<h1 id="http-and-json">HTTP and JSON</h1>
<p>Today you should realize the system we have already studied in the preparation. A Raspberry Pi with a Sense HAT acts as a temperature sensor in a smart home, which constantly reads the temperature and sends it to a web server with a HTTP <strong>POST</strong> request. The web server makes the temperature readable by offering a website to any clients.</p>

<div class="figure">
<img src="figures/iot/smart-home.png" alt="Sketch of the smart home system." width="100%"/>
<span name="figures/iot/smart-home.png">&nbsp;</span>
<aside name="figures/iot/smart-home.png"><p><p>Sketch of the smart home system.</p>
</p></aside>
</div>
<h2 id="task-sequence-diagram">Task: Sequence Diagram</h2>
<p>Create again the sequence diagram from the lecture that shows three lifelines, one for the Raspberry Pi that is the sensor, one for the web server, and one for the browser. Add as many details to the diagram as you already know about, and make sure everyone in the team has the same understanding of the details. <strong>Today, you will implement this sequence diagram!</strong></p>
<p><strong>For the report:</strong> Include the sequence diagram and describe what is happening.</p>

<h2 id="some-hints-for-today">Some Hints for Today:</h2>
<p>You have several options how to work today, that means, on which machines.</p>
<ul>
<li>Ideally, work on a Raspberry Pi. You can run both the sensor client and the web server on the same Raspberry Pi.</li>
<li>You can also run the web server on a separate Raspberry Pi (this is more like the real system) but then you need to switch between Pis.</li>
<li>You can also work on the lab PCs or a private PC and implement most of the lab on it, as long as Python 3 is running on them.</li>
<li>In the end, you should use a Pi for the sensor since you should read the real temperature from the Sense HAT.</li>
</ul>

    </section>
    <section class="content">
<h1 id="task-1-basic-webserver">Task 1: Basic Webserver</h1>
<p>Copy the following code into a file <code>webserver_1.py</code>.</p>
<ul>
<li>Read carefully through the code, starting with line 52, and then the class of line 31.</li>
<li>Explain the code lines (especially 32 to ca. 45 to each other). This will be the core of what we do today.</li>
<li>Be patient. Ask questions to each other, make sure everyone gets it.</li>
</ul>
<script src="https://gist.github.com/falkr/6c3025ec5f4278e5847bc469b9ad8b29.js"></script>

<ul>
<li>Run the code.</li>
</ul>

<p><strong>A detail:</strong> You may see that the <code>do_GET()</code> function only has <code>self</code> as parameter (from the class), and does not have a return value. This may be surprising, since it should get the request as input and then compute an answer. However, see how the code above gets access to the request via the attribute <code>self.requestline</code>. Similarly, the response is created by calling some functions on the parent class, for instance <code>self.wfile.write(response_in_bytes)</code>. So therefore the <code>do_GET()</code> does not have any input or return parameters. It’s more a question of how the API is designed, the authors have made a decision here.</p>

<h2 id="task-2.2-request-via-web-browser">Task 2.2: Request via Web Browser</h2>
<ul>
<li>Either on the same machine, or (even better) on a different machine, access the website address that the server prints out in a browser.</li>
<li>If you access the browser on the same machine, you can type <code>http://localhost:8000/</code> as address. Otherwise, use the IP address.</li>
<li>What happens in the browser, and what happens in the command where the server program runs?</li>
<li>Create a sequence diagram of what you have just observed, and annotate it with details that you find relevant.</li>
<li>Answer the following questions:
<ul>
<li>In which format is the answer sent from the webserver to the client? Which steps are involved to convert the data for the response?</li>
<li>What happens if you send the request to the wrong port, for instance port <code>8001</code>?</li>
</ul></li>
</ul>

<h2 id="task-1.2-request-from-python">Task 1.2: Request from Python</h2>
<p>A browser is not the only way to send an HTTP request. Another one is to create a HTTP request directly from Python. The following code creates an HTTP request in Python:</p>
<script src="https://gist.github.com/falkr/a91d1a52173297e2c7a15a4df67320a7.js"></script>
<ul>
<li>You need to adjust the address in the request.</li>
<li>Run the code while the server is active. Describe what happens.</li>
</ul>

    </section>
    <section class="content">
<h1 id="task-2-nicer-html-output">Task 2: Nicer HTML Output</h1>
<p>Now that we can send a simple string as a response, let’s make the answer more advanced and send a proper website in HTML. HTML is in principle also only a string, but the browser reads the formatting tags and creates a nicely rendered page out of it. The following code contains a simple Python method that creates some HTML:</p>
<script src="https://gist.github.com/falkr/d3140ef3386a7606a38ee83b9a7ba4ac.js"></script>
<ul>
<li><p>Copy the code above into the web server file from above. Place the function just below the import statements, so that it is at the top level of the file. (Not within the class declaration.)</p></li>
<li><p>Exchange the simple string in the web server so that it instead returns the HTML page created by this function.</p></li>
<li><p>To make all correct and tidy, update the line where we set the content type so that it uses <code>self.send_header("Content-type", "text/html")</code>.</p></li>
<li><p>Now go back to the browser, and access the website again. What changed?</p></li>
<li><p>Can you set the title of the website?</p></li>
</ul>

    </section>
    <section class="content">
<h1 id="task-3-storing-data-in-the-server">Task 3: Storing Data in the Server</h1>
<p>Later the web server should store the temperature and other values that the sensors send in. So we need some way to store data in the web server. In a real system, this is done with data bases or more powerful storage solutions optimized to serve many requests. For our little server, just storing the data in a Python dictionary is enough.</p>
<p>There are several ways of doing this, but we try to add the code only in the method that processes the GET requests. Since the method is called for each request, we need to store the data in a central place. For that, we use the context of the server, and declare a variable there. Luckily, we can access the server object using the variable <code>self.server</code>. Have a look at the following code:</p>
<script src="https://gist.github.com/falkr/de6d6534bbaebd3d6a4b98ac149c3863.js"></script>
<ul>
<li>Add this code at a proper place in the method <code>do_GET()</code></li>
<li>Add some code so that the counter is increased with each request.</li>
<li>Add code to the HTML so that it prints the counter’s value, and tells the reader in the browser that “this is the i-th request”.</li>
<li>Answer the following questions:
<ul>
<li>Why is it not working to just use a local variable declared within the <code>do_GET()</code> method? Why do we need to access the variable via <code>self.server.data</code>?</li>
</ul></li>
</ul>

    </section>
    <section class="content">
<h1 id="task-4-sending-data-to-the-server">Task 4: Sending Data to the Server</h1>
<p>We can send additional data with our request, by appending it into the URL as follows:</p>
<pre><code>http://localhost:8000/?data={&quot;time&quot;: &quot;12:05&quot;, &quot;temperature&quot;: 20.0, &quot;humidity&quot;: 54.3}</code></pre>

<h2 id="task-4.1-sending-data-via-the-browser">Task 4.1: Sending Data via the Browser</h2>
<ul>
<li>Copy the URL from above, but adjust it to your IP address (if necessary).</li>
<li>Paste the entire URL with the data part into your browser.</li>
<li>Observe what happens in the address line after the response returns. Did the browser change the data?</li>
<li>Check which information was received by the server.</li>
<li>Has the data been transformed somehow?</li>
</ul>

<h2 id="task-4.2-get-and-post-on-the-server">Task 4.2: GET and POST on the Server</h2>
<p>When we use HTTP to both request data and store data, we should use different HTTP commands for these tasks. To read a website, we alread use the <strong>GET</strong> command. To set data, we should use instead the <strong>POST</strong> command. In Task 4.1 above we have “misused” the browser, and let it make a GET request with the data. For making all neat and tidy, we should use a <strong>POST</strong> instead.</p>
<ul>
<li>Create a new file <code>webserver_2.py</code> with a copy of the original webserver.</li>
<li>Add a function <code>do_POST():</code> <strong>in addition</strong> to the already existing <code>do_GET()</code> function.</li>
</ul>
<p>We use from now on the <code>do_GET()</code> function to serve the web site that reports the stored values, and the function <code>do_POST()</code> to receive data from the temperature sensor. The web server can hence process two different requests: one for storing data, one for serving a website that presents the data.</p>
<h2 id="task-4.3-sending-data-via-python-requests">Task 4.3: Sending Data via Python Requests</h2>
<p>We now want to send data from Python. Later, a sensor should do this automated and in periodic intervals, for which we cannot use a browser.</p>
<script src="https://gist.github.com/falkr/7959a3380f6835e900c43d374595bb6a.js"></script>
<ul>
<li>Create a new client program with the code above.</li>
<li>Add the necessary lines to convert the code, use the included functions.</li>
<li>With the server from before running, execute the client code.</li>
<li>Document what happens.</li>
</ul>

<h2 id="task-4.4-storing-data-in-the-server">Task 4.4: Storing Data in the Server</h2>
<ul>
<li>Pay attention to the method <code>do_POST()</code> in the server, and work on the incoming data to decode it. There are helper functions in the server code you can use. Among others, the function <code>extract_json_string(string)</code> is useful to extract a JSON string (within curly brackets) from a string.</li>
<li>Re-create the incoming dictionary that originates at the client.</li>
<li>Store it in the data dictionary.</li>
</ul>

    </section>
    <section class="content">
<h1 id="task-5-periodic-posts-from-the-raspberry-pi-and-sense-hat">Task 5: Periodic POSTS from the Raspberry Pi and Sense HAT</h1>
<p>Create a client on the Raspberry Pi with the Sense HAT that periodically reads the temperature and humidity from the Sense HAT and sends a <strong>POST</strong> request to the web server. (Running on the same Pi or another one.)</p>
<h2 id="task-5.1">Task 5.1</h2>
<ul>
<li>Start with a little program that reads the temperature and humidity from the Sense HAT and just prints it to the console. (Make that work, first.)</li>
<li>Find out how to create a task in Python that is repeated (probably a loop?) every 10 seconds (some wait?), and create a program that reads the temperature very 10 seconds. Document the result.</li>
<li>In addition to printing out, add the code to send the HTTP POST. Figure out how to include the data using JSON and all necessary serialization. You know all the building blocks for this task, you “just” have to set them together!</li>
</ul>

    </section>
    <section class="content">
<h1 id="task-6-temperature-in-the-browser">Task 6: Temperature in the Browser</h1>
<p>Prepare the <code>do_GET()</code> method in the web server so that it sends back an HTML page that displays the temperature (and humidity) that was stored.</p>
<ul>
<li>First, send some plain text data with just the value.</li>
<li>Try to send some nicer HTML that displays the values in a better readable form.</li>
<li>Document the entire system for the report.</li>
</ul>

    </section>
    <section class="content">
<h1 id="task-7-optional-tasks">Task 7: Optional Tasks</h1>
<p>Now that the very basic stuff is running, you can play with it and extend the system further, so it gets more realistic. The following are examples of stuff to add:</p>
<ul>
<li>Log more values from the Sense HAT</li>
<li>Also log the time</li>
<li>Report on the website when the measurement was taken</li>
</ul>

    </section>
    <section class="content">
<h1 id="final-steps">Final Steps</h1>
<h3 id="learning-goals">Learning Goals</h3>
<p>Reflect about what you learned today. Write a few sentences that capture (in your own words) what you learned and why it can be useful. Share these few sentences with everyone in the team. (You should use this text in the individual reflection below.)</p>

<h3 id="individual-reflection">Individual Reflection</h3>
<p>Fill out the <a href="https://forms.office.com/Pages/ResponsePage.aspx?id=cgahCS-CZ0SluluzdZZ8BSxiepoCd7lKk70IThBWqdJUQzJJUEVaQlBBMlFaSFBaTllITkcxRDEzNi4u" class="arrow">individual reflection survey</a>.</p>

<h3 id="the-combination-lock">The Combination Lock</h3>
<p>Each team gets their own combination lock so you can store the box in the lockers in the lab.</p>
<ul>
<li>The locks come opened and with the opening combination set.</li>
<li>Take a picture of that combination in your phone, so you remember it.</li>
<li>Do not attempt to change the code. (You do so by turning the locks opening 180 degrees and then setting them — don’t do that by accident.)</li>
</ul>

<h3 id="cleaning-up">Cleaning Up</h3>

<div class="todo"><ul>
<li>Put all hardware back into the box.</li>
<li>Store the box in one of the lockers in the lab, using the combination lock.</li>
<li>Connect all parts of the PC back to it (keyboard, mouse, monitor).</li>
<li>Take out any trash. (Even if its not yours… thank you!)</li>
<li>Put the chairs back to the table.</li>
</ul>
<h3 id="individual-exercises">Individual Exercises</h3>
<p>We recommend that you take some time to consider if there are any parts of this unit that you want to repeat individually, at your own pace. If you decide to do so, you have several options:</p>
<ul>
<li>You have access to the hardware box at all times from the lockers. Just make sure everyone in your team knows where the box is, and put it back into the locker.</li>
<li>Install a Raspberry Pi Image on a Virtual Box in your PC. With this, you always have a Raspberry Pi with you.</li>
<li>Some of the Linux-related exercises also work on the Linux-PCs in the lab.</li>
</ul>
</div>
    </section>
</div>


<footer></footer>
<script>
    anchors.add('h1').add('h2').add('h3');
    anchors.options.visible = 'always';
</script>
</body>
</html>
