<html lang="en-US"><head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1"/>

<title>TTM4175</title>
<meta property="og:title" content="TTM4175">
<meta property="og:locale" content="en_US">
<meta name="description" content="Introduction to Communication Technology and Digital Security">
<meta property="og:description" content="Introduction to Communication Technology and Digital Security">


<link rel="stylesheet" href="assets/bootstrap.min.css">
<script src="assets/jquery-3.5.1.min.js"></script>
<script src="assets/bootstrap.min.js"></script>
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.1/css/all.css" integrity="sha384-gfdkjb5BdAXd+lj+gudLWI+BXq4IuLW5IT+brZEZsLFm++aCMlF1V92rMkPaX4PP" crossorigin="anonymous">
<link rel="stylesheet" type="text/css" href="assets/style.css" />
<link rel="stylesheet" type="text/css" href="assets/bootstrap-icons.css">
<style type="text/css">div.check ul,
div.check ul li {
  padding: 0;
  margin: 0;
  list-style: none;
}

div.check ul {
  margin: 2em 0;
}

div.check ul li {
  margin: 1em;
  margin-left: 3em;
}

div.check ul li:before {
  content: '\f26a';
  font-family: bootstrap-icons !important;
  font-size:20;
  float: left;
  margin-left: -1.5em;
  color: #1481b8;
}
div.task p {
padding: 10px;
background-color: #D6E5F0;
border-radius: 5px;
border-left: 6px solid #1481b8 
}

div.task p::before { 
content: "Task: ";
font-weight: bold;
display: inline;
}
div.tip p {
  padding: 10px;
  background-color: #d9eaf2;
  border-radius: 5px;
  border-left: 6px solid #1481b8
}

div.warning p {
padding: 10px;
background-color: #ffd9ab;
border-radius: 5px;
border-left: 6px solid #fc8c03 
}

div.warning p::before {
    content: '\f071 ';
    font-family: 'Font Awesome 5 Free'; 
    color: #fc8c03;
display: inline;
}
.steps ol, .steps ul {
  counter-reset: li;
  list-style: none;
  margin-left: 10px
}

.steps li {
  margin: 0 0 10px 0;
  xline-height: 40px;
  min-height: 40px
}

.steps li:before {
  content: counter(li);
  counter-increment: li;
  xborder: 2px solid #1481b8;
  xcolor: white;
  xbackground-color: #1481b8;
  border: 2px solid #868279;
  color: #868279;
  background-color: none;
  font-family: "Source Sans Pro", Georgia, serif;
  font-weight: bold;
  border-radius: 100%;
  text-align: center;
  display: inline-block;
  top:8px;
  left:-30px;
  width: 30px;
  height: 30px;
  position: relative;
  margin-right:-10px;
  margin-left:-20px;
  margin-top:-20px;
  margin-bottom:-20px;
}
div.rat ol {
  list-style-type: upper-alpha;
}
div.report p {
padding: 10px;
background-color: #D6E5F0;
border-radius: 5px;
border-left: 6px solid #1481b8 
}

div.report p::before {
    content: 'For the Report: ';
    font-weight: bold; 
    color: #1481b8;
display: inline;
}
div.factbox {
  width:250px; float: right; margin: 0 15px 15px 15px; padding:15px; background: lightblue
}
.w3collapsible {
  background-color:#f0e9db;
  color: #868279; 
  padding: 8px 18px 8px 8px;
  cursor: pointer;
  width: 100%;
  border: none;
  border-radius: 3px 3px 0 0;
  text-align: left;
  outline: none;
  font-size: 15px;
}

.w3active, .w3collapsible:hover {
  background-color: #f0e9cb;
}

.w3content {
  filter: blur(3px);
  padding: 0 18px;
  display: block;
  overflow: hidden;
  background-color: #f3f3f3;
  margin-bottom: 15px;
}
div.figure {
  padding: 20px 0 20px 0;
  width: 100%;
}

div.figurefullwitdth {
  padding: 20px 0 20px 0;
  margin-left: -33px;
  margin-right: -33px;
  width: 100%;
}
div.goals ul,
div.goals ul li {
  padding: 0;
  margin: 0;
  list-style: none;
}

div.goals ul {
  margin: 2em 0;
}

div.goals ul li {
  margin: 1em;
  margin-left: 3em;
}

div.goals ul li:before {
  content: '\f26a';
  font-family: bootstrap-icons !important;
  font-size:20;
  float: left;
  margin-left: -1.5em;
  color: #1481b8;
}
a.ntnu-button {
    font: 600 14px "Source Sans Pro", Georgia, serif;
    background: #fff;
    color: #00509e;
    border: 1px solid #00509e;
    border-color: #00509e !important
    border-style: solid !important;
    border-radius: 10rem;
    display: inline-block;
    padding: 5px 15px;
    height: auto;
    font-weight: bold;
    line-height: 1.5em;
    text-align: center;
    vertical-align: top;
    cursor: pointer;
    text-decoration: none
}

a.ntnu-button:hover {
    background: #00509e;
    color: #fff;
    text-decoration: none
}
.w3collapsible {
  background-color:#f0e9db;
  color: #868279; 
  padding: 8px 18px 8px 8px;
  cursor: pointer;
  width: 100%;
  border: none;
  border-radius: 3px 3px 0 0;
  text-align: left;
  outline: none;
  font-size: 15px;
}

.w3active, .w3collapsible:hover {
  background-color: #f0e9cb;
}

.w3content {
  filter: blur(3px);
  padding: 0 18px;
  display: block;
  overflow: hidden;
  background-color: #f3f3f3;
  margin-bottom: 15px;
}

</style>
<script src="assets/anchor.js"></script>
<script src="assets/script-aside.js"></script>
</head>
<body id="top">

<nav class="navbar navbar-expand-md navbar-dark " style="background-color:#666666"#2B65EC"> <!-- fixed-top -->
        <ul class="nav nav-pills">
        <li class="nav-item">
    <a class="nav-link" href="index.html" style="font-weight: bold")>TTM4175</a>
  </li>

  <li class="nav-item dropdown">
    <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">Teknostart</a>
    <div class="dropdown-menu">
      <a class="dropdown-item" href="day0-2021.html">Oppstart</a>
      <a class="dropdown-item" href="material/TTM4175-2021-L01-Introduction_to_ethical_hacking.pdf">Introduction to Ethical Hacking (PDF)</a>
      <a class="dropdown-item" href="material/TTM4175-2021-L01-Introduction_to_Kali_linux.pdf">Introduction to Kali Linux (PDF)</a>
      <a class="dropdown-item" href="day2-2021.html">Dag 2</a>
      <a class="dropdown-item" href="day3-2021.html">Dag 3</a>
      <div class="dropdown-divider"></div>
      <a class="dropdown-item" href="day0-2020.html">(2020) Dag 0: Getting Started</a>
      <a class="dropdown-item" href="day1-2020.html">(2020) Dag 1: Virtual Box</a>
      <a class="dropdown-item" href="day2-2020.html">(2020) Dag 2: Linux Command Line</a>
      <a class="dropdown-item" href="day3-2020.html">(2020) Dag 3: SSH and HTML</a>
      <div class="dropdown-divider"></div>
      <a class="dropdown-item" href="tips.html">Tips</a>
    </div>
  </li>
        
  <li class="nav-item dropdown">
    <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">Preparation</a>
    <div class="dropdown-menu">
      <a class="dropdown-item disabled"><strong>Security and Ethical Hacking</strong></a>
      <a class="dropdown-item" href="prep-security-1-2021.html">Security 1</a>
      <a class="dropdown-item" href="prep-security-2-2021.html">Security 2</a>
      <a class="dropdown-item" href="prep-security-3-2021.html">Security 3</a>
      <a class="dropdown-item" href="prep-security-4-2021.html">Security 4</a>
      <a class="dropdown-item" href="prep-security-5-2021.html">Security 5</a>
      <div class="dropdown-divider"></div>
      <a class="dropdown-item disabled"><strong>Internet of Things</strong></a>
      <a class="dropdown-item" href="prep-iot-intro.html">IoT 1: Introduction</a>
      <!--
      <a class="dropdown-item disabled"><strong>Networking (2020)</strong></a>
      <a class="dropdown-item" href="prep-networking-1-2020.html">Binary and IP addresses</a>
      <a class="dropdown-item" href="prep-networking-2-2020.html">Layers and Docker</a>
      <a class="dropdown-item" href="prep-networking-3-2020.html">Webservers and DNS</a>
      <div class="dropdown-divider"></div>
      <a class="dropdown-item disabled"><strong>Security (2020)</strong></a>
      <a class="dropdown-item" href="prep-security-1-2020.html">Security 1: Cyber Security and Ethical Hacking </a>
      <a class="dropdown-item" href="prep-security-2-2020.html">Security 2: Authentication, Authorization, and Password Storage</a>
      <a class="dropdown-item" href="prep-security-3-2020.html">Security 3: Passwords and Cryptography</a>
      <a class="dropdown-item" href="prep-security-4-2020.html">Security 4: Security Vulnerabilities</a>
      <div class="dropdown-divider"></div>
      <a class="dropdown-item disabled"><strong>Internet of Things (2020)</strong></a>
      <a class="dropdown-item" href="prep-iot-intro.html">IoT 1: Introduction</a>
      <a class="dropdown-item" href="prep-iot-devices.html">IoT 1: Installation</a>
      <a class="dropdown-item" href="prep-iot-stm.html">IoT 2: State Machines</a>
      <a class="dropdown-item" href="prep-iot-stmpy.html">IoT 2: State Machines in Micro Python</a>
      <a class="dropdown-item" href="prep-iot-http-json.html">IoT 3: HTTP and JSON</a>
      <a class="dropdown-item" href="prep-iot-mqtt.html">IoT 4: MQTT</a>
      <a class="dropdown-item" href="prep-iot-api.html">IoT 4: APIs</a>
      <a class="dropdown-item" href="prep-iot-nb-iot.html">NB-IoT (Extra)</a>-->
    </div>
  </li>
  
  <li class="nav-item dropdown">
    <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">Labs</a>
    <div class="dropdown-menu">
        <a class="dropdown-item disabled"><strong>Security</strong></a>
        <a class="dropdown-item" href="security-1-2021.html">Security 1</a>
        <a class="dropdown-item" href="material/TTM4175-2021-L02-Technical_information_gathering.pdf">Security 2: Technical Information gathering</a>
        <a class="dropdown-item" href="material/TTM4175-2021-L03-Network_mapping.pdf">Security 3: Network mapping</a>
        <a class="dropdown-item" href="material/TTM4175-2021-L04-Web_hacking1.pdf">Security 4: Web Hacking 1</a>
        <a class="dropdown-item" href="material/TTM4175-2021-L04-Web_hacking2.pdf">Security 4: Web Hacking 2</a>
        <a class="dropdown-item" href="security-5-2021.html">Security 5</a>
        <div class="dropdown-divider"></div>
        <a class="dropdown-item disabled"><strong>Internet of Things (2020)</strong></a>
        <a class="dropdown-item" href="iot-devices-2021.html">IoT 1: Programming Devices</a>
        <!--
        <a class="dropdown-item disabled"><strong>Networking (2020)</strong></a>
        <a class="dropdown-item" href="networking-1-2020.html">Binary and IP addresses</a>
        <a class="dropdown-item" href="networking-2-2020.html">Layers and Docker</a>
        <a class="dropdown-item" href="networking-3-2020.html">Webservers and DNS</a>
        <div class="dropdown-divider"></div>
        <a class="dropdown-item disabled"><strong>Security (2020)</strong></a>
        <a class="dropdown-item" href="security-1-2020.html">Security 1</a>
        <a class="dropdown-item" href="security-2-2020.html">Security 2</a>
        <a class="dropdown-item" href="security-3-2020.html">Security 3</a>
        <a class="dropdown-item" href="security-4-2020.html">Security 4</a>
        <div class="dropdown-divider"></div>
        <a class="dropdown-item disabled"><strong>Internet of Things (2020)</strong></a>
        <a class="dropdown-item" href="iot-devices.html">IoT 1: Programming Devices</a>
        <a class="dropdown-item" href="iot-stm.html">IoT 2: State Machines</a>
        <a class="dropdown-item" href="iot-http-json-2020.html">IoT 3: HTTP and JSON</a>
        <a class="dropdown-item" href="iot-http-json-2020-solution.html">IoT 3: HTTP and JSON (Solution and Revised Tasks)</a>
        <a class="dropdown-item" href="iot-mqtt-chat.html">IoT 4: MQTT Chat</a>
        <a class="dropdown-item" href="iot-lopy.html">LoPy</a>
        <a class="dropdown-item" href="iot-mqtt.html">MQTT</a>
        <a class="dropdown-item" href="iot-lorawan.html">LoRaWAN / NB-IoT</a>
        <a class="dropdown-item" href="iot-api.html">API</a>-->
      </div>
  </li>
  
  <li class="nav-item dropdown">
    <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">Extra</a>
    <div class="dropdown-menu">
      <a class="dropdown-item disabled"><strong>Learning</strong></a>
      <a class="dropdown-item" href="learning-rats.html">RATs</a>
      <a class="dropdown-item" href="feedback.html">Tilbakemelding</a>
      <a class="dropdown-item" href="reports.html">Rapporter</a>
      <a class="dropdown-item" href="teams.html">Teams</a>
      <a class="dropdown-item" href="working-in-teams.html">Working in Teams</a>
      <a class="dropdown-item" href="tools.html">Learning Tools</a>
      <div class="dropdown-divider"></div>
      <a class="dropdown-item disabled"><strong>Material</strong></a>
      <a class="dropdown-item" href="commands-help.html">Help on Commands</a>
      <a class="dropdown-item" href="commands.html">List of Commands</a>
      <a class="dropdown-item" href="computer-history.html">Extra Videos</a>
      <div class="dropdown-divider"></div>
      <a class="dropdown-item disabled"><strong>Tools</strong></a>
      <a class="dropdown-item" href="virtual-box-mac.html">Virtual Box for Mac</a>
      <a class="dropdown-item" href="virtual-box-win.html">Virtual Box for Windows</a>
      <a class="dropdown-item" href="shell-mac.html">Terminal and SSH on Mac</a>
      <a class="dropdown-item" href="shell-win.html">Terminal and SSH on Windows</a>
    </div>
  </li>
  
  <!--
  <li class="nav-item">
    <a class="nav-link" href="#">Blackboard</a>
  </li>-->
</ul>

<div class="navbar-nav flex-row ml-md-auto d-none d-md-flex"></div>
             <a class="navbar-brand" href="https://ntnu.edu">
      	<svg width="100" height="30">
      		<image xlink:href="https://innsida.ntnu.no/innsida-theme/images/ntnu-graphics/ntnu_logo_white.svg" 
      		src="https://innsida.ntnu.no/innsida-theme/images/ntnu-graphics/ntnu_logo_white.png" width="100%" height="100%"></image>
      	</svg>
      </a>
    </nav>


<div class="page">
    </section>
    <section class="content">
<h1 id="getting-started-with-the-lopy">Getting Started with the LoPy</h1>
    </section>
    <section class="content">
<h1 id="building-the-lopy">Building the LoPy</h1>
<p>The LoPy consists of several parts:</p>
<ul>
<li>The main board with the processor and the radio</li>
<li>The expansion board, with LED, button and access to pins, USB, and power supply</li>
<li>The antenna</li>
</ul>
<p>We have version <code>2.1A</code> of the expansion board and version <code>1.0</code> of the LoPy.</p>
<p>Put together the parts carefully as shown in the picture below. Note that the LoPy fits both ways onto the expansion boards. Make sure the pins for <code>Vin</code> and <code>GND</code> align properly. With the version we have, the alignment looks like this:</p>
<div class="figure">
<img src="figures/iot/lopy-expansion-2.png" width="100%"/>
</div>
<p>Make sure you connect the antenna to the right antenna, close to the big white LED as shown above. We connect the antenna already now since using the radio without the antenna attached may damage the LoPy.</p>
<div class="figure">
<img src="figures/iot/lopy-antenna.png" width="100%"/>
</div>
<div class="figure">
<img src="figures/iot/lopy-antenna-2.png" width="100%"/>
</div>
<h2 id="important-warning">Important Warning:</h2>
<p>Don’t shortcut the LoPy by putting it on a metallic surface, like a MacBook. That’ll kill it.</p>
<div class="figure">
<img src="figures/iot/lopy-vs-macbook-300x142.jpg" width="100%"/>
</div>
<p>Also, don’t activate the LoRaWan radio without the antenna connected.</p>
<p><strong>For the report:</strong> Take a picture of your setup.</p>
    </section>
    <section class="content">
<span name="817cc6"></span><aside name="817cc6"><p><em>Firmware</em> is software that takes care of hardware-related issues. It is hence somewhere between the hardware and the actual software, which is the application that we are going to write. Hence the name.</p></aside>
<h1 id="updating-the-firmware">Updating the Firmware</h1>
<p><strong>Goal:</strong> You can connect the LoPy to your computer and have the latest firmware for the LoPy installed.</p>
<p>We now need to update the firmware on the LoPy, that is, the software that is installed on it.</p>
<h2 id="update-tool">Update Tool</h2>
<p>Install the update tool, either for <a href="https://software.pycom.io/findupgrade?product=pycom-firmware-updater&amp;type=all&amp;platform=win32&amp;redirect=true">Windows</a> or <a href="https://software.pycom.io/findupgrade?product=pycom-firmware-updater&amp;type=all&amp;platform=macos&amp;redirect=true">Mac</a>.</p>
<h2 id="for-expansion-board-2.0">For Expansion Board 2.0</h2>
<p>(This is the board we have.)</p>
<ol type="1">
<li>Make sure the LoPy is <strong>not</strong> connected to your computer yet.</li>
<li>Connect a jumper cable between <code>G23</code> and <code>GND</code></li>
<li>Reconnect the LoPy via USB to your computer, this puts the device in <em>firmware update mode</em>.</li>
<li>Run the Firmware Upgrade tool</li>
</ol>
<div class="figure">
<img src="figures/iot/lopy-update.png" width="100%"/>
</div>
<ol start="5" type="1">
<li>Unplug the LoPy</li>
<li>Remove the <code>G23</code> to <code>GND</code> jumper cable (see below)</li>
<li>Reboot the device (button or power off then on)</li>
</ol>
<div class="figure">
<img src="figures/iot/lopy-jumper.jpg" width="100%"/>
</div>
<div class="tip"><p>If you are having any issues, make sure the TX and RX jumpers are present on your Expansion Board, as the jumpers sometimes come loose in the box during transport. Without these jumpers, the updater will fail.</p></div>
<div class="tip"><p>If you succeeded updating the firmware, offer your help to other teams if they struggle, and offer to update their LoPy. (It is not important from which computer the LoPy gets updated.)</p>
<p><strong>For the report:</strong> Try to describe problems (if you had any) and how you solved them. What is your experience for such firmware updates? Was this easy?</p></div>
    </section>
    <section class="content">
<h1 id="programming-the-lopy">Programming the LoPy</h1>
<p><strong>Goal:</strong> You can run Python code on the LoPy.</p>
<p>You can program the LoPy with a plugin that is called <strong>Pymakr</strong>, which you can use either with the editors Atom or Visual Studio Code.</p>
<h2 id="installing-the-pymakr-plugin">Installing the Pymakr Plugin</h2>
<ol type="1">
<li>Decide if you want to install <a href="https://atom.io">Atom</a> or <a href="https://code.visualstudio.com">Visiual Studio Code</a>. (Both share the same code base, and for our lab, both work.)</li>
<li>Follow the instructions for installing the Pymakr plugin, depending on the ide either <a href="https://docs.pycom.io/pymakr/installation/atom/">Pymakr for Atom</a> or <a href="https://docs.pycom.io/pymakr/installation/vscode/">Pymakr for Visual Studio Code</a>
<ul>
<li>Only connect via USB and ignore the Telnet instructions.</li>
</ul></li>
</ol>
<h2 id="create-a-new-project">Create a New Project</h2>
<ul>
<li>Create a new folder</li>
<li>Open this folder as a new project.</li>
<li>Create a new file <code>main.py</code>, and copy in the following code:</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>import pycom</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>import time</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>pycom.heartbeat(<span class="va">False</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>while True:</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    pycom.rgbled(<span class="bn">0xFF0000</span>)  <span class="co"># Red</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    time.sleep(<span class="dv">1</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    pycom.rgbled(<span class="bn">0x00FF00</span>)  <span class="co"># Green</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    time.sleep(<span class="dv">1</span>)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    pycom.rgbled(<span class="bn">0x0000FF</span>)  <span class="co"># Blue</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    time.sleep(<span class="dv">1</span>)</span></code></pre></div>
<ul>
<li>Go through the code line-by-line</li>
<li>Explain to each other what the code does. (By now, your Python skills form the other course should be enough to understand what is going on here.)</li>
<li>Find the <code>Run</code> command in the editor, and run the main file on the LoPy.</li>
</ul>
<div class="figure">
<img src="figures/iot/lopy-run.png" width="100%"/>
</div>
<p>Now you should see the LED of the LoPy changing its colors.</p>
<p>Feel free to modify your program. Can you produce more exciting colors?</p>
    </section>
    <section class="content">
<h1 id="connecting-to-lora">Connecting to LoRa</h1>
<p><strong>Goal:</strong> You connect you LoPy to the LoRaWAN network.</p>
<h2 id="get-the-mac-address">Get the MAC Address</h2>
<p>The LoRa module has a MAC address, which we will use as the device ID when connecting to the LoRaWAN network. To find the MAC address, create a new project in the editor and run the following program:</p>
<pre><code>from network import LoRa
import binascii
lora = LoRa(mode=LoRa.LORAWAN)
print(binascii.hexlify(lora.mac()).upper().decode(&#39;utf-8&#39;))</code></pre>
<h2 id="get-the-app-eui-and-app-key">Get the App EUI and App Key</h2>
<ul>
<li>Go to MS Teams / TTM4175 / Files / LoPy Device IDs</li>
<li>Write in your MAC address.</li>
<li>Wait for the App EUI and the App Key to appear. (We are registering the device)</li>
</ul>
<h2 id="connecting-to-lorawan">Connecting to LoRaWAN</h2>
<ul>
<li>Create a new project</li>
<li>Create a main.py file with the content below</li>
<li>Exchange the variables with <code>app_eui</code> and <code>app_key</code> with the correct values for you</li>
<li>Run the program</li>
<li>If you connect successfully, mark it with <code>ok</code> in the last column of the table on Teams</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> network <span class="im">import</span> LoRa</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> socket</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> ubinascii</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialise LoRa in LORAWAN mode.</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Europe = LoRa.EU868</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>lora <span class="op">=</span> LoRa(mode<span class="op">=</span>LoRa.LORAWAN, region<span class="op">=</span>LoRa.EU868)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># create an OTAA authentication parameters</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>app_eui <span class="op">=</span> ubinascii.unhexlify(<span class="st">&#39;70B3D57ED00XXXXXXX&#39;</span>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>app_key <span class="op">=</span> ubinascii.unhexlify(<span class="st">&#39;D822576F285B93AC10F87B4FXXXXXXXX&#39;</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co"># join a network using OTAA (Over the Air Activation)</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>lora.join(activation<span class="op">=</span>LoRa.OTAA, auth<span class="op">=</span>(app_eui, app_key), timeout<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="co"># wait until the module has joined the network</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="kw">not</span> lora.has_joined():</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    time.sleep(<span class="fl">2.5</span>)</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&#39;Not yet joined...&#39;</span>)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="co"># create a LoRa socket</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>s <span class="op">=</span> socket.socket(socket.AF_LORA, socket.SOCK_RAW)</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="co"># set the LoRaWAN data rate</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>s.setsockopt(socket.SOL_LORA, socket.SO_DR, <span class="dv">5</span>)</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="co"># make the socket blocking</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="co"># (waits for the data to be sent and for the 2 receive windows to expire)</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>s.setblocking(<span class="va">True</span>)</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="co"># send some data</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>s.send(<span class="bu">bytes</span>([<span class="bn">0x01</span>, <span class="bn">0x02</span>, <span class="bn">0x03</span>]))</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a><span class="co"># make the socket non-blocking</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a><span class="co"># (because if there&#39;s no data received it will block forever...)</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>s.setblocking(<span class="va">False</span>)</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a><span class="co"># get any data received (if any...)</span></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> s.recv(<span class="dv">64</span>)</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(data)</span></code></pre></div>
    </section>
</div>


<footer></footer>
<script>
    anchors.add('h1').add('h2').add('h3');
    anchors.options.visible = 'always';
</script>
</body>
</html>
