<html lang="en-US"><head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1"/>

<title>TTM4175</title>
<meta property="og:title" content="TTM4175">
<meta property="og:locale" content="en_US">
<meta name="description" content="Introduction to Communication Technology and Digital Security">
<meta property="og:description" content="Introduction to Communication Technology and Digital Security">


<!--<link rel="stylesheet" type="text/css" href="style.css" />-->
<link href="https://fonts.googleapis.com/css?family=Merriweather:400,400italic,700,700italic|Source+Code+Pro|Source+Sans+Pro:200,300,400,600,400italic,600italic|Rock+Salt" rel="stylesheet" type="text/css">


<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>


<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.1/css/all.css" integrity="sha384-gfdkjb5BdAXd+lj+gudLWI+BXq4IuLW5IT+brZEZsLFm++aCMlF1V92rMkPaX4PP" crossorigin="anonymous">

<link rel="stylesheet" type="text/css" href="assets/style.css" />

<!--<script src="jquery-1.10.1.min.js"></script>-->
<script src="assets/script-aside.js"></script>
</head>
<body id="top">

<nav class="navbar navbar-expand-md navbar-dark " style="background-color:#666666"#2B65EC"> <!-- fixed-top -->
        <ul class="nav nav-pills">
        <li class="nav-item">
    <a class="nav-link" href="index.html" style="font-weight: bold")>TTM4175</a>
  </li>

  <li class="nav-item dropdown">
    <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">Teknostart</a>
    <div class="dropdown-menu">
      <a class="dropdown-item" href="day0-2020.html">Dag 0: Getting Started</a>
      <a class="dropdown-item" href="day1-2020.html">Dag 1: Virtual Box</a>
      <a class="dropdown-item" href="day2-2020.html">Dag 2: Linux Command Line</a>
      <a class="dropdown-item" href="day3-2020.html">Dag 3: SSH and HTML</a>
      <div class="dropdown-divider"></div>
      <a class="dropdown-item" href="tips.html">Tips</a>
    </div>
  </li>
        
  <li class="nav-item dropdown">
    <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">Preparation</a>
    <div class="dropdown-menu">
      <a class="dropdown-item disabled"><strong>Networking</strong></a>
      <a class="dropdown-item" href="prep-networking-1-2020.html">Binary and IP addresses</a>
      <a class="dropdown-item" href="prep-networking-2-2020.html">Layers and Docker</a>
      <a class="dropdown-item" href="prep-networking-3-2020.html">Webservers and DNS</a>
      <div class="dropdown-divider"></div>
      <a class="dropdown-item disabled"><strong>Security</strong></a>
      <a class="dropdown-item" href="prep-security-1.html">Security 1: Cyber Security and Ethical Hacking </a>
      <a class="dropdown-item" href="prep-security-2.html">Security 2: Authentication, Authorization, and Password Storage</a>
      <a class="dropdown-item" href="prep-security-3.html">Security 3: Passwords and Cryptography</a>
      <a class="dropdown-item" href="prep-security-4.html">Security 4: Security Vulnerabilities</a>
      <div class="dropdown-divider"></div>
      <a class="dropdown-item disabled"><strong>Internet of Things</strong></a>
      <a class="dropdown-item" href="prep-iot-intro.html">IoT 1: Introduction</a>
      <a class="dropdown-item" href="prep-iot-http-json.html">IoT 2: HTTP and JSON</a>
      <a class="dropdown-item" href="prep-iot-mqtt.html">IoT 3: MQTT</a>
      <a class="dropdown-item" href="prep-iot-api.html">IoT 4: APIs</a>
      <a class="dropdown-item" href="prep-iot-nb-iot.html">NB-IoT (Extra)</a>
    </div>
  </li>
  
  <li class="nav-item dropdown">
    <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">Labs</a>
    <div class="dropdown-menu">
        <a class="dropdown-item disabled"><strong>Networking</strong></a>
        <a class="dropdown-item" href="networking-1-2020.html">Binary and IP addresses</a>
        <a class="dropdown-item" href="networking-2-2020.html">Layers and Docker</a>
        <a class="dropdown-item" href="networking-3-2020.html">Webservers and DNS
        <div class="dropdown-divider"></div>
        <a class="dropdown-item disabled"><strong>Security</strong></a>
        <a class="dropdown-item" href="security-1.html">Security 1</a>
        <a class="dropdown-item" href="security-2.html">Security 2</a>
        <a class="dropdown-item" href="security-3.html">Security 3</a>
        <a class="dropdown-item" href="security-4.html">Security 4</a>
        <div class="dropdown-divider"></div>
        <a class="dropdown-item disabled"><strong>Internet of Things</strong></a>
        <a class="dropdown-item" href="iot-lopy.html">LoPy</a>
        <a class="dropdown-item" href="iot-http-json.html">HTTP and JSON</a>
        <a class="dropdown-item" href="iot-mqtt.html">MQTT</a>
		<a class="dropdown-item" href="iot-lorawan.html">LoRaWAN / NB-IoT</a>
        <a class="dropdown-item" href="iot-api.html">API</a>
      </div>
  </li>
  
  <li class="nav-item dropdown">
    <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">Extra</a>
    <div class="dropdown-menu">
      <a class="dropdown-item disabled"><strong>Learning</strong></a>
      <a class="dropdown-item" href="feedback.html">Tilbakemelding</a>
      <a class="dropdown-item" href="reports.html">Rapporter</a>
      <a class="dropdown-item" href="teams.html">Teams</a>
      <a class="dropdown-item" href="working-in-teams.html">Working in Teams</a>
      <a class="dropdown-item" href="tools.html">Learning Tools</a>
      <div class="dropdown-divider"></div>
      <a class="dropdown-item disabled"><strong>Material</strong></a>
      <a class="dropdown-item" href="commands-help.html">Help on Commands</a>
      <a class="dropdown-item" href="commands.html">List of Commands</a>
      <a class="dropdown-item" href="computer-history.html">Extra Videos</a>
      <div class="dropdown-divider"></div>
      <a class="dropdown-item disabled"><strong>Tools</strong></a>
      <a class="dropdown-item" href="virtual-box-mac.html">Virtual Box for Mac</a>
      <a class="dropdown-item" href="virtual-box-win.html">Virtual Box for Windows</a>
      <a class="dropdown-item" href="shell-win.html">Terminal and SSH on Windows</a>
    </div>
  </li>
  
  <!--
  <li class="nav-item">
    <a class="nav-link" href="#">Blackboard</a>
  </li>-->
</ul>

<div class="navbar-nav flex-row ml-md-auto d-none d-md-flex"></div>
             <a class="navbar-brand" href="https://ntnu.edu">
      	<svg width="100" height="30">
      		<image xlink:href="https://innsida.ntnu.no/innsida-theme/images/ntnu-graphics/ntnu_logo_white.svg" 
      		src="https://innsida.ntnu.no/innsida-theme/images/ntnu-graphics/ntnu_logo_white.png" width="100%" height="100%"></image>
      	</svg>
      </a>
    </nav>


<div class="page">
    </section>
    <section class="content">
<h1 id="password-clearing-and-cracking">Password clearing and cracking</h1>
<p>In this lab, you will learn how to clear a password in Windows and how to use ophcrack and John the ripper to crack passwords.</p>

    </section>
    <section class="content">
<h1 id="clearing-the-user-password-in-windows">Clearing the user password in Windows</h1>
<p>In the previous lab, you had to swap the system files in order to change the user’s password. Another alternative that you will try now is to clear the password.</p>
<h2 id="updating-chntpw">Updating chntpw</h2>
<p>Passwords in Windows are stored hashed in the Security Accounts Manager (SAM) database, located in the <em>/Windows/System32/config</em> folder. We will manipulate the SAM registry in order to clear the hashed password of user <strong>Lab2</strong>. SAM file is stored in a binary format and cannot simply be read by a text editor. We will use a program called <em>chntpw</em> in order to clear the users password from the SAM file.</p>
<ul>
<li>Make sure that Windows 7 is mounted within Kali, then go to the following folder containing the SAM file:</li>
</ul>

<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb1-1" title="1"><span class="fu">mount</span> /dev/sdb2 /mnt/windows</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="bu">cd</span> /mnt/windows/Windows/System32/config</a>
<a class="sourceLine" id="cb1-3" title="3"><span class="fu">ls</span></a></code></pre></div>

<ul>
<li>Start <em>chntpw</em> in interactive mode by using <em>-i</em> flag option and read in the SAM file</li>
</ul>
<p><code>#chntpw -i sam</code> (The SAM file is stored either in uppercase or in lowercase so choose the name that is used on your system).</p>
<ul>
<li><p>Follow the on-screen instructions. Select option 1 to begin clearing a user password (the number in square brackets denotes the default).</p></li>
<li><p>We want to clear the password of user <strong>Lab2</strong>, so enter its RID</p></li>
<li><p>Choose option 1 again to clear the password of user <strong>Lab2</strong></p></li>
<li><p>Write changes to disk by quitting the current context (q) and confirm that you want to save the changes (y). You have now cleared the password of <strong>Lab2</strong> user.</p></li>
</ul>
<p>Finally, return to your home folder <code># cd</code> and unmount the Windows partition from kali Linux <code># unmount /mnt/windows</code>.</p>
<p>Reboot the machine and select Windows 7. You should now be able to login into <strong>Lab2</strong> account without a password.</p>

    </section>
    <section class="content">
<h1 id="cracking-the-windows-7-user-password">Cracking the Windows 7 user password</h1>
<p>Start by creating 5 user accounts in Windows for which you will try to crack the passwords.</p>
<h2 id="create-new-users-in-windows">Create new users in Windows</h2>
<ul>
<li><p>Get administrator access: follow the same steps from part 1 of the previous lab (attach Windows 7 to Kali in virtual box, then mount the Windows 7 partition within Kali and swap <em>osk.exe</em> and <em>cmd.exe</em>) in order to get administrator access</p></li>
<li><p>Create 5 users: <strong>Lab10</strong>, <strong>Lab20</strong>, <strong>Lab30</strong>, <strong>Lab40</strong>, and <strong>Lab50</strong> and assign a different password to each user. For the first two users, assign a commonly-used password (you can search the web for the list of top 10,000 most common passwords). For the remaining users, choose passwords that are of different lengths, with and without special characters.</p></li>
</ul>

<div class="tip"><p>Use the <code>net user</code> command to create a new user</p>
</div>
<ul>
<li>Remember to revert the changes you made on <em>osk.exe</em> and <em>cmd.exe</em> files.</li>
</ul>

<h2 id="obtaining-the-password-hashes">Obtaining the password hashes</h2>
<p>Your task now is to <strong>obtain</strong> the password hashes stored in the SAM database. We need to use Kali with the Windows 7 partition mounted. Make sure that you have the Windows 7 disk attached to your Kali Linux virtual machine.</p>
<ul>
<li>Locate the SAM database by changing to the <em>Windows/System32/config</em> directory</li>
</ul>

<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb1-1" title="1"><span class="bu">cd</span> /mnt/windows/Windows/System32/config/</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="fu">ls</span></a></code></pre></div>

<p>In order to enhance the security of the SAM database against off-line attacks, Microsoft introduced the Syskey function, which partially encrypts the SAM database based on a key stored in another registry file called SYSTEM. Hence you need to extract the contents of both the SYSTEM file and the SAM file. Both are stored in a binary format and are not readily readable.</p>
<ul>
<li>Use the tool <em>samdump2</em> to extract the content of the SYSTEM file and the SAM file, and write the contents to <em>win_pwd_hashes.text</em></li>
</ul>

<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb1-1" title="1"><span class="ex">samdump2</span> system sam <span class="op">&gt;</span> ~/win_pwd_hashes.txt</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="bu">cd</span> </a></code></pre></div>

<h2 id="examining-the-sam-database">Examining the SAM database</h2>
<ul>
<li>Take a look at the content of the <em>win_pwd_hashes.text</em> <code># cat win_pwd_hashes.txt</code>. Each line entry represents a user account on the system with their respective hashes.</li>
</ul>

<h2 id="examining-the-sam-database-in-ophcrack">Examining the SAM database in Ophcrack</h2>
<p>Ophcrack is a program that comes with a graphical user interface that allows you to see the format of the passwords in the SAM database.</p>
<ul>
<li><p>Open Ophcrack by running <em>ophcrack</em> in the terminal of your Kali Linux machine</p></li>
<li><p>Click on Load -&gt;PWDUMP file</p></li>
<li><p>Find the file <em>win_pwd_hashes.txt</em>. It will show you the hashed passwords.</p></li>
<li><p>try the Crack functionality on the available users. Did it succeed in cracking all passwords?</p></li>
</ul>

<h2 id="john-the-ripper">John the Ripper</h2>
<p>John the Ripper is a cracking tool that runs in both <em>brute-force</em> and <em>dictionary attack</em> modes. It’s basic functionality is to repeatedly try different passwords and hash them until it finds a match. However, since the space of all possible passwords is virtually infinite, testing all password in this manner (brute-force search) will not be feasible unless the password was very short. Instead, we will try a list of more likely passwords known as <em>dictionary attack</em> mode.</p>
<p>John the Ripper comes with a pre-installed dictionary of some typical passwords located in <em>/usr/share/john/password.lst</em>.</p>

<h3 id="default-dictionary">Default dictionary</h3>
<ul>
<li>Start by running John the Ripper on our obtained Windows 7 hash file with the default dictionary, using the following command (note the use of single quotes around the username): <code># john --wordlist --format=NT --user='Lab 3 - DO NOT WIPE!' win_pwd_hashes.txt</code></li>
</ul>
<p>This command tells John to use a dictionary attack (–-wordlist) with words from the default dictionary <em>/etc/share/john/password.lst</em>; using the hash function NTLMv2 (–-format=NT); targeting user Lab 3 - DO NOT WIPE! (–-user=…); and where the target hashes are stored in win_pwd_hashes.txt.</p>
<p>If the output of John the Ripper shows 0 guesses, it means the password is not contained in the default dictionary and it could not be cracked.</p>
<ul>
<li>Repeat the same command for the 5 users that you created. Did John the Ripper succeed in guessing all passwords?</li>
</ul>
<h3 id="creating-new-passwords-from-existing-ones">Creating new passwords from existing ones</h3>
<p>Instead of using a larger dictionary, John the Ripper can apply a multitude of transformations to a wordlist in order to create new passwords from existing ones. For example, we could make it append numbers to the end of all the words in the dictionary, such that if the word “car” was in the original dictionary, then it would also try <em>car0</em> , <em>car1</em>, …, <em>car 9</em>, <em>car00</em>, <em>car01</em>, …, etc.</p>
<p>These transformations are defined by a set of rules found in the configuration file <em>/etc/john/john.conf</em>.</p>
<ul>
<li><p>Open the config file by running <code>leafpad /etc/john/john.conf &amp;</code> from the terminal.</p></li>
<li><p>Scroll down to the line containing “[List.Rules:Wordlist]”.</p></li>
</ul>
<p>Every line underneath contains a transformation rule which will be applied to every word of the dictionary. First comes zero or more rejection rules, all starting with a hyphen, e.g. -c, -8, -s, etc. These are used to decide whether the rest of the transformation rules on the line should be applied to a word or not. You can just ignore these.</p>
<p>Next comes the actual transformation rules themselves.</p>
<p>For example the rule: <code>&lt;5 c r Q</code></p>
<p>It applies to words of length less than 5 <em>( &lt;5 )</em> ; and if so, it will capitalize <em>( c )</em> and reverse <em>( r )</em> it. The <em>Q</em> command ensures that words that are not changed won’t be unnecessarily added to the dictionary, avoiding duplicates (e.g. capitalizing an already capitalized word does not change it).</p>
<p>For example, if “car” was in the dictionary, then the above rule would make John the Ripper also try the word <em>raC</em>; that is by checking first if the word’s length is less than 5, then capitalizing it to get <em>Car</em>, and finally reversing it to get the result <em>raC</em>.</p>
<ul>
<li>Your task now is to create a rule that applies to all words that are longer than 1 and less than 7, and replaces all appearances of lowercase “L” with the number “1”. For example, if the word “hello” was in the dictionary, then “he11o” would also be added.</li>
</ul>

<div class="tip"><p>use the command “s” to substitute a letter by another. example <em>so0</em> substitutes letter “o” with a zero</p>
<p>The description of every possible transformation rule can be found at the John the Ripper web page http://www.openwall.com/john/doc/RULES.shtml</p>
</div>
<ul>
<li><p>To check how the default rules work, create a dictionary file <em>test.dict</em> containing the single word “labrador” <code># echo "labrador" &gt; test.dict</code></p></li>
<li><p>Apply the default John rules to * test.dict * and print the results as follows: <code># john --worldlist=test.dict --rules --stdout</code></p></li>
<li><p>To find out how many new password did John create from this single-word dictionary, pipe the output above with ‘|’ into <em>wc</em>.</p></li>
</ul>

    </section>
    <section class="content">
<h1 id="final-steps">Final Steps</h1>
<h3 id="learning-goals">Learning Goals</h3>
<p>In your double-team, reflect about what you learned today. Write a few sentences that capture (in your own words) what you learned and why it can be useful. Share these few sentences with everyone in the double-team. (You should use this text in the individual reflection below.)</p>

<span name="e4f5ce"></span><aside name="e4f5ce"><p><img src="figures/doubleteam.png" width="30"/></p>
</aside>
<h3 id="individual-reflection">Individual Reflection</h3>
<p>Fill out the <a href="https://forms.office.com/Pages/ResponsePage.aspx?id=cgahCS-CZ0SluluzdZZ8BSxiepoCd7lKk70IThBWqdJUQzJJUEVaQlBBMlFaSFBaTllITkcxRDEzNi4u" class="arrow">individual reflection survey</a>.</p>

<h3 id="cleaning-up">Cleaning Up</h3>

<div class="todo"><ul>
<li>Put all hardware back into the box.</li>
<li>Store the box in one of the lockers in the lab, using the combination lock.</li>
<li>Connect all parts of the PC back to it (keyboard, mouse, monitor).</li>
<li>Take out any trash. (Even if its not yours… thank you!)</li>
<li>Put the chairs back to the table.</li>
</ul>
<h3 id="individual-exercises">Individual Exercises</h3>
<p>We recommend that you take some time to consider if there are any parts of this unit that you want to repeat individually, at your own pace. If you decide to do so, you have several options:</p>
<ul>
<li>You have access to the hardware box at all times from the lockers. Just make sure everyone in your team knows where the box is, and put it back into the locker.</li>
<li>Install a Raspberry Pi Image on a Virtual Box in your PC. With this, you always have a Raspberry Pi with you.</li>
<li>Some of the Linux-related exercises also work on the Linux-PCs in the lab.</li>
</ul>
</div>
    </section>
</div>


<footer></footer>
</body>
</html>
