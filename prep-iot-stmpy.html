<html lang="en-US"><head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1"/>

<title>TTM4175</title>
<meta property="og:title" content="TTM4175">
<meta property="og:locale" content="en_US">
<meta name="description" content="Introduction to Communication Technology and Digital Security">
<meta property="og:description" content="Introduction to Communication Technology and Digital Security">


<!--<link rel="stylesheet" type="text/css" href="style.css" />-->
<link href="https://fonts.googleapis.com/css?family=Merriweather:400,400italic,700,700italic|Source+Code+Pro|Source+Sans+Pro:200,300,400,600,400italic,600italic|Rock+Salt" rel="stylesheet" type="text/css">


<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>


<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.1/css/all.css" integrity="sha384-gfdkjb5BdAXd+lj+gudLWI+BXq4IuLW5IT+brZEZsLFm++aCMlF1V92rMkPaX4PP" crossorigin="anonymous">

<link rel="stylesheet" type="text/css" href="assets/style.css" />

<!--<script src="jquery-1.10.1.min.js"></script>-->
<script src="assets/script-aside.js"></script>
</head>
<body id="top">

<nav class="navbar navbar-expand-md navbar-dark " style="background-color:#666666"#2B65EC"> <!-- fixed-top -->
        <ul class="nav nav-pills">
        <li class="nav-item">
    <a class="nav-link" href="index.html" style="font-weight: bold")>TTM4175</a>
  </li>

  <li class="nav-item dropdown">
    <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">Teknostart</a>
    <div class="dropdown-menu">
      <a class="dropdown-item" href="day0-2020.html">Dag 0: Getting Started</a>
      <a class="dropdown-item" href="day1-2020.html">Dag 1: Virtual Box</a>
      <a class="dropdown-item" href="day2-2020.html">Dag 2: Linux Command Line</a>
      <a class="dropdown-item" href="day3-2020.html">Dag 3: SSH and HTML</a>
      <div class="dropdown-divider"></div>
      <a class="dropdown-item" href="tips.html">Tips</a>
    </div>
  </li>
        
  <li class="nav-item dropdown">
    <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">Preparation</a>
    <div class="dropdown-menu">
      <a class="dropdown-item disabled"><strong>Networking</strong></a>
      <a class="dropdown-item" href="prep-networking-1-2020.html">Binary and IP addresses</a>
      <a class="dropdown-item" href="prep-networking-2-2020.html">Layers and Docker</a>
      <a class="dropdown-item" href="prep-networking-3-2020.html">Webservers and DNS</a>
      <div class="dropdown-divider"></div>
      <a class="dropdown-item disabled"><strong>Security</strong></a>
      <a class="dropdown-item" href="prep-security-1-2020.html">Security 1: Cyber Security and Ethical Hacking </a>
      <a class="dropdown-item" href="prep-security-2-2020.html">Security 2: Authentication, Authorization, and Password Storage</a>
      <a class="dropdown-item" href="prep-security-3-2020.html">Security 3: Passwords and Cryptography</a>
      <a class="dropdown-item" href="prep-security-4-2020.html">Security 4: Security Vulnerabilities</a>
      <div class="dropdown-divider"></div>
      <a class="dropdown-item disabled"><strong>Internet of Things</strong></a>
      <a class="dropdown-item" href="prep-iot-intro.html">IoT 1: Introduction</a>
      <a class="dropdown-item" href="prep-iot-devices.html">IoT 1: Installation</a>
      <a class="dropdown-item" href="prep-iot-stm.html">IoT 2: State Machines</a>
      <!--
      <a class="dropdown-item" href="prep-iot-http-json.html">IoT 2: HTTP and JSON</a>
      <a class="dropdown-item" href="prep-iot-mqtt.html">IoT 3: MQTT</a>
      <a class="dropdown-item" href="prep-iot-api.html">IoT 4: APIs</a>
      <a class="dropdown-item" href="prep-iot-nb-iot.html">NB-IoT (Extra)</a>-->
    </div>
  </li>
  
  <li class="nav-item dropdown">
    <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">Labs</a>
    <div class="dropdown-menu">
        <a class="dropdown-item disabled"><strong>Networking</strong></a>
        <a class="dropdown-item" href="networking-1-2020.html">Binary and IP addresses</a>
        <a class="dropdown-item" href="networking-2-2020.html">Layers and Docker</a>
        <a class="dropdown-item" href="networking-3-2020.html">Webservers and DNS</a>
        <div class="dropdown-divider"></div>
        <a class="dropdown-item disabled"><strong>Security</strong></a>
        <a class="dropdown-item" href="security-1-2020.html">Security 1</a>
        <a class="dropdown-item" href="security-2-2020.html">Security 2</a>
        <a class="dropdown-item" href="security-3-2020.html">Security 3</a>
        <a class="dropdown-item" href="security-4-2020.html">Security 4</a>
        <div class="dropdown-divider"></div>
        <a class="dropdown-item disabled"><strong>Internet of Things</strong></a>
        <a class="dropdown-item" href="iot-devices.html">IoT 1: Programming Devices</a>
        <!--
        <a class="dropdown-item" href="iot-lopy.html">LoPy</a>
        <a class="dropdown-item" href="iot-http-json.html">HTTP and JSON</a>
        <a class="dropdown-item" href="iot-mqtt.html">MQTT</a>
        <a class="dropdown-item" href="iot-lorawan.html">LoRaWAN / NB-IoT</a>
        <a class="dropdown-item" href="iot-api.html">API</a>-->
      </div>
  </li>
  
  <li class="nav-item dropdown">
    <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">Extra</a>
    <div class="dropdown-menu">
      <a class="dropdown-item disabled"><strong>Learning</strong></a>
      <a class="dropdown-item" href="learning-rats.html">RATs</a>
      <a class="dropdown-item" href="feedback.html">Tilbakemelding</a>
      <a class="dropdown-item" href="reports.html">Rapporter</a>
      <a class="dropdown-item" href="teams.html">Teams</a>
      <a class="dropdown-item" href="working-in-teams.html">Working in Teams</a>
      <a class="dropdown-item" href="tools.html">Learning Tools</a>
      <div class="dropdown-divider"></div>
      <a class="dropdown-item disabled"><strong>Material</strong></a>
      <a class="dropdown-item" href="commands-help.html">Help on Commands</a>
      <a class="dropdown-item" href="commands.html">List of Commands</a>
      <a class="dropdown-item" href="computer-history.html">Extra Videos</a>
      <div class="dropdown-divider"></div>
      <a class="dropdown-item disabled"><strong>Tools</strong></a>
      <a class="dropdown-item" href="virtual-box-mac.html">Virtual Box for Mac</a>
      <a class="dropdown-item" href="virtual-box-win.html">Virtual Box for Windows</a>
      <a class="dropdown-item" href="shell-mac.html">Terminal and SSH on Mac</a>
      <a class="dropdown-item" href="shell-win.html">Terminal and SSH on Windows</a>
    </div>
  </li>
  
  <!--
  <li class="nav-item">
    <a class="nav-link" href="#">Blackboard</a>
  </li>-->
</ul>

<div class="navbar-nav flex-row ml-md-auto d-none d-md-flex"></div>
             <a class="navbar-brand" href="https://ntnu.edu">
      	<svg width="100" height="30">
      		<image xlink:href="https://innsida.ntnu.no/innsida-theme/images/ntnu-graphics/ntnu_logo_white.svg" 
      		src="https://innsida.ntnu.no/innsida-theme/images/ntnu-graphics/ntnu_logo_white.png" width="100%" height="100%"></image>
      	</svg>
      </a>
    </nav>


<div class="page">
    </section>
    <section class="content">
<h1 id="state-machines-in-micro-python">State Machines in Micro Python</h1>
<p>The state machines were so far expressed as diagrams, that means <strong>pictures</strong>. In this part we are going to explore how we can implement the state machines as Python <strong>code</strong>.</p>
<p>The Microbit we are going to program does not run all Python code, but only a reduced set of it. This subset is called MicroPython. To run state machines on it, we will provide you with some code that serves as a template or a skeleton. We create the state machines by manually translating a diagram step for step into a Python function that executes transitions.</p>

<h3 id="idea-1-storing-the-state">Idea 1: Storing the State</h3>
<p>In a “normally coded” program, the progress of an application is stored indirectly in the form of the program counter. Simplified said, the program remembers <strong>in which line</strong> it currently is, and then proceeds, statement for statement, including loops and branches.</p>
<p>To execute a state machine, we use an <strong>extra variable that explicitly stores the current state</strong> of the program, and which corresponds to the state in the state machine. For simplicity, we store the variable as a string, which corresponds to the name of the state from the diagram.</p>

<h3 id="idea-2-a-transition-function">Idea 2: A Transition Function</h3>
<p>Now that we have taken care of the control state by an explicit variable, we need to think how to implement the transitions. Let’s think again what a transition actually does:</p>
<ul>
<li>It is triggered by an event.</li>
<li>It takes a state machine from one state to another state.</li>
<li>While it executes, it can do some actions and maybe decide between alternative branches.</li>
</ul>

<p>To implement transitions, we define a function that executes them. The method receives 4 parameters;</p>
<ul>
<li><code>state</code> - the current state of the machine</li>
<li><code>event</code> - the event that triggered the machine</li>
<li><code>timers</code> - a variable to start and stop timers</li>
</ul>
<p>The listing below shows the transition function for a simple example. (Ignore the parameter <code>self</code> for now.) Within the method, we place first an if-statement which distinguishes the different states of the machine. It has one branch for each state. Within each state branch, there is another if-statement, which distinguishes the different events.</p>

<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"></code></pre></div>

<p>Within these branches, we then do actions;</p>
<ul>
<li>start a timer</li>
<li>stop a timer</li>
<li>call a function to do something in the Microbit, like switching on an LED</li>
<li>change a variable (use self)</li>
</ul>

<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">class</span> StateMachineA(StateMachine):</a>
<a class="sourceLine" id="cb1-2" title="2">    </a>
<a class="sourceLine" id="cb1-3" title="3">    <span class="kw">def</span> step(<span class="va">self</span>, state, event, timers):</a>
<a class="sourceLine" id="cb1-4" title="4">        <span class="cf">if</span> state <span class="op">==</span> <span class="st">&quot;initial&quot;</span>:</a>
<a class="sourceLine" id="cb1-5" title="5">            state <span class="op">=</span> <span class="st">&quot;s1&quot;</span></a>
<a class="sourceLine" id="cb1-6" title="6">        <span class="cf">elif</span> state <span class="op">==</span> <span class="st">&quot;s1&quot;</span>:</a>
<a class="sourceLine" id="cb1-7" title="7">            <span class="cf">if</span> event <span class="op">==</span> <span class="st">&quot;t1&quot;</span>:</a>
<a class="sourceLine" id="cb1-8" title="8">                <span class="va">self</span>.start_timer(<span class="st">&quot;t2&quot;</span>, <span class="dv">3000</span>)</a>
<a class="sourceLine" id="cb1-9" title="9">                display.show(event)</a>
<a class="sourceLine" id="cb1-10" title="10">                <span class="va">self</span>.state <span class="op">=</span> <span class="st">&quot;s2&quot;</span></a>
<a class="sourceLine" id="cb1-11" title="11">            <span class="cf">elif</span> event <span class="op">==</span> <span class="st">&quot;C&quot;</span>:</a>
<a class="sourceLine" id="cb1-12" title="12">                <span class="va">self</span>.start_timer(<span class="st">&quot;t1&quot;</span>, <span class="dv">1000</span>)</a>
<a class="sourceLine" id="cb1-13" title="13">        <span class="cf">elif</span> <span class="va">self</span>.state <span class="op">==</span> <span class="st">&quot;s2&quot;</span>:</a>
<a class="sourceLine" id="cb1-14" title="14">            <span class="cf">if</span> event <span class="op">==</span> <span class="st">&quot;t2&quot;</span>:</a>
<a class="sourceLine" id="cb1-15" title="15">                <span class="va">self</span>.start_timer(<span class="st">&quot;t1&quot;</span>, <span class="dv">1000</span>)</a>
<a class="sourceLine" id="cb1-16" title="16">                display.show(event)</a>
<a class="sourceLine" id="cb1-17" title="17">                <span class="va">self</span>.state <span class="op">=</span> <span class="st">&quot;s1&quot;</span></a></code></pre></div>

<p>We are going to</p>

    </section>
</div>


<footer></footer>
</body>
</html>
