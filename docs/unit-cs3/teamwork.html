<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="">
  <meta name="author" content="">
  <meta name="generator" content="">
  <title>TTM4175</title>
  <link rel="canonical" href="https://edu.iik.ntnu.no">
  <!-- Bootstrap core CSS -->
  <link href="../assets/bootstrap.min.css" rel="stylesheet">
  <!-- Custom styles for this template -->
  <link href="../assets/style-frame.css" rel="stylesheet">
  <link href="../assets/style-fonts.css" rel="stylesheet">
  <link href="../assets/style-code.css" rel="stylesheet">
  <link rel="stylesheet" href="../assets/bootstrap-icons.css">
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
    integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
    crossorigin="anonymous"></script>
  <script src="../assets/anchor.js"></script>
  <script src="../assets/clipboard.min.js"></script>
  <script src="../assets/script-aside.js"></script>
  <style></style>
</head>

<body>





  <nav class="navbar navbar-expand-lg navbar shadow-sm">
    <div class="container-fluid">
      <a class="navbar-brand" href="https://ntnu.edu" title="NTNU Homepage">
        <img id="header_logo" alt="NTNU Hjemmeside" width="120"
          src="https://www.ntnu.no/o/ntnu-theme/images/logo_ntnu.svg" height="23">
      </a>

      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavDropdown"
        aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-list"
            viewBox="0 0 16 16">
            <path fill-rule="evenodd"
              d="M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5z" />
          </svg>
        </span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNavDropdown">
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link" href="../index.html">TTM4175</a>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              Teknostart
            </a>
            <ul class="dropdown-menu dropdown-menu">
              <li><a class="dropdown-item" href="../teknostart/index.html">Teknostart oversikt</a></li>
              <li>
                <div class="dropdown-divider"></div>
              </li>
              <li><a class="dropdown-item" href="../teknostart/day1.html">Teknostart Dag 1</a></li>
              <li><a class="dropdown-item" href="../teknostart/day2.html">Teknostart Dag 2</a></li>
              <li><a class="dropdown-item" href="../teknostart/day3.html">Teknostart Dag 3</a></li>
              <li><a class="dropdown-item" href="../teknostart/day4.html">Teknostart Dag 4</a></li>
            </ul>
          </li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              Units
            </a>
            <ul class="dropdown-menu dropdown-menu">
              <a class="dropdown-item" href="../units.html">Oversikt</a>
              <div class="dropdown-divider"></div>
              <a class="dropdown-item" href="../unit-cli/index.html">Lab 1: Linux CLI</a>
              <a class="dropdown-item" href="../unit-net1/index.html">Lab 2: IPs, LAN</a>
              <a class="dropdown-item" href="../unit-net2/index.html">Lab 3: Ports, Web Servers</a>
              <a class="dropdown-item" href="../unit-net3/index.html">Lab 4: Routing, DNS</a>
              <div class="dropdown-divider"></div>
              <a class="dropdown-item" href="../unit-p1/index.html">IoT and the Microbit</a>
              <a class="dropdown-item" href="../unit-p2/index.html">State Machines</a>
              <a class="dropdown-item" href="../unit-p3/index.html">HTTP and JSON</a>
              <a class="dropdown-item" href="../unit-p4/index.html">MQTT</a>
              <div class="dropdown-divider"></div>
              <a class="dropdown-item" href="../unit-cs1/index.html">Cybersecurity 1: Intro and Ethical Hacking</a>
              <a class="dropdown-item" href="../unit-cs2/index.html">Cybersecurity 2: Information Gathering</a>
              <a class="dropdown-item" href="../unit-cs3/index.html">Cybersecurity 3: Exploitation</a>
            </ul>
          </li>



          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              Learning
            </a>
            <ul class="dropdown-menu dropdown-menu">
              <li><a class="dropdown-item" href="../learning/learning.html">Læring</a></li>
              <li><a class="dropdown-item" href="../learning/reports.html">Rapporter</a></li>
            </ul>
          </li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              Tools
            </a>
            <ul class="dropdown-menu dropdown-menu">
              <li><a class="dropdown-item" href="../tools/index.html">Tools</a></li>
              <!--<li><a class="dropdown-item" href="../tools/tools-python.html">Python</a></li>-->
              <li><a class="dropdown-item" href="../tools/tools-gui.html">GUIs in Python</a></li>
              <li><a class="dropdown-item" href="../tools/tools-mqtt.html">MQTT</a></li>
              <li><a class="dropdown-item" href="../tools/tools-notebooks.html">Notebooks</a></li>
              <li><a class="dropdown-item" href="../tools/tools-stmpy.html">STMPY</a></li>
            </ul>
          </li>
        </ul>
        <div class="bg-light border ms-auto"></div>
        <div>
          <a class="nav-link" href="../schedule.html"><svg xmlns="http://www.w3.org/2000/svg" width="16"
              height="16" fill="currentColor" class="bi bi-calendar3" viewBox="0 0 16 16">
              <path
                d="M14 0H2a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2zM1 3.857C1 3.384 1.448 3 2 3h12c.552 0 1 .384 1 .857v10.286c0 .473-.448.857-1 .857H2c-.552 0-1-.384-1-.857V3.857z" />
              <path
                d="M6.5 7a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm-9 3a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm-9 3a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2zm3 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2z" />
            </svg></a>
        </div>
      </div>
    </div>
  </nav>

  <main class="container container-max-width">
    <section class="mt-5 mb-5 py-3">
<div class="row g-0 my-3"><div class="col-md-8 px-4 chunk"><h1>Exploiting Injection Attacks</h1>
<p>In this section we will learn about injections vulnerabilities and how to exploit them. We will focus on one type of injection vulnerabilities that is called, SQLi (SQL Injection). Frist, we will try to do manual exploitation, and then use a tool (sqlmap).
The lab setting is similar to the lab setting you had in the last week: Kali connected to Metasploitable. Please make sure that both machines use &quot;Host-only&quot; adapter in VirtualBox.  When you start metaspolitable, you will be given access to the CLI. You can login using the following username/password: msfadmin/msfadmin. You need also to check the IP addresses of both machines using <code>ifconfig</code>. Note both IP addresses and try to check the connection between them by using <code>ping</code> command.</p>
<p>Metasplitable runs various vulnerable web applications and databases. The web server starts automatically when the machine is booted. To access these web applications, Open a web browser in Kali machine, e.g., Firefox, and enter the following URL <code>http://&lt;MetasploitableIP&gt;</code>. If the connection is successful, a web page will open that lists the vulnerable machines which are:</p>
<ul>
<li>TWiki</li>
<li>phpMyAdmin</li>
<li>mutillidae</li>
<li>DVWA</li>
<li>WebDav</li>
</ul>
<p>If you click on each link you will be directed to the respective web application. The applications are installed in the <code>/var/www</code> folder.</p>
<h2>Configuring the database</h2>
<p>Before you start, you also need to do a minor change in the configuration in the metasploitable machine for the mutillidae application:</p>
<p>After you have logged in to metasploitable, open the &quot;config.inc&quot; with the following command:</p>
</div><aside class="col-md-4 chunk ps-2"></aside></div>
<div class="row g-0 my-3"><div class="col-md-8 px-4 chunk"><div class="source-code-frame mt-3 mb-3">
<pre class="d-none" id="idc18c12">sudo nano /var/www/mutillidae/config.inc
</pre>
<button type="button" class="copy-button" data-clipboard-target="#idc18c12">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16">
  		<path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"></path>
  		<path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"></path>
	</svg>
</button>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> nano /var/www/mutillidae/config.inc</span></code></pre></div>
</div></div><aside class="col-md-4 chunk ps-2"></aside></div>
<div class="row g-0 my-3"><div class="col-md-8 px-4 chunk"><p>Once nano opens the config.inc file, replace ‘metasploit’ in the line $dbname = ‘metasploit’ with ‘owasp10’. The line should look like:</p>
</div><aside class="col-md-4 chunk ps-2"></aside></div>
<div class="row g-0 my-3"><div class="col-md-8 px-4 chunk"><div class="source-code-frame mt-3 mb-3">
<pre class="d-none" id="id3b874e">$dbname = ‘owasp10’;
</pre>
<button type="button" class="copy-button" data-clipboard-target="#id3b874e">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16">
  		<path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"></path>
  		<path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"></path>
	</svg>
</button>
<pre><code>$dbname = ‘owasp10’;</code></pre>
</div></div><aside class="col-md-4 chunk ps-2"></aside></div>
<div class="row g-0 my-3"><div class="col-md-8 px-4 chunk"><p>Now, save and exit (CTRL+X). Then you reset the apache server</p>
</div><aside class="col-md-4 chunk ps-2"></aside></div>
<div class="row g-0 my-3"><div class="col-md-8 px-4 chunk"><div class="source-code-frame mt-3 mb-3">
<pre class="d-none" id="id06ad1e">sudo /etc/init.d/apache2 reload

</pre>
<button type="button" class="copy-button" data-clipboard-target="#id06ad1e">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16">
  		<path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"></path>
  		<path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"></path>
	</svg>
</button>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> /etc/init.d/apache2 reload</span></code></pre></div>
</div></div><aside class="col-md-4 chunk ps-2"></aside></div>
<div class="row g-0 my-3"><div class="col-md-8 px-4 chunk"><h2>Simple SQL Injection</h2>
<p>Now, go back to kali, open a browser and visit the &quot;mutillidae&quot; application as explained above. Click  on &quot;toggle hints&quot; to get hints, and also make sure you work with the security level 0. If not click on &quot;toggle security&quot; to change the level.</p>
<p>To test that the user accounts table works fine, go to &quot;Login/Register&quot; and then click on &quot;Please register here&quot; button. Enter the username/pasword: tom/tom, and click on &quot;create account&quot;. If this is successful, you will get the message
&quot;Account created for tom. 1 rows inserted.&quot;</p>
<p>Now, in the left bar, go to
&quot;OWASP Top 10 &gt; A1 Injection &gt; SQLi - Extract Data &gt; User Info&quot;, you will be directed to login form (username / password). Try to login with the newly created user, and you should get the account information.</p>
</div><aside class="col-md-4 chunk ps-2"></aside></div>
<div class="row g-0 my-3"><div class="col-md-8 px-4 chunk"><p>Let us try now simple SQLi. Let start by entering a single quote &quot; ' &quot;, or a name followed by single quote, like &quot;Mike'&quot;, in the name field and see what will happen! You can see that the login was not successful and you are presented with an error message that includes some information, what information you get in the error message? Inspect the information related to the &quot;file&quot; and the &quot;Diagnostic Information&quot;. What is the SQL statement that was sent to the server?</p>
<p>You can see that the query that is sent to the server looks like this:</p>
</div><aside class="col-md-4 chunk ps-2"></aside></div>
<div class="row g-0 my-3"><div class="col-md-8 px-4 chunk"><div class="source-code-frame mt-3 mb-3">
<pre class="d-none" id="id79326e">SELECT * FROM accounts WHERE username='<Name input>' AND password='<password input>'
</pre>
<button type="button" class="copy-button" data-clipboard-target="#id79326e">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16">
  		<path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"></path>
  		<path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"></path>
	</svg>
</button>
<pre><code>SELECT * FROM accounts WHERE username=&#39;&lt;Name input&gt;&#39; AND password=&#39;&lt;password input&gt;&#39;</code></pre>
</div></div><aside class="col-md-4 chunk ps-2"></aside></div>
<div class="row g-0 my-3"><div class="col-md-8 px-4 chunk"><p>That request selects all (*) the columns (<em>username</em>, <em>password</em>)  from the <em>accounts</em> table  for any record that has a username that is the same as the username provided AND a password the same as the password provided.</p>
</div><aside class="col-md-4 chunk ps-2"></aside></div>
<div class="row g-0 my-3"><div class="col-md-8 px-4 chunk"><h3>Data Retrieval</h3>
<p>Now, we want to create a malicious input instead of username text. The classical example for this malicious exploit is the following input  <code>' OR 1=1 --</code> or <code>' OR 1=1 #</code> (please note the space at the end).
Let us try this input.
Enter  <code>' OR 1=1 --</code> in the &quot;Name&quot; filed and nothing in the &quot;Password&quot; field and click on &quot;View Account Details&quot;. What is the output of this command?</p>
<p>The output is actually a dump of all records in the <em>accounts</em> table.
What happened?</p>
<p>To search for only the admin user, we can put in the Name field <code>admin’#</code>.
What will you get?</p>
<p>This simple injection attack allowed the attacker to retrieve sensitive data and bypassing authentication. If you want to learn more advanced statements that you can manually inject to retrieve database names, and other important information, please check the following tutorial (Optional, it requires some knowledge of SQL.)</p>
</div><aside class="col-md-4 chunk ps-2"></aside></div>
<div class="row g-0 my-3"><div class="col-md-8 px-4 chunk"><div class="card mt-3 mb-3">
<div class="card-body">
<a href="https://tanvitrivedi.medium.com/sql-injection-in-mutillidae-af0411367949" class="stretched-link">
<svg width="16" height="16" xmlns="http://www.w3.org/2000/svg" class="bi bi-file-earmark-text" viewBox="0 0 16 16" id="file-earmark-text"><path d="M5.5 7a.5.5 0 0 0 0 1h5a.5.5 0 0 0 0-1h-5zM5 9.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h2a.5.5 0 0 1 0 1h-2a.5.5 0 0 1-.5-.5z" /><path d="M9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V4.5L9.5 0zm0 1v2A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5z" /></svg>
<span class="ms-3">Tutorial: SQL Injection in Mutillidae</span>
</a>
</div>
</div></div><aside class="col-md-4 chunk ps-2"></aside></div>
<div class="row g-0 my-3"><div class="col-md-8 px-4 chunk"><h2>SQL Injection with a tool (SQLmap)</h2>
<p>SQLmapp is an SQL injection command line tool, included in Kali linux.
To get an introduction to the tool, <a href="https://github.com/sqlmapproject/sqlmap/wiki/Usage">please check the usage information</a>.</p>
<p>First check the sqlmap version, and show the help by running the command</p>
</div><aside class="col-md-4 chunk ps-2"></aside></div>
<div class="row g-0 my-3"><div class="col-md-8 px-4 chunk"><div class="source-code-frame mt-3 mb-3">
<pre class="d-none" id="id564fbd">sqlmap --version
sqlmap --help
</pre>
<button type="button" class="copy-button" data-clipboard-target="#id564fbd">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16">
  		<path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"></path>
  		<path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"></path>
	</svg>
</button>
<pre><code>sqlmap --version
sqlmap --help</code></pre>
</div></div><aside class="col-md-4 chunk ps-2"></aside></div>
<div class="row g-0 my-3"><div class="col-md-8 px-4 chunk"><p>Let us try the page that we targeted manually in the last task, by running the following command,</p>
</div><aside class="col-md-4 chunk ps-2"></aside></div>
<div class="row g-0 my-3"><div class="col-md-8 px-4 chunk"><div class="source-code-frame mt-3 mb-3">
<pre class="d-none" id="id925ae6">sqlmap -u "http://192.168.56.3/mutillidae/index.php?page=user-info.php"
</pre>
<button type="button" class="copy-button" data-clipboard-target="#id925ae6">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16">
  		<path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"></path>
  		<path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"></path>
	</svg>
</button>
<pre><code>sqlmap -u &quot;http://192.168.56.3/mutillidae/index.php?page=user-info.php&quot;</code></pre>
</div></div><aside class="col-md-4 chunk ps-2"></aside></div>
<div class="row g-0 my-3"><div class="col-md-8 px-4 chunk"><p>The command will prompt you with some question, just accept the options that sqlmap provides. What is the output that you get from the last command?</p>
<p>The comamnd tells us that &quot;all tested paramerters do not appear to be injectable. ...&quot;. However, we know, and tested manually, that usename is an injectable parameter. So, we will tell sqlmap about the injectable parameters we know. To do that we want to get the url with the parameters we want to use. Now go back to the browser and go back to the user-info.php page that we tested before. Enter any random values for &quot;Name&quot; and &quot;Password&quot;, say aa/bb, and click on  &quot;View Account Details&quot;. After that copy the url to use in sqlmap. The url will look like this (asuming 192.168.56.3 is the IP address of metasploitable):</p>
</div><aside class="col-md-4 chunk ps-2"></aside></div>
<div class="row g-0 my-3"><div class="col-md-8 px-4 chunk"><div class="source-code-frame mt-3 mb-3">
<pre class="d-none" id="id5185d5">http://192.168.56.3/mutillidae/index.php?page=user-info.php&username=aa&password=bb&user-info-php-submit-button=View+Account+Details
</pre>
<button type="button" class="copy-button" data-clipboard-target="#id5185d5">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16">
  		<path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"></path>
  		<path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"></path>
	</svg>
</button>
<pre><code>http://192.168.56.3/mutillidae/index.php?page=user-info.php&amp;username=aa&amp;password=bb&amp;user-info-php-submit-button=View+Account+Details</code></pre>
</div></div><aside class="col-md-4 chunk ps-2"></aside></div>
<div class="row g-0 my-3"><div class="col-md-8 px-4 chunk"><p>Now, we can see that sqlmap identified the DB as MySQL and detected that &quot;username&quot; parameter is vulnerable. How many HTTP requests sqlmap sent during the tests?</p>
<p>Now you can try the last command, but adding the following option &quot; --current-db&quot;. What do you notice? What is the name of the current database that sqlmap identified?</p>
<p>You can notice from the output that the name of the table is &quot;owasp10&quot;. Now, we want to run the following command to retrieve all tables from the identified database:</p>
</div><aside class="col-md-4 chunk ps-2"></aside></div>
<div class="row g-0 my-3"><div class="col-md-8 px-4 chunk"><div class="source-code-frame mt-3 mb-3">
<pre class="d-none" id="id7f9c2b"></pre>
<button type="button" class="copy-button" data-clipboard-target="#id7f9c2b">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16">
  		<path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"></path>
  		<path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"></path>
	</svg>
</button>
<p><code>sqlmap -u "http://192.168.56.3/mutillidae/index.php?page=user-info.php&amp;username=aa&amp;password=bb&amp;user-info-php-submit-button=View+Account+Details" -D owasp10 --tables</code></p>
</div></div><aside class="col-md-4 chunk ps-2"></aside></div>
<div class="row g-0 my-3"><div class="col-md-8 px-4 chunk"><p>How many tables does the &quot;owasp10&quot; database have?</p>
<p>One of the tables is called &quot;accounts&quot;, which we identified in the last task, and another one is called &quot;credit_cards&quot;, which sounds interesting :-). So, now we want to retrieve all data in those tables, and for that we use the options &quot;-T &quot; for the table name, and &quot;--dump&quot; for dumping the table conent. Run the command:</p>
</div><aside class="col-md-4 chunk ps-2"></aside></div>
<div class="row g-0 my-3"><div class="col-md-8 px-4 chunk"><div class="source-code-frame mt-3 mb-3">
<pre class="d-none" id="id7f9c2b"></pre>
<button type="button" class="copy-button" data-clipboard-target="#id7f9c2b">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16">
  		<path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"></path>
  		<path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"></path>
	</svg>
</button>
<p><code>sqlmap -u "http://192.168.56.3/mutillidae/index.php?page=user-info.php&amp;username=aa&amp;password=bb&amp;user-info-php-submit-button=View+Account+Details" -D owasp10 -T accounts --dump</code></p>
</div></div><aside class="col-md-4 chunk ps-2"></aside></div>
<div class="row g-0 my-3"><div class="col-md-8 px-4 chunk"><p>What is the output of the last command? How many admin accounts can you identify?</p>
<p>Now, try to retrieve all information for the credit_cards table! What is the command that you should run?</p>
<p>How many credit cards are stored in that table?</p>
<p>Finally, if you want to test and dump every table of every database on that server, you can use the option &quot;-all&quot;. You can try it later, as it will take a long time.</p>
</div><aside class="col-md-4 chunk ps-2"></aside></div>
</section>
<section class="mt-5 mb-5 py-3">
<div class="row g-0 my-3"><div class="col-md-8 px-4 chunk"><h1>Exploitation with Metasploit</h1>
</div><aside class="col-md-4 chunk ps-2"></aside></div>
<div class="row g-0 my-3"><div class="col-md-8 px-4 chunk"><p>Now, we want to use a general and very powerful tool to exploit various types of vulnerabilities, which is called &quot;Metasploit&quot;. From the last week we’ve found some vulnerabilities, and metasploit will help you exploit them. Metasploit comes preloaded with hundreds of exploits for known software vulnerabilities found in a large range of systems.</p>
<p>A lot of additional material on how to use Metasploit can be found at <a href="http://www.offensive-security.com/metasploit-unleashed">http://www.offensive-security.com/metasploit-unleashed</a>.
Some of the material in this lab are also taken from that site.</p>
<p>To ensure that we have the latest version of Metasploit installed, we first need to update it:</p>
</div><aside class="col-md-4 chunk ps-2"></aside></div>
<div class="row g-0 my-3"><div class="col-md-8 px-4 chunk"><div class="source-code-frame mt-3 mb-3">
<pre class="d-none" id="ida5f889">apt-get update                       % update the repository list
apt-get install metasploit-framework % update metasploit
service postgresql start             % metasploit uses a postresql database
msfdb init                           % initialize the database
</pre>
<button type="button" class="copy-button" data-clipboard-target="#ida5f889">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16">
  		<path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"></path>
  		<path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"></path>
	</svg>
</button>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">apt-get</span> update                       % update the repository list</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="ex">apt-get</span> install metasploit-framework % update metasploit</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="ex">service</span> postgresql start             % metasploit uses a postresql database</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="ex">msfdb</span> init                           % initialize the database</span></code></pre></div>
</div></div><aside class="col-md-4 chunk ps-2"></aside></div>
<div class="row g-0 my-3"><div class="col-md-8 px-4 chunk"><h2>Running Metasploit</h2>
<p>Start Metasploit by running <em>msfconsole</em>:</p>
</div><aside class="col-md-4 chunk ps-2"></aside></div>
<div class="row g-0 my-3"><div class="col-md-8 px-4 chunk"><div class="source-code-frame mt-3 mb-3">
<pre class="d-none" id="id97579b">
You will soon be greeted by an ASCII welcome logo.
You are now in the Metasploit command console. At any point you can type help or ? to get a list of all available commands. The console functions pretty much like normal Linux terminal.

## Searching for exploits

Metasploit comes with a large number of pre-made exploits (or modules) that you can use. 

To find a particular exploit, type search followed by a keyword. For example, to search for FTP exploits for Linux type the following command:

</pre>
<button type="button" class="copy-button" data-clipboard-target="#id97579b">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16">
  		<path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"></path>
  		<path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"></path>
	</svg>
</button>
<p><code># msfconsole</code></p>
<p>You will soon be greeted by an ASCII welcome logo. You are now in the Metasploit command console. At any point you can type help or ? to get a list of all available commands. The console functions pretty much like normal Linux terminal.</p>
<h2 id="searching-for-exploits">Searching for exploits</h2>
<p>Metasploit comes with a large number of pre-made exploits (or modules) that you can use.</p>
<p>To find a particular exploit, type search followed by a keyword. For example, to search for FTP exploits for Linux type the following command:</p>
<p>```</p>
</div></div><aside class="col-md-4 chunk ps-2"></aside></div>
<div class="row g-0 my-3"><div class="col-md-8 px-4 chunk"><p>msf &gt; search platform:unix platform:linux type:exploit ftp</p>
</div><aside class="col-md-4 chunk ps-2"></aside></div>
<div class="row g-0 my-3"><div class="col-md-8 px-4 chunk"><div class="source-code-frame mt-3 mb-3">
<pre class="d-none" id="id4249cd">
We use both Unix and Linux as platform since most exploits categorized as Unix will work on Linux.

As we saw earlier (during the Nmap scan) our victim runs two FTP servers, so this might be a good start for us.

For more information about the search command, [see here](https://www.offensive-security.com/metasploit-unleashed/msfconsole-commands/#search).

## Using an exploit - How it works

We will first explain the steps needed to use an exploit. Then we will apply these steps to gain remote access to the victim machine using backdoored FTP server. 

Once you have found an exploit that looks promising you need to tell Metasploit how it should be executed. 

The steps for using an exploit are the following:

1. Tell Metasploit which module you want to try with the *use* command:

</pre>
<button type="button" class="copy-button" data-clipboard-target="#id4249cd">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16">
  		<path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"></path>
  		<path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"></path>
	</svg>
</button>
<p>```</p>
<p>We use both Unix and Linux as platform since most exploits categorized as Unix will work on Linux.</p>
<p>As we saw earlier (during the Nmap scan) our victim runs two FTP servers, so this might be a good start for us.</p>
<p>For more information about the search command, <a href="https://www.offensive-security.com/metasploit-unleashed/msfconsole-commands/#search">see here</a>.</p>
<h2 id="using-an-exploit---how-it-works">Using an exploit - How it works</h2>
<p>We will first explain the steps needed to use an exploit. Then we will apply these steps to gain remote access to the victim machine using backdoored FTP server.</p>
<p>Once you have found an exploit that looks promising you need to tell Metasploit how it should be executed.</p>
<p>The steps for using an exploit are the following:</p>
<ol type="1">
<li>Tell Metasploit which module you want to try with the <em>use</em> command:</li>
</ol>
<p>```bash</p>
</div></div><aside class="col-md-4 chunk ps-2"></aside></div>
<div class="row g-0 my-3"><div class="col-md-8 px-4 chunk"><p>msf &gt; use exploit/platform/service/exploit_name
msf exploit(exploit_name) &gt;</p>
</div><aside class="col-md-4 chunk ps-2"></aside></div>
<div class="row g-0 my-3"><div class="col-md-8 px-4 chunk"><div class="source-code-frame mt-3 mb-3">
<pre class="d-none" id="idf0cc3a">
2. Use the *show options* command to see the parameters that the module uses: 

</pre>
<button type="button" class="copy-button" data-clipboard-target="#idf0cc3a">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16">
  		<path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"></path>
  		<path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"></path>
	</svg>
</button>
<p>```</p>
<ol start="2" type="1">
<li>Use the <em>show options</em> command to see the parameters that the module uses:</li>
</ol>
<p>```bash</p>
</div></div><aside class="col-md-4 chunk ps-2"></aside></div>
<div class="row g-0 my-3"><div class="col-md-8 px-4 chunk"><p>msf exploit(exploit_name) &gt; show options</p>
</div><aside class="col-md-4 chunk ps-2"></aside></div>
<div class="row g-0 my-3"><div class="col-md-8 px-4 chunk"><div class="source-code-frame mt-3 mb-3">
<pre class="d-none" id="id8bbd26">
3. With the help of the *set* command, set the *RHOST* parameter to the IP address of the victim, i.e., metasploiable machine: 

</pre>
<button type="button" class="copy-button" data-clipboard-target="#id8bbd26">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16">
  		<path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"></path>
  		<path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"></path>
	</svg>
</button>
<p>```</p>
<ol start="3" type="1">
<li>With the help of the <em>set</em> command, set the <em>RHOST</em> parameter to the IP address of the victim, i.e., metasploiable machine:</li>
</ol>
<p>```bash</p>
</div></div><aside class="col-md-4 chunk ps-2"></aside></div>
<div class="row g-0 my-3"><div class="col-md-8 px-4 chunk"><p>msf exploit(exploit_name) &gt; set RHOST &lt;IP_address_victim_machine&gt;</p>
</div><aside class="col-md-4 chunk ps-2"></aside></div>
<div class="row g-0 my-3"><div class="col-md-8 px-4 chunk"><div class="source-code-frame mt-3 mb-3">
<pre class="d-none" id="ida38cd2">
4. type *run* to run the exploit

# Example: Using backdoored FTP server

Having done a vulnerability scan, it’s time to do the actual “hacking”. Your task is now to gain remote access to the Metasploitable machine and make your access persistent.

Backdoors are methods of bypassing the security of a software program or operating system. They are like normal exploits, but they are deliberately part of the software.

Metasploitable has a backdoored version of vsftpd installed and running. If you look back at the vulnerability scan you’ll see that Nessus discovered the backdoor and flagged it as a “Critical” vulnerability.

## Using the backdoor with metasploit

Metasploit has a module that makes it easy to take advantage of this backdoor.

+ Use the following command to search for vsftpd: `msf > search vsftpd`

+ specify the name of the exploit we want to use: `msf > use exploit/unix/ftp/vsftpd_234_backdoor`

+ Set the target IP-address: `msf exploit(vsftpd_234_backdoor) > set RHOST <IP_address_victim_machine>`

+ Run the exploit: `msf exploit(vsftpd_234_backdoor) > run`

You can see from the last line on the screen that the backdoor worked and a shell was open at port 6200 on the victim machine. You are now connected to that shell and can type any commands you want. 

+ Using the command *whoami*, check which user you are running as. You will find out that you are logged in as "root", which means that vsftpd was running with root privileges.

+ Check that you are actually running commands on the remote machine (Metasploitable) and not locally by running the command  `hostname`

+ Try putting the Kali and Metasploitable windows side by side, run the “reboot” command. 

You will notice that when you rebooted Metasploitable, the backdoor shell stopped working. To gain access to the machine we would have to run the exploit again which might be problematic. We need therefore to make our access persistent.

## Making our access persistent

As we saw in the Nmap scan, the victim is already running both SSH and Telnet, so the easiest way to gain persistent access is by adding an extra user to the system.

+ Run the exploit again to get the backdoor shell back, then run the following commands:

</pre>
<button type="button" class="copy-button" data-clipboard-target="#ida38cd2">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16">
  		<path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"></path>
  		<path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"></path>
	</svg>
</button>
<p>```</p>
<ol start="4" type="1">
<li>type <em>run</em> to run the exploit</li>
</ol>
<h1 id="example-using-backdoored-ftp-server">Example: Using backdoored FTP server</h1>
<p>Having done a vulnerability scan, it’s time to do the actual “hacking”. Your task is now to gain remote access to the Metasploitable machine and make your access persistent.</p>
<p>Backdoors are methods of bypassing the security of a software program or operating system. They are like normal exploits, but they are deliberately part of the software.</p>
<p>Metasploitable has a backdoored version of vsftpd installed and running. If you look back at the vulnerability scan you’ll see that Nessus discovered the backdoor and flagged it as a “Critical” vulnerability.</p>
<h2 id="using-the-backdoor-with-metasploit">Using the backdoor with metasploit</h2>
<p>Metasploit has a module that makes it easy to take advantage of this backdoor.</p>
<ul>
<li><p>Use the following command to search for vsftpd: <code>msf &gt; search vsftpd</code></p></li>
<li><p>specify the name of the exploit we want to use: <code>msf &gt; use exploit/unix/ftp/vsftpd_234_backdoor</code></p></li>
<li><p>Set the target IP-address: <code>msf exploit(vsftpd_234_backdoor) &gt; set RHOST &lt;IP_address_victim_machine&gt;</code></p></li>
<li><p>Run the exploit: <code>msf exploit(vsftpd_234_backdoor) &gt; run</code></p></li>
</ul>
<p>You can see from the last line on the screen that the backdoor worked and a shell was open at port 6200 on the victim machine. You are now connected to that shell and can type any commands you want.</p>
<ul>
<li><p>Using the command <em>whoami</em>, check which user you are running as. You will find out that you are logged in as “root”, which means that vsftpd was running with root privileges.</p></li>
<li><p>Check that you are actually running commands on the remote machine (Metasploitable) and not locally by running the command <code>hostname</code></p></li>
<li><p>Try putting the Kali and Metasploitable windows side by side, run the “reboot” command.</p></li>
</ul>
<p>You will notice that when you rebooted Metasploitable, the backdoor shell stopped working. To gain access to the machine we would have to run the exploit again which might be problematic. We need therefore to make our access persistent.</p>
<h2 id="making-our-access-persistent">Making our access persistent</h2>
<p>As we saw in the Nmap scan, the victim is already running both SSH and Telnet, so the easiest way to gain persistent access is by adding an extra user to the system.</p>
<ul>
<li>Run the exploit again to get the backdoor shell back, then run the following commands:</li>
</ul>
<p>```bash</p>
</div></div><aside class="col-md-4 chunk ps-2"></aside></div>
<div class="row g-0 my-3"><div class="col-md-8 px-4 chunk"><p>useradd ttm4175 % Add 'ttm175' as a new user
passwd ttm4175 % Set the password for the new user
usermod -aG sudo ttm4175 % Add the user to the 'admin' group, this is equivalent to being root
reboot</p>
</div><aside class="col-md-4 chunk ps-2"></aside></div>
<div class="row g-0 my-3"><div class="col-md-8 px-4 chunk"><div class="source-code-frame mt-3 mb-3">
<pre class="d-none" id="id9589f9">
The second command will ask you to enter a password for the new user.

+ After running the reboot command, wait until Metasploitable has rebooted and then try to login with for example telnet: `telnet <IP_address_victim_machine>`

+ After logging in, test that you still can get root access:

</pre>
<button type="button" class="copy-button" data-clipboard-target="#id9589f9">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16">
  		<path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"></path>
  		<path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"></path>
	</svg>
</button>
<p>```</p>
<p>The second command will ask you to enter a password for the new user.</p>
<ul>
<li><p>After running the reboot command, wait until Metasploitable has rebooted and then try to login with for example telnet: <code>telnet &lt;IP_address_victim_machine&gt;</code></p></li>
<li><p>After logging in, test that you still can get root access:</p></li>
</ul>
<p>```bash</p>
</div></div><aside class="col-md-4 chunk ps-2"></aside></div>
<div class="row g-0 my-3"><div class="col-md-8 px-4 chunk"><p>$ sudo su % Switch to the root user, 'su' means substitute user</p>
</div><aside class="col-md-4 chunk ps-2"></aside></div>
</section>
<section class="mt-5 mb-5 py-3">
<div class="row g-0 my-3"><div class="col-md-8 px-4 chunk"><h1>whoami</h1>
</div><aside class="col-md-4 chunk ps-2"></aside></div>
<div class="row g-0 my-3"><div class="col-md-8 px-4 chunk"><div class="source-code-frame mt-3 mb-3">
<pre class="d-none" id="ide56dd0">
</pre>
<button type="button" class="copy-button" data-clipboard-target="#ide56dd0">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16">
  		<path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"></path>
  		<path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"></path>
	</svg>
</button>
<p>```</p>
<p>The last command should print “root” if successful.</p>
</div></div><aside class="col-md-4 chunk ps-2"></aside></div>
</section>
  </main>



  <nav class="navbar navbar-expand-lg navbar-dark fixed-bottom" style="background-color: #555555">
    <div class="container-fluid">
      <div class="collapse navbar-collapse">
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link" href="https://www.ntnu.no/informasjonskapsler">Om informasjonskapsler</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="https://www.ntnu.no/personvern">Personvern</a>
          </li>
        </ul>
        <div class="bg-light ms-auto border-0"></div>
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link" data-bs-toggle="offcanvas" href="#offcanvasExample" role="button"
              aria-controls="offcanvasExample">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                class="bi bi-pencil-square" viewBox="0 0 16 16">
                <path
                  d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z" />
                <path fill-rule="evenodd"
                  d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z" />
              </svg>
            </a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
  <div class="offcanvas offcanvas-end text-bg-dark" tabindex="-1" id="offcanvasExample"
    aria-labelledby="offcanvasExampleLabel">
    <div class="offcanvas-header">
      <h5 class="offcanvas-title" id="offcanvasExampleLabel">Edit this page</h5>
    </div>
    <div class="offcanvas-body">
      <ul>
        <li>This site is hosted on <a href="https://github.com/falkr/ttm4175">Github</a></li>
        <li>The source is written in <a href="../supermark/index.html">Supermark</a> syntax</li>
        <li>To edit this page, make a commit to <a
            href="https://github.com/falkr/ttm4175/tree/master/pages/unit-cs3/teamwork.md">this file</a></li>
      </ul>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
    crossorigin="anonymous"></script>
  <script>
    anchors.add('h1').add('h2').add('h3');
    anchors.options.visible = 'always';
    var clipboard = new ClipboardJS('.copy-button');
  </script>
  <script>
</script>
</body>

</html>