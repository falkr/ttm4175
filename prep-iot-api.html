<html lang="en-US"><head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1"/>

<title>TTM4175</title>
<meta property="og:title" content="TTM4115">
<meta property="og:locale" content="en_US">
<meta name="description" content="Design of Communicating Systems">
<meta property="og:description" content="Design of Communicating Systems">


<!--<link rel="stylesheet" type="text/css" href="style.css" />-->
<link href="https://fonts.googleapis.com/css?family=Merriweather:400,400italic,700,700italic|Source+Code+Pro|Source+Sans+Pro:200,300,400,600,400italic,600italic|Rock+Salt" rel="stylesheet" type="text/css">


<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>


<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.1/css/all.css" integrity="sha384-gfdkjb5BdAXd+lj+gudLWI+BXq4IuLW5IT+brZEZsLFm++aCMlF1V92rMkPaX4PP" crossorigin="anonymous">

<link rel="stylesheet" type="text/css" href="assets/style.css" />

<!--<script src="jquery-1.10.1.min.js"></script>-->
<script src="assets/script-aside.js"></script>
</head>
<body id="top">

<nav class="navbar navbar-expand-md navbar-dark " style="background-color:#666666"#2B65EC"> <!-- fixed-top -->
        <ul class="nav nav-pills">
        <li class="nav-item">
    <a class="nav-link" href="index.html" style="font-weight: bold")>TTM4175</a>
  </li>

  <li class="nav-item dropdown">
    <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">Teknostart</a>
    <div class="dropdown-menu">
      <a class="dropdown-item" href="day0-2020.html">Dag 0: Getting Started</a>
      <a class="dropdown-item" href="day1-2020.html">Dag 1: Virtual Box</a>
      <a class="dropdown-item" href="day2-2020.html">Dag 2: Linux Command Line</a>
      <a class="dropdown-item" href="day3-2020.html">Dag 3: SSH and HTML</a>
      <div class="dropdown-divider"></div>
      <a class="dropdown-item" href="tips.html">Tips</a>
    </div>
  </li>
        
  <li class="nav-item dropdown">
    <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">Preparation</a>
    <div class="dropdown-menu">
      <a class="dropdown-item disabled"><strong>Networking</strong></a>
      <a class="dropdown-item" href="prep-networking-1-2020.html">IPs and Subnets</a>
      <a class="dropdown-item" href="prep-networking-2-2020.html">Routing and Docker</a>
      <a class="dropdown-item" href="prep-networking-3-2020.html">Webservers and DNS</a>
      <div class="dropdown-divider"></div>
      <a class="dropdown-item disabled"><strong>Security</strong></a>
      <a class="dropdown-item" href="prep-security-1.html">Security 1: Cyber Security and Ethical Hacking </a>
      <a class="dropdown-item" href="prep-security-2.html">Security 2: Authentication, Authorization, and Password Storage</a>
      <a class="dropdown-item" href="prep-security-3.html">Security 3: Passwords and Cryptography</a>
      <a class="dropdown-item" href="prep-security-4.html">Security 4: Security Vulnerabilities</a>
      <div class="dropdown-divider"></div>
      <a class="dropdown-item disabled"><strong>Internet of Things</strong></a>
      <a class="dropdown-item" href="prep-iot-intro.html">IoT 1: Introduction</a>
      <a class="dropdown-item" href="prep-iot-http-json.html">IoT 2: HTTP and JSON</a>
      <a class="dropdown-item" href="prep-iot-mqtt.html">IoT 3: MQTT</a>
      <a class="dropdown-item" href="prep-iot-api.html">IoT 4: APIs</a>
      <a class="dropdown-item" href="prep-iot-nb-iot.html">NB-IoT (Extra)</a>
    </div>
  </li>
  
  <li class="nav-item dropdown">
    <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">Activities</a>
    <div class="dropdown-menu">
        <a class="dropdown-item disabled"><strong>Networking</strong></a>
        <a class="dropdown-item" href="networking-1-2020.html">IPs and Subnets</a>
        <a class="dropdown-item" href="networking-2-2020.html">Routing and Docker</a>
        <a class="dropdown-item" href="networking-3-2020.html">Webservers and DNS
        <div class="dropdown-divider"></div>
        <a class="dropdown-item disabled"><strong>Security</strong></a>
        <a class="dropdown-item" href="security-1.html">Security 1</a>
        <a class="dropdown-item" href="security-2.html">Security 2</a>
        <a class="dropdown-item" href="security-3.html">Security 3</a>
        <a class="dropdown-item" href="security-4.html">Security 4</a>
        <div class="dropdown-divider"></div>
        <a class="dropdown-item disabled"><strong>Internet of Things</strong></a>
        <a class="dropdown-item" href="iot-lopy.html">LoPy</a>
        <a class="dropdown-item" href="iot-http-json.html">HTTP and JSON</a>
        <a class="dropdown-item" href="iot-mqtt.html">MQTT</a>
		<a class="dropdown-item" href="iot-lorawan.html">LoRaWAN / NB-IoT</a>
        <a class="dropdown-item" href="iot-api.html">API</a>
      </div>
  </li>
  
  <li class="nav-item dropdown">
    <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">Material</a>
    <div class="dropdown-menu">
      <a class="dropdown-item" href="commands-help.html">Help on Commands</a>
      <a class="dropdown-item" href="commands.html">List of Commands</a>
      <a class="dropdown-item" href="computer-history.html">Extra Videos</a>
    </div>
  </li>
  
  <li class="nav-item dropdown">
    <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">Learning</a>
    <div class="dropdown-menu">
      <a class="dropdown-item" href="feedback.html">Tilbakemelding</a>
      <a class="dropdown-item" href="reports.html">Rapporter</a>
      <a class="dropdown-item" href="working-in-teams.html">Working in Teams</a>
      <a class="dropdown-item" href="smash.html">Finding the Smash Lab</a>
    </div>
  </li>
  
  <!--
  <li class="nav-item">
    <a class="nav-link" href="#">Blackboard</a>
  </li>-->
</ul>

<div class="navbar-nav flex-row ml-md-auto d-none d-md-flex"></div>
             <a class="navbar-brand" href="https://ntnu.edu">
      	<svg width="100" height="30">
      		<image xlink:href="https://innsida.ntnu.no/innsida-theme/images/ntnu-graphics/ntnu_logo_white.svg" 
      		src="https://innsida.ntnu.no/innsida-theme/images/ntnu-graphics/ntnu_logo_white.png" width="100%" height="100%"></image>
      	</svg>
      </a>
    </nav>


<div class="page">
    </section>
    <section class="content">
<h1 id="application-programming-interfaces-apis">Application Programming Interfaces: APIs</h1>
<p>This week we are going to construct an application that consists of several components, some running on the Raspberry Pi, others running on a server that we don’t even have control over. In particular, we are going to build an alarm application, which consists of a movement sensor, a webcam, and the Sense HAT to display an alarm. In addition, we want the alarm system to send a message via Slack, and also upload a picture to it. For that, we need to use the Slack API, so that we can integrate it into our application.</p>
<h2 id="learning-goals">Learning Goals</h2>

<div class="goals"><p>After this week, you will be able to:</p>
<ul>
<li>Read the documentation of an API and understand elements of it.</li>
<li>Understand <em>some</em> of the mechanisms of APIs.</li>
<li>Create simple applications from APIs.</li>
<li>Understand some of the principles of REST API.</li>
</ul>
</div>
    </section>
    <section class="content">
<h1 id="apis">APIs</h1>
<p>Most software systems are not constructed completely new every time. Instead, they consist of a set of reusable elements, also called <strong>components</strong>. And even if a system is constructed completely from scratch (without any reused code), it is much easier to construct it if it is made up of individual components.</p>
<p>Components can be many things. One examples are Python modules, as you have already used them. A Python module can encapsulate some functionality that your program can use. We used for instance a Python module that created a HTTP server, and another one to create an MQTT client. Components can also be offered by the operating system, for instance to read files or connect to the USB ports. Yet another example are <strong>distributed components</strong>, running on a different machine. You can for instance use Amazon’s cloud storage to store files of your application in a large data center.</p>
<p><em>So, systems are made from components. But how can we ensure that they work together properly?</em> This is where we use application programming interfaces (APIs).</p>
<p>An API is a description and sometimes some additional code to ensure that we use a software component correctly. Depending on how the component is implemented an offers its API, i.e., in which language, which underlying protocol and in which context, the description of APIs vary a lot. The API describes how to invoke a function, what kind of parameters to provide, and what to expect as a result. In Python, an API is given as a set of functions, but there are many other possibilities how an API can be built. A distributed API can be built from a set of requests (HTTP requests, for instance), or remote functions. Some programming languages or libraries offer support for <strong>remote procedure calls</strong>. This is a technique for calling a method or function on another computer as if the method was local, on the same computer.</p>
<p>Some APIs have only very few functions, while others may have thousands, depending on the complexity of the component to connect to. The following can be a complete API, for a very simple component that periodically sends a temperature update:</p>

<pre><code>TEMPERATURE API:
MQTT Broker: mqtt.example.com:1883
Subscribe to topic api/weather/temperature/json
Result will be messages in JSON, with format {&quot;temp&quot;: 21}</code></pre>

<h2 id="examples-for-web-based-apis">Examples for Web-based APIs</h2>
<p>There are many APIs available on the internet. Here are just three examples:</p>
<ul>
<li><p><strong>Slack</strong> This API is available at <a href="https://api.slack.com" class="uri">https://api.slack.com</a> and allows to integrate applications with the Slack messaging service. Applications can send messages to users, or have chat-based dialogs with them.</p></li>
<li><p><strong>AtB Sanntid</strong> Provides an API at <a href="https://www.atb.no/sanntid/#collapse-article_2">https://www.atb.no/sanntid/</a> that shows the current position of busses and expected arrivals at buss stops.</p></li>
<li><p><strong>Meteorologisk institutt</strong> provides a service with weather data and forecasts <a href="https://api.met.no" class="uri">https://api.met.no</a>.</p></li>
</ul>
<p><strong>Task:</strong> Browse through some of the links from the APIs above, and have a look what they offer you to do, and how they describe what you should do.</p>
<h2 id="apis-provide-abstraction">APIs Provide Abstraction</h2>
<p>APIs try to hide as much complexity of a problem as possible. With the example of our very simple temperature API, we can use the API without knowing how the details are implemented, for instance how the component measures the temperature, or how it processes our request. To use it properly, we are just interested in the behavior of the component as a “black box.” It is not always obvious which behavior we should hide or not — maybe we are very much interested how the temperature was measured, but that depends on the entire system.</p>
<p>Abstraction also allows that a component changes over time how it provides an API. It can for instance change details of the implementation without that the user of the API needs to adapt anything. (We come back to that later.)</p>
<h2 id="apis-are-written-with-use-cases-in-mind">APIs Are Written With Use Cases in Mind</h2>
<p>For an API to be useful, it should provide access to use cases that are relevant for the programs that use it. This means how the individual functions one can call are structured. For a math API, it seems to be a good idea to have a method <code>add(a, b)</code> to add two numbers. A method <code>add_two_(a)</code> which always adds the value two to a number is also possible, but you may wonder if it is useful for an API. That depends of course on the problem we build the API for. If the problem we want to support needs to add the number two a lot, then we could think of offering that as a dedicated method of the API. (It’ s a bit like organizing your stuff at home. Should you have an extra drawer for winter jackets? Or put all jackets together?). Therefore it requires some experience and some attempts to write a “good” API.</p>
<h2 id="apis-evolve-over-time">APIs Evolve Over Time</h2>
<p>We have said above that APIs evolve over time, and because of their way of hiding features this can often happen without the other programs noticing. However, that is not always the case. Sometimes the API itself has to change more drastically, so that we can offer new functionality. This is why APIs often have version numbers and evolve just like other software. Sometimes updating to a new version of an API is simple, while it sometimes may require a lot of changes.</p>
<h2 id="ingredients-for-an-api">Ingredients for an API</h2>
<p>What do we need when we want to build an API? Let’s have a look at a list of items we should think of before making an API:</p>
<ul>
<li><p>A description of the use cases: We should know which purposes our API should serve. What do the users of our API want to do? Which kind of data do they have? What kind of result do they expect?</p></li>
<li><p>A library or framework or technology to offer the API. We need to understand how we want to offer our API. Is it a library that runs locally on a computer, for instance as Python module? Or is it a distributed API that we want to offer on a server?</p></li>
<li><p>A language for the API. How do we want to describe the API? When we use Python, we show the signatures of the functions, together with some documentation code. When it is a distributed API, we need some other technology. There also exist frameworks that generate nice web pages as documentation, for instance by parsing programming code and its documentation.</p></li>
<li><p>Examples. To get the use cases right, we often need a lot of examples for possible uses so we don’t forget anything. Once a programmer is familiar with the technology behind an API, these examples can be the hardest thing to get, and understanding of them may evolve over time, which is why there can come a new version of an API.</p></li>
</ul>

    </section>
    <section class="content">
<h1 id="the-slack-api">The Slack API</h1>
<p>Slack is a messaging application that allows to integrate other platforms to integrate via APIs. It is simple, for instance, to add so-called <em>bots</em> to the service, which can add all kind of functions. For instance, I often run some code on a server for experiments. With only a few lines of code I can make this code to send a message via Slack so that I am notified once the job is done. In the lab for this unit we are going to build an alarm system with Slack.</p>

<span name="2f7088"></span><aside name="2f7088"><p>If you like, have a look at the article <a href="https://www.wired.com/2015/08/slack-overrun-bots-friendly-wonderful-bots">Slack Is Overrun With Bots. Friendly, Wonderful Bots</a>.</p>
</aside>
<p>Slack does not only use a single API, but several ones:</p>
<ul>
<li><p>The <strong>Web API</strong> offers access to channels and messages via HTTP resources. It works similar to our lab with HTTP. Client applications use HTTP requests, and Slack runs an HTTP server that accepts these requests. The content of the request is given as JSON, and can for instance send a message to a given channel. As usual in HTTP in this direction, all requests must originate from the client. Therefore, you cannot receive messages via this API, for example.</p></li>
<li><p>The <strong>Events API</strong> also uses HTTP and JSON, but in this API Slack is the client, and our application implements an HTTP server. For example, when a user sends a message on Slack, the Slack HTTP client makes a request to the HTTP server that our application runs and that we registered with Slack.</p></li>
<li><p>The <strong>Real-Time Messaging API</strong> uses Websockets as underlying technology. We haven’t treated Websockets in the course, but this is some bi-directional alternative to HTTP, so that also the server can send messages to the client. Slack offers this API, but with some limitations.</p></li>
</ul>
<p>This may be confusing at first, but when you know about the underlying technologies, it makes more sense. In the lab, we are only going to use the Web API, but this selection shows you how many possibilities there are for APIs. And there are much more!</p>

<span name="572b19"></span><aside name="572b19"><p>Have a look at the article <a href="https://medium.com/slack-developer-blog/getting-started-with-slacks-apis-f930c73fc889">Which API is right for your Slack app?</a>.</p>
</aside>
    </section>
    <section class="content">
<h1 id="wrapper-libraries">Wrapper Libraries</h1>
<p>Assume that a service (such as Slack) offers an API via HTTP. You can use this API in some “raw” form, and creating the right HTTP requests in several ways:</p>
<ul>
<li><p>You can use the command line program <code>curl</code> to create such requests.</p></li>
<li><p>You can use a browser, with some hacking, to make a corresponding request. (Not convenient, but often possible.)</p></li>
<li><p>More likely, you can program the request manually in Python, for instance using the <code>requests</code> library, as we did in the HTTP lab.</p></li>
</ul>
<p>All of these methods are a bit cumbersome, aren’t they? Therefore, there is another option:</p>
<ul>
<li>Someone may create an extra library in Python that encapsulates all the HTTP requests in Python with some code. The result can be an API in Python that uses internally HTTP to connect to a remote service like Slack.</li>
</ul>
<p>The benefit of the client library (for instance in Python) is the convenience. The client library can offer additional functions so that the HTTP requests are encoded correctly, and data is handled consistently. For a programmer, it almost appears as if Slack was running locally on the computer, since all the HTTP requests are hidden within the library.</p>

<span name="f17677"></span><aside name="f17677"><p>Remember the <em>remote procedure calls</em> from above? These client libraries for web-based APIs achieve basically the same thing. Why technology has gone this way instead of using “real” remote procedure calls is hard to say, and there may not be a single reason. It can have to do with not depending on a specific programming language, or worries of scalability, for example.</p>
</aside>
    </section>
    <section class="content">
<h1 id="rest">REST</h1>
<p>Some APIs are called REST APIs, because they follow a certain architectural style that makes it easier (or possible at all) that the APIs are offered with some desirable properties. Such properties are for instance performance and scalability, which are important once an API has a lot of users at the same time. The idea is to use similar mechanisms to enable such properties that also make HTTP work. And, while REST is not constrained to HTTP, most APIs that adhere to the REST principles are implemented in HTTP. Therefore, it is also okay to think of REST as a set of rules how an API can be expressed using HTTP.</p>

<span name="90d358"></span><aside name="90d358"><p>The following properties are copied form <a href="https://medium.com/extend/what-is-rest-a-simple-explanation-for-beginners-part-2-rest-constraints-129a4b69a582">this article</a></p>
</aside>
<p>If you don’t understand all of these constraints completely, or why they are important, don’t worry too much for now. REST is an architectural style, which encapsulates a lot of experience. Some issues are not so simple to grasp even for developers that have worked for some years. Still—read through them. Many of these concepts and terms will come up often.</p>
<ul>
<li><p><strong>Client–server separation</strong> <em>The client and the server act independently, each on its own, and the interaction between them is only in the form of requests, initiated by the client only, and responses, which the server send to the client only as a reaction to a request. The server just sits there waiting for requests from the client to come. The server doesn’t start sending away information about the state of some resources on its own.</em></p></li>
<li><p><strong>Stateless</strong> <em>Stateless means the server does not remember anything about the user who uses the API. It doesn’t remember if the user of the API already sent a GET request for the same resource in the past, it doesn’t remember which resources the user of the API requested before, and so on. Each individual request contains all the information the server needs to perform the request and return a response, regardless of other requests made by the same API user.</em></p></li>
<li><p><strong>Layered system</strong> <em>Between the client who requests a representation of a resource’s state, and the server who sends the response back, there might be a number of servers in the middle. These servers might provide a security layer, a caching layer, a load-balancing layer, or other functionality. Those layers should not affect the request or the response. The client is agnostic as to how many layers, if any, there are between the client and the actual server responding to the request.</em></p></li>
<li><p><strong>Cacheable</strong> <em>This means that the data the server sends contain information about whether or not the data is cacheable. If the data is cacheable, it might contain some sort of a version number. The version number is what makes caching possible: since the client knows which version of the data it already has (from a previous response), the client can avoid requesting the same data again and again. The client should also know if the current version of the data is expired, in which case the client will know it should send another request to the server to get the most updated data about the state of a resource.</em></p></li>
</ul>
<p>In other words, this makes an API behave much like an HTTP server otherwise serving websites to many browsers.</p>

    </section>
    <section class="content">
<h1 id="orchestration-vs.-choreography">Orchestration vs. Choreography</h1>
<p>Once we have a set of APIs we need to control how the overall system is coordinated. For that, we distinguish two different patterns; <strong>orchestration</strong> and <strong>choreography</strong>.</p>
<p>Let’s start with an example from everyday life. Imagine you want to organize a visit to the cinema with some friends, and you need to agree on which movie to watch and when to meet and so on. There is two ways of how to organize it:</p>
<ul>
<li><p>You can yourself act as the orchestrator of the whole preparation, and call everyone (or Snap or whatever you do) and check with each and everyone of your friends what their preferences are, then come up with a plan that works for most of them and finally invite everyone.</p></li>
<li><p>You could also rely more on a distributed way of doing it, like just telling one of your friends that you are interested in going to the cinema, and ask them to ask someone else, and so on. You rely more one some kind of choreography, that each of your friends contributes to the process and drives it forward until you have a stable agreement.</p></li>
</ul>
<p>The orchestration solution is probably the most controllable from your point of view, since you keep overview of the entire process and you have control over who has answered and so on, but it also requires you to coordinate everything. On the other hand, the choreography solution may end up in an argument like “Okay I thought we agreed on this movie and now you want to watch Halloween anyway?” However, choreographies can work quite nicely if everyone behaves as expected, and it does not depend on you as an orchestrator in the middle.</p>
<p>The same kind of behavior is possible for systems that consist of several components.</p>
<p><strong>Orchestration:</strong> A centralized program (the orchestrator) takes care of coordinating all requests to other components. The orchestrator keeps control of all the other components and controls when to call them, and processes their results.</p>

<div class="figure">
<img src="figures/iot/api-orchestration.svg" alt="In orchestration, one component is in the center of the interaction and manages all communication." width="100%"/>
<span name="figures/iot/api-orchestration.svg">&nbsp;</span>
<aside name="figures/iot/api-orchestration.svg"><p><p>In orchestration, one component is in the center of the interaction and manages all communication.</p>
</p></aside>
</div>
<p><strong>Choreography:</strong> There is a global coordination of components, following a decentralized approach. This usually requires that you need to have control over more than one component.</p>

<div class="figure">
<img src="figures/iot/api-choreography.svg" alt="In a choreography, the interaction emerges from the individual components, but there is no central manager." width="100%"/>
<span name="figures/iot/api-choreography.svg">&nbsp;</span>
<aside name="figures/iot/api-choreography.svg"><p><p>In a choreography, the interaction emerges from the individual components, but there is no central manager.</p>
</p></aside>
</div>
<p>When creating applications with several applications, you will have to decide which kind of coordination pattern you want to follow. Sometimes, orchestration or choreographies are necessary or beneficial, sometimes a combination of the two may be most suitable.</p>

    </section>
</div>


<footer></footer>
</body>
</html>
