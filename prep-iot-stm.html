<html lang="en-US"><head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1"/>

<title>TTM4175</title>
<meta property="og:title" content="TTM4175">
<meta property="og:locale" content="en_US">
<meta name="description" content="Introduction to Communication Technology and Digital Security">
<meta property="og:description" content="Introduction to Communication Technology and Digital Security">


<link rel="stylesheet" href="assets/bootstrap.min.css">
<script src="assets/jquery-3.5.1.min.js"></script>
<script src="assets/bootstrap.min.js"></script>
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.1/css/all.css" integrity="sha384-gfdkjb5BdAXd+lj+gudLWI+BXq4IuLW5IT+brZEZsLFm++aCMlF1V92rMkPaX4PP" crossorigin="anonymous">
<link rel="stylesheet" type="text/css" href="assets/style.css" />
<link rel="stylesheet" type="text/css" href="assets/bootstrap-icons.css">
<style type="text/css">a.ntnu-button {
    font: 600 14px "Source Sans Pro", Georgia, serif;
    background: #fff;
    color: #00509e;
    border: 1px solid #00509e;
    border-color: #00509e !important;
    border-style: solid !important;
    border-radius: 10rem;
    display: inline-block;
    padding: 5px 15px;
    height: auto;
    font-weight: bold;
    line-height: 1.5em;
    text-align: center;
    vertical-align: top;
    cursor: pointer;
    text-decoration: none
}

a.ntnu-button:hover {
    background: #00509e;
    color: #fff;
    text-decoration: none
}
div.check ul,
div.check ul li {
  padding: 0;
  margin: 0;
  list-style: none;
}

div.check ul {
  margin: 2em 0;
}

div.check ul li {
  margin: 1em;
  margin-left: 3em;
}

div.check ul li:before {
  content: '\f26a';
  font-family: bootstrap-icons !important;
  font-size:20;
  float: left;
  margin-left: -1.5em;
  color: #1481b8;
}
div.figure {
  padding: 20px 0 20px 0;
  width: 100%;
}

div.figurefullwitdth {
  padding: 20px 0 20px 0;
  margin-left: -33px;
  margin-right: -33px;
  width: 100%;
}
div.goals ul,
div.goals ul li {
  padding: 0;
  margin: 0;
  list-style: none;
}

div.goals ul {
  margin: 2em 0;
}

div.goals ul li {
  margin: 1em;
  margin-left: 3em;
}

div.goals ul li:before {
  content: '\f26a';
  font-family: bootstrap-icons !important;
  font-size:20;
  float: left;
  margin-left: -1.5em;
  color: #1481b8;
}
.w3collapsible {
  background-color:#f0e9db;
  color: #868279; 
  padding: 8px 18px 8px 8px;
  cursor: pointer;
  width: 100%;
  border: none;
  border-radius: 3px 3px 0 0;
  text-align: left;
  outline: none;
  font-size: 15px;
}

.w3active, .w3collapsible:hover {
  background-color: #f0e9cb;
}

.w3content {
  filter: blur(3px);
  padding: 0 18px;
  display: block;
  overflow: hidden;
  background-color: #f3f3f3;
  margin-bottom: 15px;
}
div.report p {
padding: 10px;
background-color: #D6E5F0;
border-radius: 5px;
border-left: 6px solid #1481b8 
}

div.report p::before {
    content: 'For the Report: ';
    font-weight: bold; 
    color: #1481b8;
display: inline;
}
.steps ol, .steps ul {
  counter-reset: li;
  list-style: none;
  margin-left: 10px
}

.steps li {
  margin: 0 0 10px 0;
  min-height: 40px
}

.steps li:before {
  content: counter(li);
  counter-increment: li;
  border: 2px solid #868279;
  color: #868279;
  background-color: none;
  font-family: "Source Sans Pro", Georgia, serif;
  font-weight: bold;
  border-radius: 100%;
  text-align: center;
  display: inline-block;
  top:8px;
  left:-30px;
  width: 30px;
  height: 30px;
  position: relative;
  margin: -20px -10px -20px -20px
}

div.task p {
padding: 10px;
background-color: #D6E5F0;
border-radius: 5px;
border-left: 6px solid #1481b8 
}

div.task p::before { 
content: "Task: ";
font-weight: bold;
display: inline;
}
div.tip p {
  padding: 10px;
  background-color: #d9eaf2;
  border-radius: 5px;
  border-left: 6px solid #1481b8
}

div.warning p {
padding: 10px;
background-color: #ffd9ab;
border-radius: 5px;
border-left: 6px solid #fc8c03 
}

div.warning p::before {
    content: '\f071 ';
    font-family: 'Font Awesome 5 Free'; 
    color: #fc8c03;
display: inline;
}
table.weekplan {
  width: 100%;
  table-layout: fixed;
}

table.weekplan td {
  background-color: #1481b8;
  color: white;
}

table.weekplan td, table.weekplan th {
  text-align: center;
}

table.weekplan td:empty {
  background-color: white;
}

table.weekplan td:first-child {
  background-color: white;
  color: grey;
}

table.weekplan a {
  font-weight:bold;
  color: white;
  text-decoration: underline;
}
</style>
<script src="assets/anchor.js"></script>
<script src="assets/script-aside.js"></script>
</head>
<body id="top">

<nav class="navbar navbar-expand-md navbar-dark " style="background-color:#666666"#2B65EC"> <!-- fixed-top -->
        <ul class="nav nav-pills">
        <li class="nav-item">
    <a class="nav-link" href="index.html" style="font-weight: bold")>TTM4175</a>
  </li>

  <li class="nav-item dropdown">
    <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">Teknostart</a>
    <div class="dropdown-menu">
      <a class="dropdown-item" href="day0-2021.html">Oppstart</a>
      <a class="dropdown-item" href="material/TTM4175-2021-L01-Introduction_to_ethical_hacking.pdf">Introduction to Ethical Hacking (PDF)</a>
      <a class="dropdown-item" href="material/TTM4175-2021-L01-Introduction_to_Kali_linux.pdf">Introduction to Kali Linux (PDF)</a>
      <a class="dropdown-item" href="day2-2021.html">Dag 2</a>
      <a class="dropdown-item" href="day3-2021.html">Dag 3</a>
      <div class="dropdown-divider"></div>
      <a class="dropdown-item" href="day0-2020.html">(2020) Dag 0: Getting Started</a>
      <a class="dropdown-item" href="day1-2020.html">(2020) Dag 1: Virtual Box</a>
      <a class="dropdown-item" href="day2-2020.html">(2020) Dag 2: Linux Command Line</a>
      <a class="dropdown-item" href="day3-2020.html">(2020) Dag 3: SSH and HTML</a>
      <div class="dropdown-divider"></div>
      <a class="dropdown-item" href="tips.html">Tips</a>
    </div>
  </li>
        
  <li class="nav-item dropdown">
    <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">Preparation</a>
    <div class="dropdown-menu">
      <a class="dropdown-item disabled"><strong>Security and Ethical Hacking</strong></a>
      <a class="dropdown-item" href="prep-security-1-2021.html">Security 1</a>
      <a class="dropdown-item" href="prep-security-2-2021.html">Security 2</a>
      <a class="dropdown-item" href="prep-security-3-2021.html">Security 3</a>
      <a class="dropdown-item" href="prep-security-4-2021.html">Security 4</a>
      <a class="dropdown-item" href="prep-security-5-2021.html">Security 5</a>
      <div class="dropdown-divider"></div>
      <a class="dropdown-item" href="prep-teamwork.html">Teamwork</a>
      <div class="dropdown-divider"></div>
      <a class="dropdown-item disabled"><strong>Internet of Things</strong></a>
      <a class="dropdown-item" href="prep-iot-intro.html">IoT 1: Introduction</a>
      <a class="dropdown-item" href="prep-iot-stm.html">IoT 2: State Machines</a>
      <a class="dropdown-item" href="prep-iot-stmpy.html">IoT 2: State Machines in Micro Python</a>
      <a class="dropdown-item" href="prep-iot-http-json.html">IoT 3: HTTP and JSON</a>
      <a class="dropdown-item" href="prep-iot-mqtt.html">IoT 4: MQTT</a>
      <!--
      <a class="dropdown-item disabled"><strong>Networking (2020)</strong></a>
      <a class="dropdown-item" href="prep-networking-1-2020.html">Binary and IP addresses</a>
      <a class="dropdown-item" href="prep-networking-2-2020.html">Layers and Docker</a>
      <a class="dropdown-item" href="prep-networking-3-2020.html">Webservers and DNS</a>
      <div class="dropdown-divider"></div>
      <a class="dropdown-item disabled"><strong>Security (2020)</strong></a>
      <a class="dropdown-item" href="prep-security-1-2020.html">Security 1: Cyber Security and Ethical Hacking </a>
      <a class="dropdown-item" href="prep-security-2-2020.html">Security 2: Authentication, Authorization, and Password Storage</a>
      <a class="dropdown-item" href="prep-security-3-2020.html">Security 3: Passwords and Cryptography</a>
      <a class="dropdown-item" href="prep-security-4-2020.html">Security 4: Security Vulnerabilities</a>
      <div class="dropdown-divider"></div>
      <a class="dropdown-item disabled"><strong>Internet of Things (2020)</strong></a>
      <a class="dropdown-item" href="prep-iot-intro.html">IoT 1: Introduction</a>
      <a class="dropdown-item" href="prep-iot-devices.html">IoT 1: Installation</a>
      <a class="dropdown-item" href="prep-iot-stm.html">IoT 2: State Machines</a>
      <a class="dropdown-item" href="prep-iot-stmpy.html">IoT 2: State Machines in Micro Python</a>
      <a class="dropdown-item" href="prep-iot-http-json.html">IoT 3: HTTP and JSON</a>
      <a class="dropdown-item" href="prep-iot-mqtt.html">IoT 4: MQTT</a>
      <a class="dropdown-item" href="prep-iot-api.html">IoT 4: APIs</a>
      <a class="dropdown-item" href="prep-iot-nb-iot.html">NB-IoT (Extra)</a>-->
    </div>
  </li>
  
  <li class="nav-item dropdown">
    <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">Labs</a>
    <div class="dropdown-menu">
        <a class="dropdown-item disabled"><strong>Security</strong></a>
        <a class="dropdown-item" href="security-1-2021.html">Security 1</a>
        <a class="dropdown-item" href="material/TTM4175-2021-L02-Technical_information_gathering.pdf">Security 2: Technical Information gathering</a>
        <a class="dropdown-item" href="material/TTM4175-2021-L03-Network_mapping.pdf">Security 3: Network mapping</a>
        <a class="dropdown-item" href="material/TTM4175-2021-L04-Web_hacking1.pdf">Security 4: Web Hacking 1</a>
        <a class="dropdown-item" href="material/TTM4175-2021-L04-Web_hacking2.pdf">Security 4: Web Hacking 2</a>
        <a class="dropdown-item" href="security-5-2021.html">Security 5</a>
        <div class="dropdown-divider"></div>
        <a class="dropdown-item" href="teamwork.html">Teamwork</a>
        <div class="dropdown-divider"></div>
        <a class="dropdown-item disabled"><strong>Internet of Things (2020)</strong></a>
        <a class="dropdown-item" href="iot-devices-2021.html">IoT 1: Programming Devices</a>
        <a class="dropdown-item" href="iot-stm-2021.html">IoT 2: State Machines</a>
        <a class="dropdown-item" href="iot-http-json.html">IoT 3: HTTP and JSON</a>
        <a class="dropdown-item" href="iot-mqtt-chat.html">IoT 4: MQTT Chat</a>
        <!--
        <a class="dropdown-item disabled"><strong>Networking (2020)</strong></a>
        <a class="dropdown-item" href="networking-1-2020.html">Binary and IP addresses</a>
        <a class="dropdown-item" href="networking-2-2020.html">Layers and Docker</a>
        <a class="dropdown-item" href="networking-3-2020.html">Webservers and DNS</a>
        <div class="dropdown-divider"></div>
        <a class="dropdown-item disabled"><strong>Security (2020)</strong></a>
        <a class="dropdown-item" href="security-1-2020.html">Security 1</a>
        <a class="dropdown-item" href="security-2-2020.html">Security 2</a>
        <a class="dropdown-item" href="security-3-2020.html">Security 3</a>
        <a class="dropdown-item" href="security-4-2020.html">Security 4</a>
        <div class="dropdown-divider"></div>
        <a class="dropdown-item disabled"><strong>Internet of Things (2020)</strong></a>
        <a class="dropdown-item" href="iot-devices.html">IoT 1: Programming Devices</a>
        <a class="dropdown-item" href="iot-stm.html">IoT 2: State Machines</a>
        <a class="dropdown-item" href="iot-http-json-2020.html">IoT 3: HTTP and JSON</a>
        <a class="dropdown-item" href="iot-http-json-2020-solution.html">IoT 3: HTTP and JSON (Solution and Revised Tasks)</a>
        <a class="dropdown-item" href="iot-mqtt-chat.html">IoT 4: MQTT Chat</a>
        <a class="dropdown-item" href="iot-lopy.html">LoPy</a>
        <a class="dropdown-item" href="iot-mqtt.html">MQTT</a>
        <a class="dropdown-item" href="iot-lorawan.html">LoRaWAN / NB-IoT</a>
        <a class="dropdown-item" href="iot-api.html">API</a>-->
      </div>
  </li>
  
  <li class="nav-item dropdown">
    <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">Extra</a>
    <div class="dropdown-menu">
      <a class="dropdown-item disabled"><strong>Learning</strong></a>
      <a class="dropdown-item" href="learning-rats.html">RATs</a>
      <a class="dropdown-item" href="feedback.html">Tilbakemelding</a>
      <a class="dropdown-item" href="reports.html">Rapporter</a>
      <a class="dropdown-item" href="teams.html">Teams</a>
      <a class="dropdown-item" href="working-in-teams.html">Working in Teams</a>
      <a class="dropdown-item" href="tools.html">Learning Tools</a>
      <div class="dropdown-divider"></div>
      <a class="dropdown-item disabled"><strong>Material</strong></a>
      <a class="dropdown-item" href="commands-help.html">Help on Commands</a>
      <a class="dropdown-item" href="commands.html">List of Commands</a>
      <a class="dropdown-item" href="computer-history.html">Extra Videos</a>
      <div class="dropdown-divider"></div>
      <a class="dropdown-item disabled"><strong>Tools</strong></a>
      <a class="dropdown-item" href="virtual-box-mac.html">Virtual Box for Mac</a>
      <a class="dropdown-item" href="virtual-box-win.html">Virtual Box for Windows</a>
      <a class="dropdown-item" href="shell-mac.html">Terminal and SSH on Mac</a>
      <a class="dropdown-item" href="shell-win.html">Terminal and SSH on Windows</a>
    </div>
  </li>
  
  <!--
  <li class="nav-item">
    <a class="nav-link" href="#">Blackboard</a>
  </li>-->
</ul>

<div class="navbar-nav flex-row ml-md-auto d-none d-md-flex"></div>
             <a class="navbar-brand" href="https://ntnu.edu">
      	<svg width="100" height="30">
      		<image xlink:href="https://innsida.ntnu.no/innsida-theme/images/ntnu-graphics/ntnu_logo_white.svg" 
      		src="https://innsida.ntnu.no/innsida-theme/images/ntnu-graphics/ntnu_logo_white.png" width="100%" height="100%"></image>
      	</svg>
      </a>
    </nav>


<div class="page">
    </section>
    <section class="content">
<h1>State Machines</h1>
<p>So far, you have learned how to use Python to program a device.
We have used functions to control the components of the devices, like the LEDs, to find out if buttons have been pressed or read sensor values.
We used a simple application pattern, in which we had a main while-loop.
For simple applications, this is sufficient and works well.
But this way of programming can quickly get very complicated, if you want to build more complex applications and solve a bit more difficult issues.
This single while loop would very quickly get very complex.</p>
<p><em>&quot;I can handle complicated code!&quot;</em> you could say. But even if that <em>would</em> be true, we need to be careful.
When designing a system, the goal is not only to get some code that works.
We also need to <strong>document</strong> how the system works, so that it can be as simple as possible for <strong>others</strong> to understand as well.
Some code may be extremely relevant for the safety of a system, or critical in other ways.</p>
<p>This week we will learn a way to express more complicated behavior using the concept of state machines.
This is a concept that you will meet again in other courses, because state machines are a useful tool to describe behavior, and especially behavior where several things are going on at the same time.
Communication protocols can be described and built with state machines, and systems can express how they synchronize their behavior using state machines.</p>
<p>For IoT, state machines can be useful to describe how a device controls its behavior, and we will use it to create some more complex examples.</p>
<h2>Learning Goals</h2>

<div class="goals"><p>After this week, you will be able to:</p>
<ul>
<li>Create and understand simple state machines.</li>
<li>Program a transition method in Python.</li>
<li>Find some design flaws in simple state machines.</li>
</ul>
</div>
<h2>Hello, State Machines!</h2>

<p>Let's assume we need to describe how a traffic light works. One idea is to just take pictures of a traffic light, like this:</p>

<div class="figure">
<img src="figures/statemachines/traffic-light-1.jpg" width="100%"/>
</div>
<p>That already helps --- the photos describe the phases in which we can observe the traffic light. Whenever we look at the traffic light, it is in one of the phases described by the photos. For easier reference we have even given these photos some labels, intuitively <em>red</em>, <em>red-yellow</em>, <em>green</em> and <em>yellow</em>. (The <em>red-yellow</em> is common in many, but not all countries.)</p>

<p>The photos already help explaining the traffic light. But imagine you want to explain on paper in which sequence a traffic light switches its lights. One way is text, but a simpler way is to add arrows between the photos, like this:</p>

<div class="figure">
<img src="figures/statemachines/traffic-light-2.jpg" width="100%"/>
</div>
<p>Of course, the picture above is a simplification. Some traffic lights are switched off at night and just blink yellow. The same happens as a default state in case there is an error in the controller. We can show this blinking with the two additional photos <em>blink-off</em> and <em>blink-on</em>. The two arrows between them show how the blinking is created by two phases, one with the yellow light on and one with all lights off. We also show that blinking can be started from any of the other phases, because an error can always happen, and the lights may be switched off at any time. When we get out of the blinking sequence, we go towards the phase <em>red</em> for safety.</p>

<div class="figure">
<img src="figures/statemachines/traffic-light-3.jpg" width="100%"/>
</div>
<p>That's a complete and detailed description of a traffic light. As one last thing we add an arrow to mark in which phase a traffic light starts once it is switched on for the first time. For safety, we put it into <em>red</em> first.</p>

    </section>
    <section class="content">
<h1>State Machine Diagrams</h1>

<p>For the traffic light above we described actually a state machine. Since taking photos of real objects is cumbersome, and we also want to describe abstract things we cannot take a photo off, we replace the photos above with a more convenient symbol, a rectangle with rounded corners. These are the states in which the traffic light can be. A state machine for the traffic light looks then like this:</p>

<div class="figure">
<img src="figures/statemachines/traffic-light-4.svg" width="100%"/>
</div>
<p>Notice the detailed elements in this diagram:</p>
<ul>
<li>The states are shown as rounded rectangles. The state names are shown in bold text. As a naming convention, we only use lowercase letters, numbers, and underscores for state machine names, similar to rules for variable names in programming languages.</li>
<li>The start of the state machine is shown by a compact black dot. This is also a state, called the <em>initial state</em>. Once the state machine is activated, it starts at this initial state.</li>
<li>We assume that a traffic light only can be turned off from the state <em>blink_on</em>. This is shown by the final state, which is the circle with the extra border.</li>
</ul>
<h2>States</h2>

<p>State symbols with the same name refer to the same state. This means, we can use a copy of the state symbol to make our layout easier, without changing what we actually mean by the diagram. For instance, we can remove the long arrow from state <code>yellow</code> to state <code>red</code> just by having another copy of the symbol for state <code>red</code>:</p>

<div class="figure">
<img src="figures/statemachines/traffic-light-5.svg" width="100%"/>
</div>
<p>The diagram describes exactly the same behavior. Both state symbols for the state <code>red</code> refer to the same state, so our traffic light still has the same number of states, just its layout changed. In this simple state machine this doesn't really matter, but this can help you to create better layouts once state machines become larger.</p>

<p><strong>State Names:</strong> Selecting good names for states can help making state machine easier to understand, especially when the states map to phases of the thing we want to model, like <em>on</em> and <em>off</em> for a lamp, or <em>open</em> and <em>close</em> for a lock. But sometimes there is no obvious good name. In such cases, I recommend to use state names like <code>s0</code>, <code>s1</code>. You always have the possibility to attach a note to a state and explain what it means.</p>

<h2>Transitions</h2>
<p>The arrows between the states are called <strong>transitions</strong>. We have said above that the state machine is at any point in time in exactly one of its states. It is not in two or more of them at the same time, and it is never somewhere in between. Conceptually, this means that a state machine switches from one state to another <strong>within no time at all</strong>,  meaning that <strong>transitions take no time</strong>.</p>
<p>To understand this property, think of a state machine as a board game, where you move a token from one place to another.
A token can only rest on the board, in one of the designated places.
When you throw a dice and move forward, you need to pick up the token and move it into the next place.
Of course, during that process, the token is briefly in the air.
But nothing else is allowed to happen during that time.
The other players will just look at what you are doing and not move their own tokens.
So practically, the token moved from one place to another in no time.
In the same way, a state machine is moving between its states by executing a transition, and nothing else happens while they execute.</p>

<a title="Isai Symens, CC BY-SA 4.0 &lt;https://creativecommons.org/licenses/by-sa/4.0&gt;, via Wikimedia Commons" href="https://commons.wikimedia.org/wiki/File:Mens_Erger_Je_Niet_Bordspel_1.jpg"><img width="512" alt="Mens Erger Je Niet Bordspel 1" src="https://upload.wikimedia.org/wikipedia/commons/thumb/0/0d/Mens_Erger_Je_Niet_Bordspel_1.jpg/512px-Mens_Erger_Je_Niet_Bordspel_1.jpg"></a>



<h2>Triggers</h2>
<p>So far, we have not yet talked about <em>when</em> a transition happens, this means, what <strong>triggers</strong> a transition. We have, for example, not described <em>when</em> the traffic light switches from <code>red</code> to <code>red_yellow</code>. There are three types of events that can trigger transitions in a state machine:</p>
<ul>
<li>The state machine is started, then its <strong>transition from the initial state</strong> is triggered. This happens when the component or code surrounding the machine is started and then starts up the machine, for instance when we boot our firmware and the software starts running.</li>
<li>The state machine observes the <strong>expiration of a timer</strong>. Timers are managed by the machine itself, and we will learn how timers can be started and stopped later.</li>
<li>When we work with the Microbit, the events can be <strong>actions from the user</strong>, like pressing any of the buttons, or that device detects a gesture.</li>
</ul>
<p>A transition must have exactly one trigger. Without one, it would never be started at all. For simplicity, we also don't allow more than one trigger. A trigger is declared using a label on the arrow, followed by a <code>/</code>. This means that you should have a trigger label at all transitions.</p>
<p>The only exception to this rule are transitions starting at initial states, because their trigger is implicitly the start of the entire machine.</p>

<h2>Actions</h2>
<p>Let's have a look at a blinking light that you find often at the entry of tunnels. The light blinks with two lamps to indicate that the tunnel is closed. The blinking happens so that either the left lamp or the right lamp are on, and they switch every second.</p>

<div class="figure">
<img src="figures/statemachines/tunnel.jpg" width="100%"/>
</div>
<p>From our experience with the more complex traffic light, this should be an easy state machine to write down. It has two states, <code>left</code>and <code>right</code>, corresponding to one of the lamps being switched on. We also added labels to some of the transitions. They describe that the state machine switches from state <code>left</code> to state <code>right</code> triggered by an event <code>t1</code>. This is a timer. It switches back with a timer <code>t2</code>. The detailed timer operations are not yet visible, we come later to that.</p>

<div class="figure">
<img src="figures/statemachines/tunnel-1.svg" width="100%"/>
</div>
<p>Now we also want to specify the actions to switch the individual lamps on and off. We assume that we have for this the actions <code>left_on()</code>, <code>left_off()</code>, and <code>right_on()</code>, <code>right_off()</code>. We already use Python syntax for these actions. In our state machine diagram we can use these actions and add them to the transitions.</p>
<p>The actions are also called an <strong>effect</strong> of the transition, and happen at the same instant the transition is executed, that means, when we switch states. The effects are written behind the <code>/</code> of the transition label.</p>
<ul>
<li>The state machine runs action <code>left_on()</code> when it starts, as declared by the initial transition.</li>
<li>When the machine switches from state <code>left</code> to <code>right</code>, it runs actions <code>left_off()</code> and <code>right_on()</code>, separated with a <code>;</code>.</li>
<li>When the machine switches from state <code>right</code> to <code>left</code>, it runs actions <code>right_off()</code> and <code>left_on()</code>, separated with a <code>;</code>.</li>
<li>When the blinking light switches off and moves into the final state, we run actions <code>left_off()</code> or <code>right_off()</code>, depending on in which of the two states we are.</li>
</ul>

<div class="figure">
<img src="figures/statemachines/tunnel-2.svg" width="100%"/>
</div>
<h2>Timers</h2>
<p>The expiration of a timer can trigger a transition. By convention, we name timers with a prefix <code>t</code>, like for example <code>t0</code>. To declare that a transition is triggered by a timer, we simply write the name of the timer in the beginning of the transition label.</p>
<p>State machines manage timers on their own, wich also means that timers can only be started as part of an action within the same state machine. As we anticipate already our implementation in Python, we use the following syntax for controlling timers:</p>
<ul>
<li><code>start_timer(t1, 1000)</code> starts a timer with name <code>t1</code> that will expire after 1000 milliseconds. If we invoke this action again while the timer is active and has not yet expired yet, the countdown will again start from the beginning, i.e., we expect the timeout 1000 milliseconds from the last call of <code>start_timer(t1, 1000)</code>.</li>
<li><code>stop_timer(t1)</code> stops a timer, so that a timeout will not happen in the future. In case this action is called but <code>t1</code> already expired or was never started before, nothing happens.</li>
</ul>

<div class="figure">
<img src="figures/statemachines/tunnel-3.svg" alt="Complete blinking light, in this version with the actions to start the timers." width="100%"/>
<span name="figures/statemachines/tunnel-3.svg">&nbsp;</span>
<aside name="figures/statemachines/tunnel-3.svg"><p><p>Complete blinking light, in this version with the actions to start the timers.</p>
</p></aside>
</div>
<h3>Spaghetti Timer Example</h3>
<p>Imagine we want to describe the behavior of a simple spaghetti timer. This timer expires after 10 minutes and then beeps for 3 seconds. We can do this with the state machine below.</p>

<div class="figure">
<img src="figures/statemachines/spaghetti-1.svg" alt="Simple timer that beeps for 3 seconds after 10 minutes are over." width="100%"/>
<span name="figures/statemachines/spaghetti-1.svg">&nbsp;</span>
<aside name="figures/statemachines/spaghetti-1.svg"><p><p>Simple timer that beeps for 3 seconds after 10 minutes are over.</p>
</p></aside>
</div>
<h2>Decisions</h2>
<p>In some cases, we want to have a choice in which state a transition should switch, based on conditions in data. As an example, let's look at the incomplete state machine below. It describes a part of a controller for a heater. In state <code>heater_on</code> we wait for 1 second for timer <code>t</code>, which triggers the transition towards the choice state. This choice state has two alternative branches, distinguished by two guards, in rectangular brackets. Think of them as an if-statement in a programming language. (And that is actually how we will later implement them.) If the temperature is okay, we switch into state <code>heater_off</code>. If not, we take the else-branch and restart the timer, to check again in another 1000 milliseconds.</p>

<div class="figure">
<img src="figures/statemachines/choice.svg" alt="Part of a temperature controller, using a decision with branches." width="100%"/>
<span name="figures/statemachines/choice.svg">&nbsp;</span>
<aside name="figures/statemachines/choice.svg"><p><p>Part of a temperature controller, using a decision with branches.</p>
</p></aside>
</div>
<p>Don't worry too much about what to write into the guard for now. This will get clearer once we implement state machines in Python.</p>
<p>A decision can have many outgoing branches. One of them must have a guard that is true, otherwise the state machine would be blocked. I therefore recommend to have an else-branch, which is true whenever none of the other branches is true.</p>

    </section>
    <section class="content">
<h1>Errors in State Machines</h1>

<p>You may think: <em>&quot;Why do we need all these rules for state machines?&quot;</em>
This is because we want to describe behavior precisely, in such a way that it is unambiguous (everyone knows what it means) and so that it does not contain any errors, or at least that errors would be easy to find.</p>
<p>In the following we are going to describe some examples of state machines that contain an error or that are somehow problematic, in the sense that they show behavior that is probably not intended or useful for an application.</p>

<h3>Missing Initial States</h3>
<p>When the initial state is missing, we don't know where to start the state machine.
So every state machine must have exactly one initial state.</p>

<div class="figure">
<img src="figures/statemachines/error-1.svg" alt="Missing initial states." width="100%"/>
<span name="figures/statemachines/error-1.svg">&nbsp;</span>
<aside name="figures/statemachines/error-1.svg"><p><p>Missing initial states.</p>
</p></aside>
</div>
<h3>Missing Triggers</h3>
<p>Every transition out of an ordinary state needs a trigger, otherwise there is no way it will ever be executed.
Only the initial transition has no trigger attached, because it is implicitly triggered by the start of the machine.</p>

<div class="figure">
<img src="figures/statemachines/error-2.svg" alt="Missing triggers." width="100%"/>
<span name="figures/statemachines/error-2.svg">&nbsp;</span>
<aside name="figures/statemachines/error-2.svg"><p><p>Missing triggers.</p>
</p></aside>
</div>
<h3>Same Outgoing Triggers</h3>
<p>Look at the example below: Imagine we are in state <code>s1</code> and event <code>e1</code> happens.
In this state machine it is not clear if we are moving into state <code>s2</code> or <code>s3</code>, since both transitions are labeled with the same event.</p>

<div class="figure">
<img src="figures/statemachines/error-3.svg" alt="Double triggers." width="100%"/>
<span name="figures/statemachines/error-3.svg">&nbsp;</span>
<aside name="figures/statemachines/error-3.svg"><p><p>Double triggers.</p>
</p></aside>
</div>
<h3>Timer is Never Started</h3>
<p>Another example is that we wait for an even that never happens, like in the example below.
A timer can only ever expire if we started it before.
In the state machine, the timer <code>t1</code> will never expired because it never gets started in the first place.
This is almost certainly an error, because if we never want the timer to expire, we shouldn't even declare such a transiton. So probably, the creator of the machine forgot to start the timer.</p>

<div class="figure">
<img src="figures/statemachines/error-4.svg" alt="Missing initial states." width="100%"/>
<span name="figures/statemachines/error-4.svg">&nbsp;</span>
<aside name="figures/statemachines/error-4.svg"><p><p>Missing initial states.</p>
</p></aside>
</div>
<h3>State is a Deadlock</h3>
<p>A deadlock is a state with no way out of it, that means, a state without any outgoing transition.
This can be a sign for a missing or forgotten transition.
If that is desired, you can consider to use a final state to make it clear that the state machine should be terminated.
In the examples above, states <code>s_2</code> and <code>s_3</code> are all deadlock states, because the machine never moves out of them.</p>

    </section>
</div>


<footer></footer>
<script>
    anchors.add('h1').add('h2').add('h3');
    anchors.options.visible = 'always';
</script>
</body>
</html>
