<html lang="en-US"><head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1"/>

<title>TTM4175</title>
<meta property="og:title" content="TTM4175">
<meta property="og:locale" content="en_US">
<meta name="description" content="Introduction to Communication Technology and Digital Security">
<meta property="og:description" content="Introduction to Communication Technology and Digital Security">


<link rel="stylesheet" href="assets/bootstrap.min.css">
<script src="assets/jquery-3.5.1.min.js"></script>
<script src="assets/bootstrap.min.js"></script>
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.1/css/all.css" integrity="sha384-gfdkjb5BdAXd+lj+gudLWI+BXq4IuLW5IT+brZEZsLFm++aCMlF1V92rMkPaX4PP" crossorigin="anonymous">
<link rel="stylesheet" type="text/css" href="assets/style.css" />
<script src="assets/anchor.js"></script>
<script src="assets/script-aside.js"></script>
</head>
<body id="top">

<nav class="navbar navbar-expand-md navbar-dark " style="background-color:#666666"#2B65EC"> <!-- fixed-top -->
        <ul class="nav nav-pills">
        <li class="nav-item">
    <a class="nav-link" href="index.html" style="font-weight: bold")>TTM4175</a>
  </li>

  <li class="nav-item dropdown">
    <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">Teknostart</a>
    <div class="dropdown-menu">
      <a class="dropdown-item" href="day0-2021.html">Oppstart</a>
      <a class="dropdown-item" href="material/TTM4175-2021-L01-Introduction_to_ethical_hacking.pdf">Introduction to Ethical Hacking (PDF)</a>
      <a class="dropdown-item" href="material/TTM4175-2021-L01-Introduction_to_Kali_linux.pdf">Introduction to Kali Linux (PDF)</a>
      <a class="dropdown-item" href="day2-2021.html">Dag 2</a>
      <a class="dropdown-item" href="day3-2021.html">Dag 3</a>
      <div class="dropdown-divider"></div>
      <a class="dropdown-item" href="day0-2020.html">(2020) Dag 0: Getting Started</a>
      <a class="dropdown-item" href="day1-2020.html">(2020) Dag 1: Virtual Box</a>
      <a class="dropdown-item" href="day2-2020.html">(2020) Dag 2: Linux Command Line</a>
      <a class="dropdown-item" href="day3-2020.html">(2020) Dag 3: SSH and HTML</a>
      <div class="dropdown-divider"></div>
      <a class="dropdown-item" href="tips.html">Tips</a>
    </div>
  </li>
        
  <li class="nav-item dropdown">
    <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">Preparation</a>
    <div class="dropdown-menu">
      <a class="dropdown-item disabled"><strong>Security</strong></a>
      <a class="dropdown-item" href="prep-security-1-2021.html">Security 1</a>
      <a class="dropdown-item" href="prep-security-2-2021.html">Security 2</a>
      <a class="dropdown-item" href="prep-security-3-2021.html">Security 3</a>
      <a class="dropdown-item" href="prep-security-4-2021.html">Security 4</a>
      <a class="dropdown-item" href="prep-security-5-2021.html">Security 5</a>
      <div class="dropdown-divider"></div>
      <a class="dropdown-item disabled"><strong>Networking (2020)</strong></a>
      <a class="dropdown-item" href="prep-networking-1-2020.html">Binary and IP addresses</a>
      <a class="dropdown-item" href="prep-networking-2-2020.html">Layers and Docker</a>
      <a class="dropdown-item" href="prep-networking-3-2020.html">Webservers and DNS</a>
      <div class="dropdown-divider"></div>
      <a class="dropdown-item disabled"><strong>Security (2020)</strong></a>
      <a class="dropdown-item" href="prep-security-1-2020.html">Security 1: Cyber Security and Ethical Hacking </a>
      <a class="dropdown-item" href="prep-security-2-2020.html">Security 2: Authentication, Authorization, and Password Storage</a>
      <a class="dropdown-item" href="prep-security-3-2020.html">Security 3: Passwords and Cryptography</a>
      <a class="dropdown-item" href="prep-security-4-2020.html">Security 4: Security Vulnerabilities</a>
      <div class="dropdown-divider"></div>
      <a class="dropdown-item disabled"><strong>Internet of Things (2020)</strong></a>
      <a class="dropdown-item" href="prep-iot-intro.html">IoT 1: Introduction</a>
      <a class="dropdown-item" href="prep-iot-devices.html">IoT 1: Installation</a>
      <a class="dropdown-item" href="prep-iot-stm.html">IoT 2: State Machines</a>
      <a class="dropdown-item" href="prep-iot-stmpy.html">IoT 2: State Machines in Micro Python</a>
      <a class="dropdown-item" href="prep-iot-http-json.html">IoT 3: HTTP and JSON</a>
      <a class="dropdown-item" href="prep-iot-mqtt.html">IoT 4: MQTT</a>
      <!--
      <a class="dropdown-item" href="prep-iot-api.html">IoT 4: APIs</a>
      <a class="dropdown-item" href="prep-iot-nb-iot.html">NB-IoT (Extra)</a>-->
    </div>
  </li>
  
  <li class="nav-item dropdown">
    <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">Labs</a>
    <div class="dropdown-menu">
        <a class="dropdown-item disabled"><strong>Security</strong></a>
        <a class="dropdown-item" href="security-1-2021.html">Security 1</a>
        <a class="dropdown-item" href="security-2-2021.html">Security 2</a>
        <a class="dropdown-item" href="security-3-2021.html">Security 3</a>
        <a class="dropdown-item" href="security-4-2021.html">Security 4</a>
        <a class="dropdown-item" href="security-5-2021.html">Security 5</a>
        <div class="dropdown-divider"></div>
        <a class="dropdown-item disabled"><strong>Networking (2020)</strong></a>
        <a class="dropdown-item" href="networking-1-2020.html">Binary and IP addresses</a>
        <a class="dropdown-item" href="networking-2-2020.html">Layers and Docker</a>
        <a class="dropdown-item" href="networking-3-2020.html">Webservers and DNS</a>
        <div class="dropdown-divider"></div>
        <a class="dropdown-item disabled"><strong>Security (2020)</strong></a>
        <a class="dropdown-item" href="security-1-2020.html">Security 1</a>
        <a class="dropdown-item" href="security-2-2020.html">Security 2</a>
        <a class="dropdown-item" href="security-3-2020.html">Security 3</a>
        <a class="dropdown-item" href="security-4-2020.html">Security 4</a>
        <div class="dropdown-divider"></div>
        <a class="dropdown-item disabled"><strong>Internet of Things (2020)</strong></a>
        <a class="dropdown-item" href="iot-devices.html">IoT 1: Programming Devices</a>
        <a class="dropdown-item" href="iot-stm.html">IoT 2: State Machines</a>
        <a class="dropdown-item" href="iot-http-json-2020.html">IoT 3: HTTP and JSON</a>
        <a class="dropdown-item" href="iot-http-json-2020-solution.html">IoT 3: HTTP and JSON (Solution and Revised Tasks)</a>
        <a class="dropdown-item" href="iot-mqtt-chat.html">IoT 4: MQTT Chat</a>
        <!--
        <a class="dropdown-item" href="iot-lopy.html">LoPy</a>
        <a class="dropdown-item" href="iot-mqtt.html">MQTT</a>
        <a class="dropdown-item" href="iot-lorawan.html">LoRaWAN / NB-IoT</a>
        <a class="dropdown-item" href="iot-api.html">API</a>-->
      </div>
  </li>
  
  <li class="nav-item dropdown">
    <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">Extra</a>
    <div class="dropdown-menu">
      <a class="dropdown-item disabled"><strong>Learning</strong></a>
      <a class="dropdown-item" href="learning-rats.html">RATs</a>
      <a class="dropdown-item" href="feedback.html">Tilbakemelding</a>
      <a class="dropdown-item" href="reports.html">Rapporter</a>
      <a class="dropdown-item" href="teams.html">Teams</a>
      <a class="dropdown-item" href="working-in-teams.html">Working in Teams</a>
      <a class="dropdown-item" href="tools.html">Learning Tools</a>
      <div class="dropdown-divider"></div>
      <a class="dropdown-item disabled"><strong>Material</strong></a>
      <a class="dropdown-item" href="commands-help.html">Help on Commands</a>
      <a class="dropdown-item" href="commands.html">List of Commands</a>
      <a class="dropdown-item" href="computer-history.html">Extra Videos</a>
      <div class="dropdown-divider"></div>
      <a class="dropdown-item disabled"><strong>Tools</strong></a>
      <a class="dropdown-item" href="virtual-box-mac.html">Virtual Box for Mac</a>
      <a class="dropdown-item" href="virtual-box-win.html">Virtual Box for Windows</a>
      <a class="dropdown-item" href="shell-mac.html">Terminal and SSH on Mac</a>
      <a class="dropdown-item" href="shell-win.html">Terminal and SSH on Windows</a>
    </div>
  </li>
  
  <!--
  <li class="nav-item">
    <a class="nav-link" href="#">Blackboard</a>
  </li>-->
</ul>

<div class="navbar-nav flex-row ml-md-auto d-none d-md-flex"></div>
             <a class="navbar-brand" href="https://ntnu.edu">
      	<svg width="100" height="30">
      		<image xlink:href="https://innsida.ntnu.no/innsida-theme/images/ntnu-graphics/ntnu_logo_white.svg" 
      		src="https://innsida.ntnu.no/innsida-theme/images/ntnu-graphics/ntnu_logo_white.png" width="100%" height="100%"></image>
      	</svg>
      </a>
    </nav>


<div class="page">
    </section>
    <section class="content">
<h1 id="basis-code-for-state-machines">Basis Code for State Machines</h1>
<p>The code below is the basis code for all state machines. Copy this code <strong>before</strong> the definition of your own state machines.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="im">from</span> time <span class="im">import</span> time</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a><span class="im">from</span> microbit <span class="im">import</span> button_a, button_b, accelerometer, display, sleep, Image</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true"></a>ON <span class="op">=</span> Image.SQUARE</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true"></a>OFF <span class="op">=</span> Image.SQUARE_SMALL</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true"></a><span class="kw">class</span> StateMachine:</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true"></a>    <span class="co">&quot;&quot;&quot;</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true"></a><span class="co">    The following code segment defines a basis state machine.</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true"></a><span class="co">    Leave this code as it is. (Or be careful what you do.)&quot;&quot;&quot;</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, timer_names<span class="op">=</span>[<span class="st">&quot;t1&quot;</span>, <span class="st">&quot;t2&quot;</span>, <span class="st">&quot;t3&quot;</span>]):</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true"></a>        <span class="va">self</span>.active <span class="op">=</span> <span class="va">False</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true"></a>        <span class="va">self</span>.state <span class="op">=</span> <span class="st">&quot;initial&quot;</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true"></a>        <span class="va">self</span>.timer_names <span class="op">=</span> timer_names</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true"></a>        <span class="va">self</span>.timers <span class="op">=</span> {}</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true"></a>    <span class="kw">def</span> _ticks_ms(<span class="va">self</span>):</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true"></a>        <span class="cf">return</span> <span class="bu">int</span>(<span class="bu">round</span>(time() <span class="op">*</span> <span class="dv">1000</span>))</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true"></a>    <span class="kw">def</span> initial_transition(<span class="va">self</span>, timers):</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true"></a>        <span class="co">&quot;&quot;&quot;Overwrite this method to define the initial transition.</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true"></a><span class="co">        Must return the name of the first state.&quot;&quot;&quot;</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true"></a></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true"></a>    <span class="kw">def</span> transition(<span class="va">self</span>, state, event, timers):</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true"></a>        <span class="co">&quot;&quot;&quot;Overwrite this method to define the transitions.</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true"></a></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true"></a><span class="co">        `state` - the current state</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true"></a><span class="co">        `event` - the triggering event</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true"></a><span class="co">        `timers` - to start and stop timers</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true"></a></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true"></a><span class="co">        Return the name of the next state,</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true"></a><span class="co">        or None to stay in current state.&quot;&quot;&quot;</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true"></a></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true"></a>    <span class="kw">def</span> start(<span class="va">self</span>, name, timeout):</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true"></a>        <span class="co">&quot;&quot;&quot;Start a timer.</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true"></a><span class="co">        The name must be t1, t2 or t2.</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true"></a><span class="co">        The timeout is given in milliseconds.</span></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true"></a><span class="co">        &quot;&quot;&quot;</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true"></a>        <span class="va">self</span>.timers[name] <span class="op">=</span> <span class="va">self</span>._ticks_ms() <span class="op">+</span> timeout</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true"></a></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true"></a>    <span class="kw">def</span> stop(<span class="va">self</span>, name):</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true"></a>        <span class="co">&quot;&quot;&quot;Stop a timer.&quot;&quot;&quot;</span></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true"></a>        <span class="va">self</span>.timers[name] <span class="op">=</span> <span class="va">None</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true"></a></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true"></a>    <span class="kw">def</span> _detect_event(<span class="va">self</span>):</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true"></a>        now <span class="op">=</span> <span class="va">self</span>._ticks_ms()</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true"></a>        <span class="cf">for</span> timer <span class="kw">in</span> <span class="va">self</span>.timer_names:</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true"></a>            <span class="cf">if</span> (timer <span class="kw">in</span> <span class="va">self</span>.timers) <span class="kw">and</span> (<span class="va">self</span>.timers[timer] <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>):</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true"></a>                <span class="cf">if</span> <span class="va">self</span>.timers[timer] <span class="op">&lt;</span> now:</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true"></a>                    <span class="va">self</span>.timers[timer] <span class="op">=</span> <span class="va">None</span></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true"></a>                    <span class="cf">return</span> timer</span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true"></a>        <span class="cf">if</span> button_a.was_pressed():</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true"></a>            <span class="cf">return</span> <span class="st">&quot;button_a&quot;</span></span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true"></a>        <span class="cf">if</span> button_b.was_pressed():</span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true"></a>            <span class="cf">return</span> <span class="st">&quot;button_b&quot;</span></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true"></a>        <span class="cf">if</span> accelerometer.was_gesture(<span class="st">&quot;shake&quot;</span>):</span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true"></a>            <span class="cf">return</span> <span class="st">&quot;shake&quot;</span></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true"></a>        <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true"></a></span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true"></a>    <span class="kw">def</span> run(<span class="va">self</span>):</span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true"></a>        <span class="co">&quot;&quot;&quot;Run the state machine.&quot;&quot;&quot;</span></span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true"></a>        <span class="va">self</span>.active <span class="op">=</span> <span class="va">True</span></span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true"></a>        <span class="cf">while</span> <span class="va">self</span>.active:</span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true"></a>            <span class="cf">if</span> <span class="va">self</span>.state <span class="op">==</span> <span class="st">&quot;initial&quot;</span>:</span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true"></a>                next_state <span class="op">=</span> <span class="va">self</span>.initial_transition(<span class="va">self</span>)</span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true"></a>                <span class="cf">if</span> next_state:</span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true"></a>                    <span class="cf">if</span> next_state <span class="op">==</span> <span class="st">&quot;final&quot;</span>:</span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true"></a>                        <span class="va">self</span>.active <span class="op">=</span> <span class="va">False</span></span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true"></a>                    <span class="va">self</span>.state <span class="op">=</span> next_state</span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true"></a>            event <span class="op">=</span> <span class="va">self</span>._detect_event()</span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true"></a>            <span class="cf">if</span> event <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true"></a>                next_state <span class="op">=</span> <span class="va">self</span>.transition(<span class="va">self</span>.state, event, <span class="va">self</span>)</span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true"></a>                <span class="cf">if</span> next_state:</span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true"></a>                    <span class="va">self</span>.state <span class="op">=</span> next_state</span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true"></a>            sleep(<span class="dv">100</span>)</span></code></pre></div>
    </section>
    <section class="content">
<h1 id="example-0-counter">Example 0: Counter</h1>
<div class="figure">
<img src="figures/statemachines/counter.svg" width="100%"/>
</div>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="kw">class</span> Counter(StateMachine):</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a>    <span class="co">&quot;&quot;&quot;Counting the number of clicks on button A.</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a><span class="co">    If 10 is reached, an &quot;alarm&quot; is shown by switching all LEDs on.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true"></a><span class="co">    The counter can be reset at any time with button B.</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true"></a>    <span class="kw">def</span> initial_transition(<span class="va">self</span>, timers):</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true"></a>        <span class="va">self</span>.counter <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true"></a>        display.show(<span class="va">self</span>.counter)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true"></a>        <span class="cf">return</span> <span class="st">&quot;count&quot;</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true"></a>    <span class="kw">def</span> transition(<span class="va">self</span>, state, event, timers):</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true"></a>        <span class="cf">if</span> state <span class="op">==</span> <span class="st">&quot;count&quot;</span>:</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true"></a>            <span class="cf">if</span> event <span class="op">==</span> <span class="st">&quot;button_a&quot;</span>:</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true"></a>                <span class="cf">if</span> <span class="va">self</span>.counter <span class="op">&lt;</span> <span class="dv">9</span>:</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true"></a>                    <span class="va">self</span>.counter <span class="op">=</span> <span class="va">self</span>.counter <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true"></a>                    display.show(<span class="va">self</span>.counter)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true"></a>                    <span class="cf">return</span> <span class="st">&quot;count&quot;</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true"></a>                <span class="cf">else</span>:</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true"></a>                    display.show(ON)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true"></a>                    timers.start(<span class="st">&quot;t1&quot;</span>, <span class="dv">1000</span>)</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true"></a>                    <span class="cf">return</span> <span class="st">&quot;alarm&quot;</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true"></a>            <span class="cf">elif</span> event <span class="op">==</span> <span class="st">&quot;button_b&quot;</span>:</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true"></a>                <span class="va">self</span>.counter <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true"></a>                display.show(<span class="va">self</span>.counter)</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true"></a>                <span class="cf">return</span> <span class="st">&quot;count&quot;</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true"></a>        <span class="cf">elif</span> state <span class="op">==</span> <span class="st">&quot;alarm&quot;</span>:</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true"></a>            <span class="cf">if</span> event <span class="op">==</span> <span class="st">&quot;t1&quot;</span>:</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true"></a>                <span class="va">self</span>.counter <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true"></a>                display.show(<span class="va">self</span>.counter)</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true"></a>                <span class="cf">return</span> <span class="st">&quot;count&quot;</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true"></a></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true"></a>stm <span class="op">=</span> Counter()</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true"></a>stm.run()</span></code></pre></div>
    </section>
    <section class="content">
<h1 id="example-1-shake-light">Example 1: Shake Light</h1>
<div class="figure">
<img src="figures/statemachines/stm-shake-light.svg" width="100%"/>
</div>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="kw">class</span> ShakeLight(StateMachine):</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a>    <span class="co">&quot;&quot;&quot;Switch on the light if you shake the device</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a><span class="co">    and turn it off again after 2 seconds.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true"></a>    <span class="kw">def</span> initial_transition(<span class="va">self</span>, timers):</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true"></a>        display.show(OFF)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true"></a>        <span class="cf">return</span> <span class="st">&quot;off&quot;</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true"></a>    <span class="kw">def</span> transition(<span class="va">self</span>, state, event, timers):</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true"></a>        <span class="cf">if</span> state <span class="op">==</span> <span class="st">&quot;off&quot;</span>:</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true"></a>            <span class="cf">if</span> event <span class="op">==</span> <span class="st">&quot;shake&quot;</span>:</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true"></a>                display.show(ON)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true"></a>                timers.start(<span class="st">&quot;t1&quot;</span>, <span class="dv">2000</span>)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true"></a>                <span class="cf">return</span> <span class="st">&quot;on&quot;</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true"></a>        <span class="cf">elif</span> state <span class="op">==</span> <span class="st">&quot;on&quot;</span>:</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true"></a>            <span class="cf">if</span> event <span class="op">==</span> <span class="st">&quot;t1&quot;</span>:</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true"></a>                display.show(OFF)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true"></a>                <span class="cf">return</span> <span class="st">&quot;off&quot;</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true"></a></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true"></a>stm <span class="op">=</span> ShakeLight()</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true"></a>stm.run()</span></code></pre></div>
    </section>
    <section class="content">
<h1 id="example-2-night-light">Example 2: Night Light</h1>
<div class="figure">
<img src="figures/statemachines/stm-night-light.svg" width="100%"/>
</div>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="kw">class</span> NightLight(StateMachine):</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a>    <span class="co">&quot;&quot;&quot;Periodically read the light level.</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a><span class="co">    If the light level is above 100, switch on the light.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true"></a><span class="co">    If it is below 80, switch the light off again.</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true"></a>    <span class="kw">def</span> initial_transition(<span class="va">self</span>, timers):</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true"></a>        display.show(OFF)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true"></a>        timers.start(<span class="st">&quot;t1&quot;</span>, <span class="dv">1000</span>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true"></a>        <span class="cf">return</span> <span class="st">&quot;off&quot;</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true"></a>    <span class="kw">def</span> transition(<span class="va">self</span>, state, event, timers):</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true"></a>        <span class="cf">if</span> state <span class="op">==</span> <span class="st">&quot;off&quot;</span>:</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true"></a>            <span class="cf">if</span> event <span class="op">==</span> <span class="st">&quot;t1&quot;</span>:</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true"></a>                <span class="cf">if</span> display.read_light_level() <span class="op">&gt;</span> <span class="dv">100</span>:</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true"></a>                    display.show(ON)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true"></a>                    timers.start(<span class="st">&quot;t1&quot;</span>, <span class="dv">1000</span>)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true"></a>                    <span class="cf">return</span> <span class="st">&quot;on&quot;</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true"></a>                <span class="cf">else</span>:</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true"></a>                    timers.start(<span class="st">&quot;t1&quot;</span>, <span class="dv">1000</span>)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true"></a>                    <span class="cf">return</span> <span class="st">&quot;off&quot;</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true"></a>        <span class="cf">elif</span> <span class="va">self</span>.state <span class="op">==</span> <span class="st">&quot;on&quot;</span>:</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true"></a>            <span class="cf">if</span> event <span class="op">==</span> <span class="st">&quot;t1&quot;</span>:</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true"></a>                <span class="cf">if</span> display.read_light_level() <span class="op">&lt;</span> <span class="dv">80</span>:</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true"></a>                    display.show(OFF)</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true"></a>                    timers.start(<span class="st">&quot;t1&quot;</span>, <span class="dv">1000</span>)</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true"></a>                    <span class="cf">return</span> <span class="st">&quot;off&quot;</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true"></a>                <span class="cf">else</span>:</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true"></a>                    timers.start(<span class="st">&quot;t1&quot;</span>, <span class="dv">1000</span>)</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true"></a>                    <span class="cf">return</span> <span class="st">&quot;on&quot;</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true"></a></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true"></a>stm <span class="op">=</span> NightLight()</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true"></a>stm.run()</span></code></pre></div>
    </section>
    <section class="content">
<h1 id="example-3-switch-light">Example 3: Switch Light</h1>
<div class="figure">
<img src="figures/statemachines/stm-switch-light.svg" width="100%"/>
</div>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="kw">class</span> SwitchLight(StateMachine):</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a>    <span class="co">&quot;&quot;&quot;Switch between states off and on by pressing button A.</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true"></a><span class="co">    The change between on and off only happens if button A is pressed</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true"></a><span class="co">    twice quickly.</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true"></a><span class="co">    State off is represented by a small square,</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true"></a><span class="co">    state on with a big suqare.</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true"></a><span class="co">    The transitional states between on and off are shown</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true"></a><span class="co">    with arrows up and down.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true"></a><span class="co">    &quot;&quot;&quot;</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true"></a>    <span class="kw">def</span> initial_transition(<span class="va">self</span>, timers):</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true"></a>        display.show(OFF)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true"></a>        <span class="cf">return</span> <span class="st">&quot;off&quot;</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true"></a>    <span class="kw">def</span> transition(<span class="va">self</span>, state, event, timers):</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true"></a>        <span class="cf">if</span> state <span class="op">==</span> <span class="st">&quot;off&quot;</span>:</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true"></a>            <span class="cf">if</span> event <span class="op">==</span> <span class="st">&quot;button_a&quot;</span>:</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true"></a>                display.show(Image.ARROW_N)</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true"></a>                timers.start(<span class="st">&quot;t1&quot;</span>, <span class="dv">300</span>)</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true"></a>                <span class="cf">return</span> <span class="st">&quot;almost_on&quot;</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true"></a>        <span class="cf">elif</span> state <span class="op">==</span> <span class="st">&quot;almost_on&quot;</span>:</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true"></a>            <span class="cf">if</span> event <span class="op">==</span> <span class="st">&quot;button_a&quot;</span>:</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true"></a>                display.show(ON)</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true"></a>                <span class="cf">return</span> <span class="st">&quot;on&quot;</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true"></a>            <span class="cf">elif</span> event <span class="op">==</span> <span class="st">&quot;t1&quot;</span>:</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true"></a>                display.show(OFF)</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true"></a>                <span class="cf">return</span> <span class="st">&quot;off&quot;</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true"></a>        <span class="cf">elif</span> state <span class="op">==</span> <span class="st">&quot;on&quot;</span>:</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true"></a>            <span class="cf">if</span> event <span class="op">==</span> <span class="st">&quot;button_a&quot;</span>:</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true"></a>                display.show(Image.ARROW_S)</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true"></a>                timers.start(<span class="st">&quot;t2&quot;</span>, <span class="dv">300</span>)</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true"></a>                <span class="cf">return</span> <span class="st">&quot;almost_off&quot;</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true"></a>        <span class="cf">elif</span> state <span class="op">==</span> <span class="st">&quot;almost_off&quot;</span>:</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true"></a>            <span class="cf">if</span> event <span class="op">==</span> <span class="st">&quot;button_a&quot;</span>:</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true"></a>                display.show(OFF)</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true"></a>                <span class="cf">return</span> <span class="st">&quot;off&quot;</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true"></a>            <span class="cf">elif</span> event <span class="op">==</span> <span class="st">&quot;t2&quot;</span>:</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true"></a>                display.show(ON)</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true"></a>                <span class="cf">return</span> <span class="st">&quot;on&quot;</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true"></a></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true"></a>stm <span class="op">=</span> SwitchLight()</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true"></a>stm.run()</span></code></pre></div>
    </section>
</div>


<footer></footer>
<script>
    anchors.add('h1').add('h2').add('h3');
    anchors.options.visible = 'always';
</script>
</body>
</html>
