<html lang="en-US"><head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1"/>

<title>TTM4175</title>
<meta property="og:title" content="TTM4175">
<meta property="og:locale" content="en_US">
<meta name="description" content="Introduction to Communication Technology and Digital Security">
<meta property="og:description" content="Introduction to Communication Technology and Digital Security">


<!--<link rel="stylesheet" type="text/css" href="style.css" />-->
<link href="https://fonts.googleapis.com/css?family=Merriweather:400,400italic,700,700italic|Source+Code+Pro|Source+Sans+Pro:200,300,400,600,400italic,600italic|Rock+Salt" rel="stylesheet" type="text/css">


<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>


<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.1/css/all.css" integrity="sha384-gfdkjb5BdAXd+lj+gudLWI+BXq4IuLW5IT+brZEZsLFm++aCMlF1V92rMkPaX4PP" crossorigin="anonymous">

<link rel="stylesheet" type="text/css" href="assets/style.css" />

<!--<script src="jquery-1.10.1.min.js"></script>-->
<script src="assets/script-aside.js"></script>
</head>
<body id="top">

<nav class="navbar navbar-expand-md navbar-dark " style="background-color:#666666"#2B65EC"> <!-- fixed-top -->
        <ul class="nav nav-pills">
        <li class="nav-item">
    <a class="nav-link" href="index.html" style="font-weight: bold")>TTM4175</a>
  </li>

  <li class="nav-item dropdown">
    <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">Teknostart</a>
    <div class="dropdown-menu">
      <a class="dropdown-item" href="day0-2020.html">Dag 0: Getting Started</a>
      <a class="dropdown-item" href="day1-2020.html">Dag 1: Virtual Box</a>
      <a class="dropdown-item" href="day2-2020.html">Dag 2: Linux Command Line</a>
      <a class="dropdown-item" href="day3-2020.html">Dag 3: SSH and HTML</a>
      <div class="dropdown-divider"></div>
      <a class="dropdown-item" href="tips.html">Tips</a>
    </div>
  </li>
        
  <li class="nav-item dropdown">
    <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">Preparation</a>
    <div class="dropdown-menu">
      <a class="dropdown-item disabled"><strong>Networking</strong></a>
      <a class="dropdown-item" href="prep-networking-1-2020.html">Binary and IP addresses</a>
      <a class="dropdown-item" href="prep-networking-2-2020.html">Layers and Docker</a>
      <a class="dropdown-item" href="prep-networking-3-2020.html">Webservers and DNS</a>
      <div class="dropdown-divider"></div>
      <a class="dropdown-item disabled"><strong>Security</strong></a>
      <a class="dropdown-item" href="prep-security-1-2020.html">Security 1: Cyber Security and Ethical Hacking </a>
      <a class="dropdown-item" href="prep-security-2-2020.html">Security 2: Authentication, Authorization, and Password Storage</a>
      <a class="dropdown-item" href="prep-security-3-2020.html">Security 3: Passwords and Cryptography</a>
      <a class="dropdown-item" href="prep-security-4-2020.html">Security 4: Security Vulnerabilities</a>
      <div class="dropdown-divider"></div>
      <a class="dropdown-item disabled"><strong>Internet of Things</strong></a>
      <a class="dropdown-item" href="prep-iot-intro.html">IoT 1: Introduction</a>
      <a class="dropdown-item" href="prep-iot-devices.html">IoT 1: Installation</a>
      <a class="dropdown-item" href="prep-iot-stm.html">IoT 2: State Machines</a>
      <a class="dropdown-item" href="prep-iot-stmpy.html">IoT 2: State Machines in Micro Python</a>
      <!--
      <a class="dropdown-item" href="prep-iot-http-json.html">IoT 2: HTTP and JSON</a>
      <a class="dropdown-item" href="prep-iot-mqtt.html">IoT 3: MQTT</a>
      <a class="dropdown-item" href="prep-iot-api.html">IoT 4: APIs</a>
      <a class="dropdown-item" href="prep-iot-nb-iot.html">NB-IoT (Extra)</a>-->
    </div>
  </li>
  
  <li class="nav-item dropdown">
    <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">Labs</a>
    <div class="dropdown-menu">
        <a class="dropdown-item disabled"><strong>Networking</strong></a>
        <a class="dropdown-item" href="networking-1-2020.html">Binary and IP addresses</a>
        <a class="dropdown-item" href="networking-2-2020.html">Layers and Docker</a>
        <a class="dropdown-item" href="networking-3-2020.html">Webservers and DNS</a>
        <div class="dropdown-divider"></div>
        <a class="dropdown-item disabled"><strong>Security</strong></a>
        <a class="dropdown-item" href="security-1-2020.html">Security 1</a>
        <a class="dropdown-item" href="security-2-2020.html">Security 2</a>
        <a class="dropdown-item" href="security-3-2020.html">Security 3</a>
        <a class="dropdown-item" href="security-4-2020.html">Security 4</a>
        <div class="dropdown-divider"></div>
        <a class="dropdown-item disabled"><strong>Internet of Things</strong></a>
        <a class="dropdown-item" href="iot-devices.html">IoT 1: Programming Devices</a>
        <!--
        <a class="dropdown-item" href="iot-lopy.html">LoPy</a>
        <a class="dropdown-item" href="iot-http-json.html">HTTP and JSON</a>
        <a class="dropdown-item" href="iot-mqtt.html">MQTT</a>
        <a class="dropdown-item" href="iot-lorawan.html">LoRaWAN / NB-IoT</a>
        <a class="dropdown-item" href="iot-api.html">API</a>-->
      </div>
  </li>
  
  <li class="nav-item dropdown">
    <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">Extra</a>
    <div class="dropdown-menu">
      <a class="dropdown-item disabled"><strong>Learning</strong></a>
      <a class="dropdown-item" href="learning-rats.html">RATs</a>
      <a class="dropdown-item" href="feedback.html">Tilbakemelding</a>
      <a class="dropdown-item" href="reports.html">Rapporter</a>
      <a class="dropdown-item" href="teams.html">Teams</a>
      <a class="dropdown-item" href="working-in-teams.html">Working in Teams</a>
      <a class="dropdown-item" href="tools.html">Learning Tools</a>
      <div class="dropdown-divider"></div>
      <a class="dropdown-item disabled"><strong>Material</strong></a>
      <a class="dropdown-item" href="commands-help.html">Help on Commands</a>
      <a class="dropdown-item" href="commands.html">List of Commands</a>
      <a class="dropdown-item" href="computer-history.html">Extra Videos</a>
      <div class="dropdown-divider"></div>
      <a class="dropdown-item disabled"><strong>Tools</strong></a>
      <a class="dropdown-item" href="virtual-box-mac.html">Virtual Box for Mac</a>
      <a class="dropdown-item" href="virtual-box-win.html">Virtual Box for Windows</a>
      <a class="dropdown-item" href="shell-mac.html">Terminal and SSH on Mac</a>
      <a class="dropdown-item" href="shell-win.html">Terminal and SSH on Windows</a>
    </div>
  </li>
  
  <!--
  <li class="nav-item">
    <a class="nav-link" href="#">Blackboard</a>
  </li>-->
</ul>

<div class="navbar-nav flex-row ml-md-auto d-none d-md-flex"></div>
             <a class="navbar-brand" href="https://ntnu.edu">
      	<svg width="100" height="30">
      		<image xlink:href="https://innsida.ntnu.no/innsida-theme/images/ntnu-graphics/ntnu_logo_white.svg" 
      		src="https://innsida.ntnu.no/innsida-theme/images/ntnu-graphics/ntnu_logo_white.png" width="100%" height="100%"></image>
      	</svg>
      </a>
    </nav>


<div class="page">
    </section>
    <section class="content">
<h1 id="basis-code-for-state-machines">Basis Code for State Machines</h1>
<p>The code below is the basis code for all state machines. Copy this code <strong>before</strong> the definition of your own state machines.</p>

<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb1-1" title="1"><span class="im">from</span> time <span class="im">import</span> time</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="im">from</span> microbit <span class="im">import</span> button_a, button_b, accelerometer, display, sleep, Image</a>
<a class="sourceLine" id="cb1-3" title="3"></a>
<a class="sourceLine" id="cb1-4" title="4">ON <span class="op">=</span> Image.SQUARE</a>
<a class="sourceLine" id="cb1-5" title="5">OFF <span class="op">=</span> Image.SQUARE_SMALL</a>
<a class="sourceLine" id="cb1-6" title="6"></a>
<a class="sourceLine" id="cb1-7" title="7"></a>
<a class="sourceLine" id="cb1-8" title="8"><span class="kw">class</span> StateMachine:</a>
<a class="sourceLine" id="cb1-9" title="9">    <span class="co">&quot;&quot;&quot;</span></a>
<a class="sourceLine" id="cb1-10" title="10"><span class="co">    The following code segment defines a basis state machine.</span></a>
<a class="sourceLine" id="cb1-11" title="11"><span class="co">    Leave this code as it is. (Or be careful what you do.)&quot;&quot;&quot;</span></a>
<a class="sourceLine" id="cb1-12" title="12"></a>
<a class="sourceLine" id="cb1-13" title="13">    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, timer_names<span class="op">=</span>[<span class="st">&quot;t1&quot;</span>, <span class="st">&quot;t2&quot;</span>, <span class="st">&quot;t3&quot;</span>]):</a>
<a class="sourceLine" id="cb1-14" title="14">        <span class="va">self</span>.active <span class="op">=</span> <span class="va">False</span></a>
<a class="sourceLine" id="cb1-15" title="15">        <span class="va">self</span>.state <span class="op">=</span> <span class="st">&quot;initial&quot;</span></a>
<a class="sourceLine" id="cb1-16" title="16">        <span class="va">self</span>.timer_names <span class="op">=</span> timer_names</a>
<a class="sourceLine" id="cb1-17" title="17">        <span class="va">self</span>.timers <span class="op">=</span> {}</a>
<a class="sourceLine" id="cb1-18" title="18"></a>
<a class="sourceLine" id="cb1-19" title="19">    <span class="kw">def</span> _ticks_ms(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb1-20" title="20">        <span class="cf">return</span> <span class="bu">int</span>(<span class="bu">round</span>(time() <span class="op">*</span> <span class="dv">1000</span>))</a>
<a class="sourceLine" id="cb1-21" title="21"></a>
<a class="sourceLine" id="cb1-22" title="22">    <span class="kw">def</span> initial_transition(<span class="va">self</span>, timers):</a>
<a class="sourceLine" id="cb1-23" title="23">        <span class="co">&quot;&quot;&quot;Overwrite this method to define the initial transition.</span></a>
<a class="sourceLine" id="cb1-24" title="24"><span class="co">        Must return the name of the first state.&quot;&quot;&quot;</span></a>
<a class="sourceLine" id="cb1-25" title="25">        <span class="cf">return</span> <span class="va">None</span></a>
<a class="sourceLine" id="cb1-26" title="26"></a>
<a class="sourceLine" id="cb1-27" title="27">    <span class="kw">def</span> transition(<span class="va">self</span>, state, event, timers):</a>
<a class="sourceLine" id="cb1-28" title="28">        <span class="co">&quot;&quot;&quot;Overwrite this method to define the transitions.</span></a>
<a class="sourceLine" id="cb1-29" title="29"></a>
<a class="sourceLine" id="cb1-30" title="30"><span class="co">        `state` - the current state</span></a>
<a class="sourceLine" id="cb1-31" title="31"><span class="co">        `event` - the triggering event</span></a>
<a class="sourceLine" id="cb1-32" title="32"><span class="co">        `timers` - to start and stop timers</span></a>
<a class="sourceLine" id="cb1-33" title="33"></a>
<a class="sourceLine" id="cb1-34" title="34"><span class="co">        Return the name of the next state,</span></a>
<a class="sourceLine" id="cb1-35" title="35"><span class="co">        or None to stay in current state.&quot;&quot;&quot;</span></a>
<a class="sourceLine" id="cb1-36" title="36">        <span class="cf">return</span> <span class="va">None</span></a>
<a class="sourceLine" id="cb1-37" title="37"></a>
<a class="sourceLine" id="cb1-38" title="38">    <span class="kw">def</span> start(<span class="va">self</span>, name, timeout):</a>
<a class="sourceLine" id="cb1-39" title="39">        <span class="co">&quot;&quot;&quot;Start a timer.</span></a>
<a class="sourceLine" id="cb1-40" title="40"><span class="co">        The name must be t1, t2 or t2.</span></a>
<a class="sourceLine" id="cb1-41" title="41"><span class="co">        The timeout is given in milliseconds.</span></a>
<a class="sourceLine" id="cb1-42" title="42"><span class="co">        &quot;&quot;&quot;</span></a>
<a class="sourceLine" id="cb1-43" title="43">        <span class="va">self</span>.timers[name] <span class="op">=</span> <span class="va">self</span>._ticks_ms() <span class="op">+</span> timeout</a>
<a class="sourceLine" id="cb1-44" title="44"></a>
<a class="sourceLine" id="cb1-45" title="45">    <span class="kw">def</span> stop(<span class="va">self</span>, name):</a>
<a class="sourceLine" id="cb1-46" title="46">        <span class="co">&quot;&quot;&quot;Stop a timer.&quot;&quot;&quot;</span></a>
<a class="sourceLine" id="cb1-47" title="47">        <span class="va">self</span>.timers[name] <span class="op">=</span> <span class="va">None</span></a>
<a class="sourceLine" id="cb1-48" title="48"></a>
<a class="sourceLine" id="cb1-49" title="49">    <span class="kw">def</span> _detect_event(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb1-50" title="50">        now <span class="op">=</span> <span class="va">self</span>._ticks_ms()</a>
<a class="sourceLine" id="cb1-51" title="51">        <span class="cf">for</span> timer <span class="kw">in</span> <span class="va">self</span>.timer_names:</a>
<a class="sourceLine" id="cb1-52" title="52">            <span class="cf">if</span> (timer <span class="kw">in</span> <span class="va">self</span>.timers) <span class="kw">and</span> (<span class="va">self</span>.timers[timer] <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>):</a>
<a class="sourceLine" id="cb1-53" title="53">                <span class="cf">if</span> <span class="va">self</span>.timers[timer] <span class="op">&lt;</span> now:</a>
<a class="sourceLine" id="cb1-54" title="54">                    <span class="va">self</span>.timers[timer] <span class="op">=</span> <span class="va">None</span></a>
<a class="sourceLine" id="cb1-55" title="55">                    <span class="cf">return</span> timer</a>
<a class="sourceLine" id="cb1-56" title="56">        <span class="cf">if</span> button_a.was_pressed():</a>
<a class="sourceLine" id="cb1-57" title="57">            <span class="cf">return</span> <span class="st">&quot;button_a&quot;</span></a>
<a class="sourceLine" id="cb1-58" title="58">        <span class="cf">if</span> button_b.was_pressed():</a>
<a class="sourceLine" id="cb1-59" title="59">            <span class="cf">return</span> <span class="st">&quot;button_b&quot;</span></a>
<a class="sourceLine" id="cb1-60" title="60">        <span class="cf">if</span> accelerometer.was_gesture(<span class="st">&quot;shake&quot;</span>):</a>
<a class="sourceLine" id="cb1-61" title="61">            <span class="cf">return</span> <span class="st">&quot;shake&quot;</span></a>
<a class="sourceLine" id="cb1-62" title="62">        <span class="cf">return</span> <span class="va">None</span></a>
<a class="sourceLine" id="cb1-63" title="63"></a>
<a class="sourceLine" id="cb1-64" title="64">    <span class="kw">def</span> run(<span class="va">self</span>):</a>
<a class="sourceLine" id="cb1-65" title="65">        <span class="co">&quot;&quot;&quot;Run the state machine.&quot;&quot;&quot;</span></a>
<a class="sourceLine" id="cb1-66" title="66">        <span class="va">self</span>.active <span class="op">=</span> <span class="va">True</span></a>
<a class="sourceLine" id="cb1-67" title="67">        <span class="cf">while</span> <span class="va">self</span>.active:</a>
<a class="sourceLine" id="cb1-68" title="68">            <span class="cf">if</span> <span class="va">self</span>.state <span class="op">==</span> <span class="st">&quot;initial&quot;</span>:</a>
<a class="sourceLine" id="cb1-69" title="69">                next_state <span class="op">=</span> <span class="va">self</span>.initial_transition(<span class="va">self</span>)</a>
<a class="sourceLine" id="cb1-70" title="70">                <span class="cf">if</span> next_state:</a>
<a class="sourceLine" id="cb1-71" title="71">                    <span class="cf">if</span> next_state <span class="op">==</span> <span class="st">&quot;final&quot;</span>:</a>
<a class="sourceLine" id="cb1-72" title="72">                        <span class="va">self</span>.active <span class="op">=</span> <span class="va">False</span></a>
<a class="sourceLine" id="cb1-73" title="73">                    <span class="va">self</span>.state <span class="op">=</span> next_state</a>
<a class="sourceLine" id="cb1-74" title="74">            event <span class="op">=</span> <span class="va">self</span>._detect_event()</a>
<a class="sourceLine" id="cb1-75" title="75">            <span class="cf">if</span> event <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</a>
<a class="sourceLine" id="cb1-76" title="76">                next_state <span class="op">=</span> <span class="va">self</span>.transition(<span class="va">self</span>.state, event, <span class="va">self</span>)</a>
<a class="sourceLine" id="cb1-77" title="77">                <span class="cf">if</span> next_state:</a>
<a class="sourceLine" id="cb1-78" title="78">                    <span class="va">self</span>.state <span class="op">=</span> next_state</a>
<a class="sourceLine" id="cb1-79" title="79">            sleep(<span class="dv">100</span>)</a></code></pre></div>

    </section>
    <section class="content">
<h1 id="example-1-shake-light">Example 1: Shake Light</h1>

<div class="figure">
<img src="figures/statemachines/stm-shake-light.svg" width="100%"/>
</div>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">class</span> ShakeLight(StateMachine):</a>
<a class="sourceLine" id="cb1-2" title="2">    <span class="co">&quot;&quot;&quot;Switch on the light if you shake the device</span></a>
<a class="sourceLine" id="cb1-3" title="3"><span class="co">    and turn it off again after 2 seconds.</span></a>
<a class="sourceLine" id="cb1-4" title="4"><span class="co">    &quot;&quot;&quot;</span></a>
<a class="sourceLine" id="cb1-5" title="5"></a>
<a class="sourceLine" id="cb1-6" title="6">    <span class="kw">def</span> initial_transition(<span class="va">self</span>, timers):</a>
<a class="sourceLine" id="cb1-7" title="7">        display.show(OFF)</a>
<a class="sourceLine" id="cb1-8" title="8">        <span class="cf">return</span> <span class="st">&quot;off&quot;</span></a>
<a class="sourceLine" id="cb1-9" title="9"></a>
<a class="sourceLine" id="cb1-10" title="10">    <span class="kw">def</span> transition(<span class="va">self</span>, state, event, timers):</a>
<a class="sourceLine" id="cb1-11" title="11">        <span class="cf">if</span> state <span class="op">==</span> <span class="st">&quot;off&quot;</span>:</a>
<a class="sourceLine" id="cb1-12" title="12">            <span class="cf">if</span> event <span class="op">==</span> <span class="st">&quot;shake&quot;</span>:</a>
<a class="sourceLine" id="cb1-13" title="13">                display.show(ON)</a>
<a class="sourceLine" id="cb1-14" title="14">                timers.start(<span class="st">&quot;t1&quot;</span>, <span class="dv">2000</span>)</a>
<a class="sourceLine" id="cb1-15" title="15">                <span class="cf">return</span> <span class="st">&quot;on&quot;</span></a>
<a class="sourceLine" id="cb1-16" title="16">        <span class="cf">elif</span> state <span class="op">==</span> <span class="st">&quot;on&quot;</span>:</a>
<a class="sourceLine" id="cb1-17" title="17">            <span class="cf">if</span> event <span class="op">==</span> <span class="st">&quot;t1&quot;</span>:</a>
<a class="sourceLine" id="cb1-18" title="18">                display.show(OFF)</a>
<a class="sourceLine" id="cb1-19" title="19">                <span class="cf">return</span> <span class="st">&quot;off&quot;</span></a>
<a class="sourceLine" id="cb1-20" title="20"></a>
<a class="sourceLine" id="cb1-21" title="21">stm <span class="op">=</span> ShakeLight()</a>
<a class="sourceLine" id="cb1-22" title="22">stm.run()</a></code></pre></div>

    </section>
    <section class="content">
<h1 id="example-2-night-light">Example 2: Night Light</h1>

<div class="figure">
<img src="figures/statemachines/stm-night-light.svg" width="100%"/>
</div>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">class</span> NightLight(StateMachine):</a>
<a class="sourceLine" id="cb1-2" title="2">    <span class="co">&quot;&quot;&quot;Periodically read the light level.</span></a>
<a class="sourceLine" id="cb1-3" title="3"><span class="co">    If the light level is above 100, switch on the light.</span></a>
<a class="sourceLine" id="cb1-4" title="4"><span class="co">    If it is below 80, switch the light off again.</span></a>
<a class="sourceLine" id="cb1-5" title="5"><span class="co">    &quot;&quot;&quot;</span></a>
<a class="sourceLine" id="cb1-6" title="6"></a>
<a class="sourceLine" id="cb1-7" title="7">    <span class="kw">def</span> initial_transition(<span class="va">self</span>, timers):</a>
<a class="sourceLine" id="cb1-8" title="8">        display.show(OFF)</a>
<a class="sourceLine" id="cb1-9" title="9">        timers.start(<span class="st">&quot;t1&quot;</span>, <span class="dv">1000</span>)</a>
<a class="sourceLine" id="cb1-10" title="10">        <span class="cf">return</span> <span class="st">&quot;off&quot;</span></a>
<a class="sourceLine" id="cb1-11" title="11"></a>
<a class="sourceLine" id="cb1-12" title="12">    <span class="kw">def</span> transition(<span class="va">self</span>, state, event, timers):</a>
<a class="sourceLine" id="cb1-13" title="13">        <span class="cf">if</span> state <span class="op">==</span> <span class="st">&quot;off&quot;</span>:</a>
<a class="sourceLine" id="cb1-14" title="14">            <span class="cf">if</span> event <span class="op">==</span> <span class="st">&quot;t1&quot;</span>:</a>
<a class="sourceLine" id="cb1-15" title="15">                <span class="cf">if</span> display.read_light_level() <span class="op">&gt;</span> <span class="dv">100</span>:</a>
<a class="sourceLine" id="cb1-16" title="16">                    display.show(ON)</a>
<a class="sourceLine" id="cb1-17" title="17">                    timers.start(<span class="st">&quot;t1&quot;</span>, <span class="dv">1000</span>)</a>
<a class="sourceLine" id="cb1-18" title="18">                    <span class="cf">return</span> <span class="st">&quot;on&quot;</span></a>
<a class="sourceLine" id="cb1-19" title="19">                <span class="cf">else</span>:</a>
<a class="sourceLine" id="cb1-20" title="20">                    timers.start(<span class="st">&quot;t1&quot;</span>, <span class="dv">1000</span>)</a>
<a class="sourceLine" id="cb1-21" title="21">                    <span class="cf">return</span> <span class="st">&quot;off&quot;</span></a>
<a class="sourceLine" id="cb1-22" title="22">        <span class="cf">elif</span> <span class="va">self</span>.state <span class="op">==</span> <span class="st">&quot;on&quot;</span>:</a>
<a class="sourceLine" id="cb1-23" title="23">            <span class="cf">if</span> event <span class="op">==</span> <span class="st">&quot;t1&quot;</span>:</a>
<a class="sourceLine" id="cb1-24" title="24">                <span class="cf">if</span> display.read_light_level() <span class="op">&lt;</span> <span class="dv">80</span>:</a>
<a class="sourceLine" id="cb1-25" title="25">                    display.show(OFF)</a>
<a class="sourceLine" id="cb1-26" title="26">                    timers.start(<span class="st">&quot;t1&quot;</span>, <span class="dv">1000</span>)</a>
<a class="sourceLine" id="cb1-27" title="27">                    <span class="cf">return</span> <span class="st">&quot;off&quot;</span></a>
<a class="sourceLine" id="cb1-28" title="28">                <span class="cf">else</span>:</a>
<a class="sourceLine" id="cb1-29" title="29">                    timers.start(<span class="st">&quot;t1&quot;</span>, <span class="dv">1000</span>)</a>
<a class="sourceLine" id="cb1-30" title="30">                    <span class="cf">return</span> <span class="st">&quot;on&quot;</span></a>
<a class="sourceLine" id="cb1-31" title="31"></a>
<a class="sourceLine" id="cb1-32" title="32">stm <span class="op">=</span> NightLight()</a>
<a class="sourceLine" id="cb1-33" title="33">stm.run()</a></code></pre></div>

    </section>
    <section class="content">
<h1 id="example-3-switch-light">Example 3: Switch Light</h1>

<div class="figure">
<img src="figures/statemachines/stm-switch-light.svg" width="100%"/>
</div>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">class</span> SwitchLight(StateMachine):</a>
<a class="sourceLine" id="cb1-2" title="2">    <span class="co">&quot;&quot;&quot;Switch between states off and on by pressing button A.</span></a>
<a class="sourceLine" id="cb1-3" title="3"></a>
<a class="sourceLine" id="cb1-4" title="4"><span class="co">    The change between on and off only happens if button A is pressed</span></a>
<a class="sourceLine" id="cb1-5" title="5"><span class="co">    twice quickly.</span></a>
<a class="sourceLine" id="cb1-6" title="6"></a>
<a class="sourceLine" id="cb1-7" title="7"><span class="co">    State off is represented by a small square,</span></a>
<a class="sourceLine" id="cb1-8" title="8"><span class="co">    state on with a big suqare.</span></a>
<a class="sourceLine" id="cb1-9" title="9"></a>
<a class="sourceLine" id="cb1-10" title="10"><span class="co">    The transitional states between on and off are shown</span></a>
<a class="sourceLine" id="cb1-11" title="11"><span class="co">    with arrows up and down.</span></a>
<a class="sourceLine" id="cb1-12" title="12"><span class="co">    &quot;&quot;&quot;</span></a>
<a class="sourceLine" id="cb1-13" title="13"></a>
<a class="sourceLine" id="cb1-14" title="14">    <span class="kw">def</span> initial_transition(<span class="va">self</span>, timers):</a>
<a class="sourceLine" id="cb1-15" title="15">        display.show(OFF)</a>
<a class="sourceLine" id="cb1-16" title="16">        <span class="cf">return</span> <span class="st">&quot;off&quot;</span></a>
<a class="sourceLine" id="cb1-17" title="17"></a>
<a class="sourceLine" id="cb1-18" title="18">    <span class="kw">def</span> transition(<span class="va">self</span>, state, event, timers):</a>
<a class="sourceLine" id="cb1-19" title="19">        <span class="cf">if</span> state <span class="op">==</span> <span class="st">&quot;off&quot;</span>:</a>
<a class="sourceLine" id="cb1-20" title="20">            <span class="cf">if</span> event <span class="op">==</span> <span class="st">&quot;button_a&quot;</span>:</a>
<a class="sourceLine" id="cb1-21" title="21">                display.show(Image.ARROW_N)</a>
<a class="sourceLine" id="cb1-22" title="22">                timers.start(<span class="st">&quot;t1&quot;</span>, <span class="dv">300</span>)</a>
<a class="sourceLine" id="cb1-23" title="23">                <span class="cf">return</span> <span class="st">&quot;almost_on&quot;</span></a>
<a class="sourceLine" id="cb1-24" title="24">        <span class="cf">elif</span> state <span class="op">==</span> <span class="st">&quot;almost_on&quot;</span>:</a>
<a class="sourceLine" id="cb1-25" title="25">            <span class="cf">if</span> event <span class="op">==</span> <span class="st">&quot;button_a&quot;</span>:</a>
<a class="sourceLine" id="cb1-26" title="26">                display.show(ON)</a>
<a class="sourceLine" id="cb1-27" title="27">                <span class="cf">return</span> <span class="st">&quot;on&quot;</span></a>
<a class="sourceLine" id="cb1-28" title="28">            <span class="cf">elif</span> event <span class="op">==</span> <span class="st">&quot;t1&quot;</span>:</a>
<a class="sourceLine" id="cb1-29" title="29">                display.show(OFF)</a>
<a class="sourceLine" id="cb1-30" title="30">                <span class="cf">return</span> <span class="st">&quot;off&quot;</span></a>
<a class="sourceLine" id="cb1-31" title="31">        <span class="cf">elif</span> state <span class="op">==</span> <span class="st">&quot;on&quot;</span>:</a>
<a class="sourceLine" id="cb1-32" title="32">            <span class="cf">if</span> event <span class="op">==</span> <span class="st">&quot;button_a&quot;</span>:</a>
<a class="sourceLine" id="cb1-33" title="33">                display.show(Image.ARROW_S)</a>
<a class="sourceLine" id="cb1-34" title="34">                timers.start(<span class="st">&quot;t2&quot;</span>, <span class="dv">300</span>)</a>
<a class="sourceLine" id="cb1-35" title="35">                <span class="cf">return</span> <span class="st">&quot;almost_off&quot;</span></a>
<a class="sourceLine" id="cb1-36" title="36">        <span class="cf">elif</span> state <span class="op">==</span> <span class="st">&quot;almost_off&quot;</span>:</a>
<a class="sourceLine" id="cb1-37" title="37">            <span class="cf">if</span> event <span class="op">==</span> <span class="st">&quot;button_a&quot;</span>:</a>
<a class="sourceLine" id="cb1-38" title="38">                display.show(OFF)</a>
<a class="sourceLine" id="cb1-39" title="39">                <span class="cf">return</span> <span class="st">&quot;off&quot;</span></a>
<a class="sourceLine" id="cb1-40" title="40">            <span class="cf">elif</span> event <span class="op">==</span> <span class="st">&quot;t2&quot;</span>:</a>
<a class="sourceLine" id="cb1-41" title="41">                display.show(ON)</a>
<a class="sourceLine" id="cb1-42" title="42">                <span class="cf">return</span> <span class="st">&quot;on&quot;</span></a>
<a class="sourceLine" id="cb1-43" title="43"></a>
<a class="sourceLine" id="cb1-44" title="44">stm <span class="op">=</span> SwitchLight()</a>
<a class="sourceLine" id="cb1-45" title="45">stm.run()</a></code></pre></div>

    </section>
</div>


<footer></footer>
</body>
</html>
