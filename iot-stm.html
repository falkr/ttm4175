<html lang="en-US"><head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1"/>

<title>TTM4175</title>
<meta property="og:title" content="TTM4175">
<meta property="og:locale" content="en_US">
<meta name="description" content="Introduction to Communication Technology and Digital Security">
<meta property="og:description" content="Introduction to Communication Technology and Digital Security">


<link rel="stylesheet" href="assets/bootstrap.min.css">
<script src="assets/jquery-3.5.1.min.js"></script>
<script src="assets/bootstrap.min.js"></script>
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.1/css/all.css" integrity="sha384-gfdkjb5BdAXd+lj+gudLWI+BXq4IuLW5IT+brZEZsLFm++aCMlF1V92rMkPaX4PP" crossorigin="anonymous">
<link rel="stylesheet" type="text/css" href="assets/style.css" />
<script src="assets/anchor.js"></script>
<script src="assets/script-aside.js"></script>
</head>
<body id="top">

<nav class="navbar navbar-expand-md navbar-dark " style="background-color:#666666"#2B65EC"> <!-- fixed-top -->
        <ul class="nav nav-pills">
        <li class="nav-item">
    <a class="nav-link" href="index.html" style="font-weight: bold")>TTM4175</a>
  </li>

  <li class="nav-item dropdown">
    <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">Teknostart</a>
    <div class="dropdown-menu">
      <a class="dropdown-item" href="day0-2020.html">Dag 0: Getting Started</a>
      <a class="dropdown-item" href="day1-2020.html">Dag 1: Virtual Box</a>
      <a class="dropdown-item" href="day2-2020.html">Dag 2: Linux Command Line</a>
      <a class="dropdown-item" href="day3-2020.html">Dag 3: SSH and HTML</a>
      <div class="dropdown-divider"></div>
      <a class="dropdown-item" href="tips.html">Tips</a>
    </div>
  </li>
        
  <li class="nav-item dropdown">
    <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">Preparation</a>
    <div class="dropdown-menu">
      <a class="dropdown-item disabled"><strong>Networking</strong></a>
      <a class="dropdown-item" href="prep-networking-1-2020.html">Binary and IP addresses</a>
      <a class="dropdown-item" href="prep-networking-2-2020.html">Layers and Docker</a>
      <a class="dropdown-item" href="prep-networking-3-2020.html">Webservers and DNS</a>
      <div class="dropdown-divider"></div>
      <a class="dropdown-item disabled"><strong>Security</strong></a>
      <a class="dropdown-item" href="prep-security-1-2020.html">Security 1: Cyber Security and Ethical Hacking </a>
      <a class="dropdown-item" href="prep-security-2-2020.html">Security 2: Authentication, Authorization, and Password Storage</a>
      <a class="dropdown-item" href="prep-security-3-2020.html">Security 3: Passwords and Cryptography</a>
      <a class="dropdown-item" href="prep-security-4-2020.html">Security 4: Security Vulnerabilities</a>
      <div class="dropdown-divider"></div>
      <a class="dropdown-item disabled"><strong>Internet of Things</strong></a>
      <a class="dropdown-item" href="prep-iot-intro.html">IoT 1: Introduction</a>
      <a class="dropdown-item" href="prep-iot-devices.html">IoT 1: Installation</a>
      <a class="dropdown-item" href="prep-iot-stm.html">IoT 2: State Machines</a>
      <a class="dropdown-item" href="prep-iot-stmpy.html">IoT 2: State Machines in Micro Python</a>
      <a class="dropdown-item" href="prep-iot-http-json.html">IoT 3: HTTP and JSON</a>
      <a class="dropdown-item" href="prep-iot-mqtt.html">IoT 4: MQTT</a>
      <!--
      <a class="dropdown-item" href="prep-iot-api.html">IoT 4: APIs</a>
      <a class="dropdown-item" href="prep-iot-nb-iot.html">NB-IoT (Extra)</a>-->
    </div>
  </li>
  
  <li class="nav-item dropdown">
    <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">Labs</a>
    <div class="dropdown-menu">
        <a class="dropdown-item disabled"><strong>Networking</strong></a>
        <a class="dropdown-item" href="networking-1-2020.html">Binary and IP addresses</a>
        <a class="dropdown-item" href="networking-2-2020.html">Layers and Docker</a>
        <a class="dropdown-item" href="networking-3-2020.html">Webservers and DNS</a>
        <div class="dropdown-divider"></div>
        <a class="dropdown-item disabled"><strong>Security</strong></a>
        <a class="dropdown-item" href="security-1-2020.html">Security 1</a>
        <a class="dropdown-item" href="security-2-2020.html">Security 2</a>
        <a class="dropdown-item" href="security-3-2020.html">Security 3</a>
        <a class="dropdown-item" href="security-4-2020.html">Security 4</a>
        <div class="dropdown-divider"></div>
        <a class="dropdown-item disabled"><strong>Internet of Things</strong></a>
        <a class="dropdown-item" href="iot-devices.html">IoT 1: Programming Devices</a>
        <a class="dropdown-item" href="iot-stm.html">IoT 2: State Machines</a>
        <a class="dropdown-item" href="iot-http-json-2020.html">IoT 3: HTTP and JSON</a>
        <a class="dropdown-item" href="iot-http-json-2020.html">IoT 4: MQTT Chat</a>
        <!--
        <a class="dropdown-item" href="iot-lopy.html">LoPy</a>
        <a class="dropdown-item" href="iot-mqtt.html">MQTT</a>
        <a class="dropdown-item" href="iot-lorawan.html">LoRaWAN / NB-IoT</a>
        <a class="dropdown-item" href="iot-api.html">API</a>-->
      </div>
  </li>
  
  <li class="nav-item dropdown">
    <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">Extra</a>
    <div class="dropdown-menu">
      <a class="dropdown-item disabled"><strong>Learning</strong></a>
      <a class="dropdown-item" href="learning-rats.html">RATs</a>
      <a class="dropdown-item" href="feedback.html">Tilbakemelding</a>
      <a class="dropdown-item" href="reports.html">Rapporter</a>
      <a class="dropdown-item" href="teams.html">Teams</a>
      <a class="dropdown-item" href="working-in-teams.html">Working in Teams</a>
      <a class="dropdown-item" href="tools.html">Learning Tools</a>
      <div class="dropdown-divider"></div>
      <a class="dropdown-item disabled"><strong>Material</strong></a>
      <a class="dropdown-item" href="commands-help.html">Help on Commands</a>
      <a class="dropdown-item" href="commands.html">List of Commands</a>
      <a class="dropdown-item" href="computer-history.html">Extra Videos</a>
      <div class="dropdown-divider"></div>
      <a class="dropdown-item disabled"><strong>Tools</strong></a>
      <a class="dropdown-item" href="virtual-box-mac.html">Virtual Box for Mac</a>
      <a class="dropdown-item" href="virtual-box-win.html">Virtual Box for Windows</a>
      <a class="dropdown-item" href="shell-mac.html">Terminal and SSH on Mac</a>
      <a class="dropdown-item" href="shell-win.html">Terminal and SSH on Windows</a>
    </div>
  </li>
  
  <!--
  <li class="nav-item">
    <a class="nav-link" href="#">Blackboard</a>
  </li>-->
</ul>

<div class="navbar-nav flex-row ml-md-auto d-none d-md-flex"></div>
             <a class="navbar-brand" href="https://ntnu.edu">
      	<svg width="100" height="30">
      		<image xlink:href="https://innsida.ntnu.no/innsida-theme/images/ntnu-graphics/ntnu_logo_white.svg" 
      		src="https://innsida.ntnu.no/innsida-theme/images/ntnu-graphics/ntnu_logo_white.png" width="100%" height="100%"></image>
      	</svg>
      </a>
    </nav>


<div class="page">
    </section>
    <section class="content">
<h1 id="lab-state-machines-in-iot">Lab: State Machines in IoT</h1>

<h3 id="overview-of-tasks">Overview of Tasks</h3>
<p>We have created 5 tasks which all let you solve a slightly different problem related to state machines. The tasks are independent of each other, but the first one is the easiest to get started and the last one is maybe a bit challenging.</p>
<p>Here’s an overview:</p>
<ol type="1">
<li><strong>Counter</strong>: You run the example, just to check that all works, and explain the behavior in words.</li>
<li><strong>Shake Light</strong>: Create a state machine diagram from code.</li>
<li><strong>Night Light</strong>: Extend a state machine diagram, and extend its code.</li>
<li><strong>Switch Light</strong>: You get the state machine diagram, but build all code on your own.</li>
<li><strong>Hand Sanitizer Station</strong>: You create state machine diagram and code by yourself from a textual description.</li>
</ol>
<p>All background theory for the tasks is covered in this page about <a href="prep-iot-stm.html">State machines</a> in general and <a href="prep-iot-stmpy.html">State machines in Micro Python</a>.</p>

<h3 id="drawing-state-machine-diagrams">Drawing State Machine Diagrams</h3>
<p>You will need to draw some diagrams in this lab.</p>
<ul>
<li><strong>Pencil and paper</strong> are probably still the best tools for sketching a state machine when you are working on your own. Don’t underestimate the value of making quick sketches and iterating on them before you make an electronic version of your diagram for documentation.</li>
<li><strong>Whiteboards or blackboards</strong> have the benefit that you can work in groups, if you are physically at the same place.</li>
<li><strong>Drawing applications</strong> are often easy to access and use, but do not know that you want to create a special diagram style. Though this is probably your best option. You can create simple state machine diagrams in a shared PowerPoint, to which you have access in Teams. Another option is <a href="draw.io">Draw.io</a>, but it requires you to login with a Google account.</li>
</ul>

<h3 id="working-style">Working Style</h3>
<p>There is not a lot to program today in counting the lines of code. The goal is rather to train an approach to system development and problem exploration — the state machines and Python code are just tools to get there. Therefore:</p>
<ul>
<li>Make sure at each one in your team follows. In this lab, make sure you are familiar with all the details, and can follow everything. If not all points are clear to everyone, ask your team mates, or vice-versa, explain it to them.</li>
<li>For each task, give everyone a few minutes to think individually. You can only have valuable team discussions if everyone had the chance to think on their own first.</li>
</ul>

    </section>
    <section class="content">
<h1 id="counter">Counter</h1>

<div class="goals"><ul>
<li><strong>Goal:</strong> Get the state machine code running, to check that all works.</li>
</ul>
</div>
<p>We have created the files for today’s tasks, and you can download them from a Git repository as a zip-file.</p>
<ul>
<li>Download the file <a href="https://github.com/falkr/ttm4175-microbit-stms/archive/main.zip" class="uri">https://github.com/falkr/ttm4175-microbit-stms/archive/main.zip</a>.</li>
<li>Unzip it, usually by double-clicking on it.</li>
<li>Open the folder in VS Code.</li>
</ul>

<span name="7d48c5"></span><aside name="7d48c5"><p><a href="https://git-scm.com">Git</a> is a version control system. Usually you would clone a repository so you could make changes to it and send them back to me, but for this exercise you only need the files once, which is why you only download the repository as a simple zip-file.</p>
</aside>
<p>You should see the following files:</p>
<ul>
<li>counter.py</li>
<li>dispender.py</li>
<li>night.py</li>
<li>shake.py</li>
<li>switch.py</li>
</ul>

<p>All files are self-contained and can run independently of each other, that means, all contain the base state machine.</p>

<h3 id="diagram-for-the-counter">Diagram for the Counter</h3>

<div class="figure">
<img src="figures/statemachines/counter.svg" width="100%"/>
</div>
<p>The counter is an electronic version of a hand counter, like the one they use on airplanes to count how many passengers are on board. Ours is made for very small planes — it can only count to 10.</p>
<h3 id="run-the-counter">Run the Counter</h3>
<p><a href="iot-devices.html">Using the same commands as last week for the device simulator</a>, run the file <code>counter.py</code> in the device simulator, and try out if the counter works as you have described.</p>
<p><strong>Task:</strong> Inspect the diagram closely, and describe in words how you expect, the counter will work.</p>
<ul>
<li>Include this description in your report. Make sure to include all details.</li>
<li>What is the function of <code>button_b</code>?</li>
<li>In addition to the textual description, illustrate the functions of the coutner using a series of small screenshots.</li>
</ul>

    </section>
    <section class="content">
<h1 id="shake-light">Shake Light</h1>

<div class="goals"><ul>
<li><strong>Goal:</strong> Create a state machine diagram from given code.</li>
</ul>
</div>
<p>Have a look at the code in file <code>shake.py</code>, and run it. (The code of the state machine is also included below.)</p>

<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">class</span> ShakeLight(StateMachine):</a>
<a class="sourceLine" id="cb1-2" title="2">    <span class="co">&quot;&quot;&quot;Switch on the light if you shake the device</span></a>
<a class="sourceLine" id="cb1-3" title="3"><span class="co">    and turn it off again after 2 seconds.</span></a>
<a class="sourceLine" id="cb1-4" title="4"><span class="co">    &quot;&quot;&quot;</span></a>
<a class="sourceLine" id="cb1-5" title="5"></a>
<a class="sourceLine" id="cb1-6" title="6">    <span class="kw">def</span> initial_transition(<span class="va">self</span>, timers):</a>
<a class="sourceLine" id="cb1-7" title="7">        display.show(Image.SQUARE_SMALL)</a>
<a class="sourceLine" id="cb1-8" title="8">        <span class="cf">return</span> <span class="st">&quot;off&quot;</span></a>
<a class="sourceLine" id="cb1-9" title="9"></a>
<a class="sourceLine" id="cb1-10" title="10">    <span class="kw">def</span> transition(<span class="va">self</span>, state, event, timers):</a>
<a class="sourceLine" id="cb1-11" title="11">        <span class="cf">if</span> state <span class="op">==</span> <span class="st">&quot;off&quot;</span>:</a>
<a class="sourceLine" id="cb1-12" title="12">            <span class="cf">if</span> event <span class="op">==</span> <span class="st">&quot;shake&quot;</span>:</a>
<a class="sourceLine" id="cb1-13" title="13">                display.show(Image.SQUARE)</a>
<a class="sourceLine" id="cb1-14" title="14">                timers.start(<span class="st">&quot;t1&quot;</span>, <span class="dv">2000</span>)</a>
<a class="sourceLine" id="cb1-15" title="15">                <span class="cf">return</span> <span class="st">&quot;on&quot;</span></a>
<a class="sourceLine" id="cb1-16" title="16">        <span class="cf">elif</span> state <span class="op">==</span> <span class="st">&quot;on&quot;</span>:</a>
<a class="sourceLine" id="cb1-17" title="17">            <span class="cf">if</span> event <span class="op">==</span> <span class="st">&quot;t1&quot;</span>:</a>
<a class="sourceLine" id="cb1-18" title="18">                display.show(Image.SQUARE_SMALL)</a>
<a class="sourceLine" id="cb1-19" title="19">                <span class="cf">return</span> <span class="st">&quot;off&quot;</span></a></code></pre></div>

<p><strong>Task:</strong> Describe the behavior of the shake light in a few sentences.</p>

<p><strong>Task:</strong> Draw a state machine that corresponds to the code. Make sure to include all necessary elements.</p>

    </section>
    <section class="content">
<h1 id="night-light">Night Light</h1>

<div class="goals"><ul>
<li><strong>Goal:</strong> Extend a given diagram to extends its functionality, and extend the corresponding code.</li>
</ul>
</div>
<div class="figure">
<img src="figures/statemachines/stm-night-light-1.svg" width="100%"/>
</div>
<p>Above you see the partial state machine of a night light, which depends on the light level, and switches on when it reaches &gt; 100.</p>
<p><strong>Task:</strong> Describe the behavior of the shake light in a few sentences.</p>
<p><strong>Task:</strong> Extend the state machine diagram so that it also switches the light off again after the level goes under 80.</p>
<p><strong>Task:</strong> Add the code for the added functionality and check that it works. Include a series of small screenshots in your report.</p>

    </section>
    <section class="content">
<h1 id="switch-light">Switch Light</h1>

<div class="goals"><ul>
<li><strong>Goal:</strong> Build all code on your own from a given state machine diagram.</li>
</ul>
</div>
<div class="figure">
<img src="figures/statemachines/stm-switch-light.svg" width="100%"/>
</div>
<p>Above is the diagram for a light that can be switched on and off.</p>
<p><strong>Task:</strong> Have a close look at the diagram, and describe what it does in words.</p>
<p><strong>Task:</strong> Build the entire code for the state machine.</p>
<ul>
<li>Use the code given in file <code>switch.py</code> as starter.</li>
<li>You only have to fill the content of the functions <code>initial_transition</code> and <code>transition</code>.</li>
</ul>

    </section>
    <section class="content">
<h1 id="hand-sanitizer-station">Hand Sanitizer Station</h1>

<div class="goals"><ul>
<li><strong>Goal:</strong> Create diagram and code by yourself.</li>
</ul>
</div>
<div class="figure">
<img src="figures/statemachines/dispenser.png" width="100%"/>
</div>
<p>Create the state machine for a hand santizer. These machines, as you know, detect that someone puts their hand under the dispenser, then run a motor for 800 milliseconds to dispense some sanitizer.</p>
<p>To avoid double-dispensing, the machine ignores a repeated dispensing for about 2 seconds, that means, you need to wait for 2 seconds before it dispenses another load. (Sometimes irritating if you want a double dose…)</p>
<p><strong>Task:</strong> Create such a state machine diagram.</p>
<ul>
<li>Try to sketch one on your own, each one individually for a few minutes.</li>
<li>Compare your solutions.</li>
<li>Use the state machines to understand the function better. Do you all agree on what the system should <em>exactly</em> do?</li>
</ul>
<p>Some hints:</p>
<ul>
<li>Assume that a detected hand is signalled by event <code>shake</code>. That means, if the shale event is detected, the dispenser should dispense a dose by switching on its motor.</li>
<li>Instead of switching on a motor, just show an arrow pointing downwards (<code>Image.ARROW_S</code>) on the display.</li>
<li>Make sure it does activate the dispenser (by showing the arrow) for the 800 milliseconds.</li>
<li>Make sure it does not double dispense within 2 seconds after the first detected shake.</li>
</ul>

<button class="w3collapsible">Hint about the states. (Click only when you need it.)</button>
<div class="w3content">
<p>The state machine we came up with has three control states, which we called for <code>ready</code>, <code>dispensing</code> and <code>blocked</code>. The names do not matter, but may indicate what happens in them.</p>

</div>
<p><strong>Task:</strong> Create the code for the machines. Use file <code>dispenser.py</code> as starting point.</p>

<p><strong>Task:</strong> Document the solution of your dispenser as detailed as possible, to explain to the reader how it works. Include a comic-like sequence of screenshots, too.</p>

    </section>
</div>


<footer></footer>
<script>
    anchors.add('h1').add('h2').add('h3');
    anchors.options.visible = 'always';
</script>
</body>
</html>
