<html lang="en-US"><head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1"/>

<title>TTM4175</title>
<meta property="og:title" content="TTM4175">
<meta property="og:locale" content="en_US">
<meta name="description" content="Introduction to Communication Technology and Digital Security">
<meta property="og:description" content="Introduction to Communication Technology and Digital Security">


<!--<link rel="stylesheet" type="text/css" href="style.css" />-->
<link href="https://fonts.googleapis.com/css?family=Merriweather:400,400italic,700,700italic|Source+Code+Pro|Source+Sans+Pro:200,300,400,600,400italic,600italic|Rock+Salt" rel="stylesheet" type="text/css">


<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>


<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.1/css/all.css" integrity="sha384-gfdkjb5BdAXd+lj+gudLWI+BXq4IuLW5IT+brZEZsLFm++aCMlF1V92rMkPaX4PP" crossorigin="anonymous">

<link rel="stylesheet" type="text/css" href="assets/style.css" />

<!--<script src="jquery-1.10.1.min.js"></script>-->
<script src="assets/script-aside.js"></script>
</head>
<body id="top">

<nav class="navbar navbar-expand-md navbar-dark " style="background-color:#666666"#2B65EC"> <!-- fixed-top -->
        <ul class="nav nav-pills">
        <li class="nav-item">
    <a class="nav-link" href="index.html" style="font-weight: bold")>TTM4175</a>
  </li>

  <li class="nav-item dropdown">
    <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">Teknostart</a>
    <div class="dropdown-menu">
      <a class="dropdown-item" href="day0-2020.html">Dag 0: Getting Started</a>
      <a class="dropdown-item" href="day1-2020.html">Dag 1: Virtual Box</a>
      <a class="dropdown-item" href="day2-2020.html">Dag 2: Linux Command Line</a>
      <a class="dropdown-item" href="day3-2020.html">Dag 3: SSH and HTML</a>
      <div class="dropdown-divider"></div>
      <a class="dropdown-item" href="tips.html">Tips</a>
    </div>
  </li>
        
  <li class="nav-item dropdown">
    <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">Preparation</a>
    <div class="dropdown-menu">
      <a class="dropdown-item disabled"><strong>Networking</strong></a>
      <a class="dropdown-item" href="prep-networking-1-2020.html">Binary and IP addresses</a>
      <a class="dropdown-item" href="prep-networking-2-2020.html">Layers and Docker</a>
      <a class="dropdown-item" href="prep-networking-3-2020.html">Webservers and DNS</a>
      <div class="dropdown-divider"></div>
      <a class="dropdown-item disabled"><strong>Security</strong></a>
      <a class="dropdown-item" href="prep-security-1.html">Security 1: Cyber Security and Ethical Hacking </a>
      <a class="dropdown-item" href="prep-security-2.html">Security 2: Authentication, Authorization, and Password Storage</a>
      <a class="dropdown-item" href="prep-security-3.html">Security 3: Passwords and Cryptography</a>
      <a class="dropdown-item" href="prep-security-4.html">Security 4: Security Vulnerabilities</a>
      <div class="dropdown-divider"></div>
      <a class="dropdown-item disabled"><strong>Internet of Things</strong></a>
      <a class="dropdown-item" href="prep-iot-intro.html">IoT 1: Introduction</a>
      <a class="dropdown-item" href="prep-iot-http-json.html">IoT 2: HTTP and JSON</a>
      <a class="dropdown-item" href="prep-iot-mqtt.html">IoT 3: MQTT</a>
      <a class="dropdown-item" href="prep-iot-api.html">IoT 4: APIs</a>
      <a class="dropdown-item" href="prep-iot-nb-iot.html">NB-IoT (Extra)</a>
    </div>
  </li>
  
  <li class="nav-item dropdown">
    <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">Labs</a>
    <div class="dropdown-menu">
        <a class="dropdown-item disabled"><strong>Networking</strong></a>
        <a class="dropdown-item" href="networking-1-2020.html">Binary and IP addresses</a>
        <a class="dropdown-item" href="networking-2-2020.html">Layers and Docker</a>
        <a class="dropdown-item" href="networking-3-2020.html">Webservers and DNS</a>
        <div class="dropdown-divider"></div>
        <a class="dropdown-item disabled"><strong>Security</strong></a>
        <a class="dropdown-item" href="security-1.html">Security 1</a>
        <a class="dropdown-item" href="security-2.html">Security 2</a>
        <a class="dropdown-item" href="security-3.html">Security 3</a>
        <a class="dropdown-item" href="security-4.html">Security 4</a>
        <div class="dropdown-divider"></div>
        <a class="dropdown-item disabled"><strong>Internet of Things</strong></a>
        <a class="dropdown-item" href="iot-lopy.html">LoPy</a>
        <a class="dropdown-item" href="iot-http-json.html">HTTP and JSON</a>
        <a class="dropdown-item" href="iot-mqtt.html">MQTT</a>
		<a class="dropdown-item" href="iot-lorawan.html">LoRaWAN / NB-IoT</a>
        <a class="dropdown-item" href="iot-api.html">API</a>
      </div>
  </li>
  
  <li class="nav-item dropdown">
    <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">Extra</a>
    <div class="dropdown-menu">
      <a class="dropdown-item disabled"><strong>Learning</strong></a>
      <a class="dropdown-item" href="learning-rats.html">RATs</a>
      <a class="dropdown-item" href="feedback.html">Tilbakemelding</a>
      <a class="dropdown-item" href="reports.html">Rapporter</a>
      <a class="dropdown-item" href="teams.html">Teams</a>
      <a class="dropdown-item" href="working-in-teams.html">Working in Teams</a>
      <a class="dropdown-item" href="tools.html">Learning Tools</a>
      <div class="dropdown-divider"></div>
      <a class="dropdown-item disabled"><strong>Material</strong></a>
      <a class="dropdown-item" href="commands-help.html">Help on Commands</a>
      <a class="dropdown-item" href="commands.html">List of Commands</a>
      <a class="dropdown-item" href="computer-history.html">Extra Videos</a>
      <div class="dropdown-divider"></div>
      <a class="dropdown-item disabled"><strong>Tools</strong></a>
      <a class="dropdown-item" href="virtual-box-mac.html">Virtual Box for Mac</a>
      <a class="dropdown-item" href="virtual-box-win.html">Virtual Box for Windows</a>
      <a class="dropdown-item" href="shell-mac.html">Terminal and SSH on Mac</a>
      <a class="dropdown-item" href="shell-win.html">Terminal and SSH on Windows</a>
    </div>
  </li>
  
  <!--
  <li class="nav-item">
    <a class="nav-link" href="#">Blackboard</a>
  </li>-->
</ul>

<div class="navbar-nav flex-row ml-md-auto d-none d-md-flex"></div>
             <a class="navbar-brand" href="https://ntnu.edu">
      	<svg width="100" height="30">
      		<image xlink:href="https://innsida.ntnu.no/innsida-theme/images/ntnu-graphics/ntnu_logo_white.svg" 
      		src="https://innsida.ntnu.no/innsida-theme/images/ntnu-graphics/ntnu_logo_white.png" width="100%" height="100%"></image>
      	</svg>
      </a>
    </nav>


<div class="page">
    </section>
    <section class="content">
<h1 id="web-servers-and-dns">Web servers and DNS</h1>
<p>The overall goal of this lab. is to complement knowledge on IP and subnets with some routing notions for setting up our own DNS and Web servers. This will be achieved using the same VMs as last week and default Linux tools.</p>

<h2 id="learning-goals">Learning Goals</h2>

<div class="goals"><p>After this lab you will be able to:</p>
<ul>
<li>Recognise the role of routing in networking</li>
<li>Use <code>ip route</code> for managing routes</li>
<li>Retrieve basic DNS information</li>
<li>Deploy simple network services</li>
</ul>
</div>
    </section>
    <section class="content">
<h1 id="lab.-exercises">Lab. Exercises</h1>
<p>Please <strong>read each exercise</strong> entirely before starting to solve it.</p>
<p>Remember you should deliver a report after the networking module is finished. It should include the main commands and configurations necessary to complete each exercise. Do not forget to take notes while solving the exercises so you do not have to repeat them.</p>
<p>These exercises should be completed in teams.</p>

<h2 id="preparation">Preparation</h2>

<div class="steps"><ol type="1">
<li>Make sure there’s connectivity between both VMs (you should have configured static IP address in the previous labs.).</li>
<li>Test if your Ubuntu VM has Internet connectivity.</li>
<li>Make sure you’ve got enough free disk space for your VM (at least 3GB).</li>
</ol>
</div>
<p><strong>Note:</strong> If you have problems with lack of memory/RAM in your computer consider this:</p>
<ul>
<li>You can complete this entire lab. without the RPi VM (except for the optional part);</li>
<li>You can run the Ubuntu VM in headless mode and connect to it via <code>ssh</code>;</li>
<li>Instead of retrieving web pages with a “normal browser” you can use the command <code>wget</code> (or a text-based browser such as Lynx).</li>
</ul>

    </section>
    <section class="content">
<h1 id="a-simple-network-with-services">A simple network with services</h1>

<div class="figure">
<img src="figures/net/lab3-topo.png" alt="Network to be created with docker-compose." width="100%"/>
<span name="figures/net/lab3-topo.png">&nbsp;</span>
<aside name="figures/net/lab3-topo.png"><p><p>Network to be created with docker-compose.</p>
</p></aside>
</div>
<p><strong>–&gt; In your Ubuntu VM</strong></p>

<div class="steps"><ol type="1">
<li>Download <a href="material/lab3-compose.zip">this zip file</a> with the necessary container configuration files.</li>
<li><code>unzip</code> the downloaded file and inside the ‘lab3’ folder edit the ‘docker-compose.yml’ file.</li>
<li>Read through the file and see how we configured 3 containers and their networks, matching the figure above.</li>
<li>In the webserver’s configuration section edit the IP address to match the topology above (line 51, replace the text “—–Fyll inn her ——” with the correct IP address). Save and exit the file.</li>
<li>Now you can start your topology with the command below. Afterwards list all running containers (discuss what happened in your report).</li>
</ol>
</div>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="ex">docker-compose</span> up -d --build</span></code></pre></div>

<div class="tip"><p>The first time you run <code>docker-compose</code> it will take a few minutes to build the images (approx. 5 min. or less). Use that time to carefully read the next steps.</p>
</div>
<h2 id="configuring-simple-routing">Configuring simple routing</h2>
<p>In this part of the lab. your objective is to guarantee you can route packets from your host to the containers. Notice that we have a router in our topology that connects two different subnets. We will need to configure this router container (‘router0’) so that packets are correctly forwarded.</p>
<p><strong>–&gt; In your Ubuntu VM</strong></p>

<div class="steps"><ol type="1">
<li>First, we should check our current routing table in the host machine (use: <code>ip route list</code>).</li>
<li>You should see that the host has direct routes to the subnets ‘10.241.1.0/29’ and ‘10.168.1.0/29’, via the devices “br-*”. Include this in your report (a screenshot with a highlight is enough).</li>
<li>Since we don’t want the host to directly access all the containers — it should go via ‘router0’ — run the following command:</li>
</ol>
</div>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="fu">sudo</span> ip route del 10.241.1.0/29</span></code></pre></div>

<div class="steps"><ol start="4" type="1">
<li>Verify that you have connectivity with ‘10.168.1.2’ and not with ‘10.241.1.2’. Briefly explain why in your report.</li>
<li>Now we need to add a new route such that traffic for the network ‘10.20.1.0/29’ is forwarded via ‘router0’ (i.e. via ‘10.168.1.2’).</li>
</ol>
</div>
<button class="w3collapsible">Adding routes</button>
<div class="w3content">
<p>Remember the command <code>ip route add</code>.</p>

</div>
<div class="steps"><ol start="6" type="1">
<li>Now verify that packet forwarding is enabled (i.e. “= 1”) with the command:</li>
</ol>
</div>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="ex">sysctl</span> net.ipv4.conf.all.forwarding</span></code></pre></div>

<div class="steps"><ol start="6" type="1">
<li>From your host machine make sure you can <code>ping</code> the web server using its address and include a screenshot on your report.</li>
</ol>
</div>
<h2 id="using-our-dns-server-container">Using our DNS server (container)</h2>
<p>As you can probably guess, our DNS container contains a running DNS server which will support our proposed network. Follow the steps below but don’t forget to explore the provided configurations to learn some more.</p>
<p><strong>–&gt; In your Ubuntu VM</strong></p>

<div class="steps"><ol type="1">
<li>Open a web browser and try to retrieve the web site ‘www.ttm4175.com’. What happens and why?</li>
<li>Edit the file ‘/etc/resolv.conf’ and change the “nameserver” to ‘10.241.1.2’ (or add a new entry above). This will tell the system to make DNS requests to this address first, which corresponds to our DNS container.</li>
<li>Repeat step 1. What happens and why?</li>
<li>Find out what other domain names your DNS container resolves and include them, and their corresponding addresses, in your report (e.g. ‘mail.ttm4175.com’ resolves to ‘10.241.1.3’).</li>
</ol>
</div>
<button class="w3collapsible">Finding DNS server configurations</button>
<div class="w3content">
<p>If you explore the Docker configuration of the DNS container (in the ‘dnsserver/config_files’ folder) you will find all the details you need. You can also check inside the actual container you built, where the configuration files have been placed.</p>

</div>
<div class="tip"><p>To make nameserver changes permanent use the <em>netplan</em> configuration like you did last week.</p>
</div>
<h2 id="exploring-our-web-server-container">Exploring our Web server (container)</h2>
<p><strong>–&gt; In your Ubuntu VM</strong></p>

<div class="steps"><ol type="1">
<li>Go into your web server container (‘webserver’). How did you do it?</li>
<li>Navigate to ‘/etc/nginx/sites-available’ and open the file ‘default’.</li>
<li>In this file find the <em>root</em> directory where the web server pages are stored, namely the ‘index.html’ file, and include it in your report.</li>
<li>In your host machine, open the web browser and visit the site ‘www.ttm4175.com’.</li>
<li>Now, back in your web server container edit the file ‘index.html’ (be creative!!) and save it when you finish.</li>
<li>Return to your web browser, refresh the page (it should look different), take a screenshot and include it in your report.</li>
</ol>
</div>
<button class="w3collapsible">Working inside your containers</button>
<div class="w3content">
<p>Remember that you can go inside your running containers with the command <code>docker exec -it &lt;name&gt; /bin/bash</code>. Alternatively, you can also use <code>ssh</code> to enter your container.</p>
<p>And don’t forget the <a href="./commands.html">useful commands page</a>.</p>

</div>
<h2 id="final-task">Final task</h2>
<p>In your report describe what happens in the network when you open the page ‘www.ttm4175.com’. You can just explain, step by step, the requests and answers from the browser to the servers and back. This should include the IP addresses of each server (don’t forget DNS).</p>
<p>If you want, you can also include screenshots (e.g. <code>tcpdump</code>) and you can also start/stop containers by hand to see how they affect the overall process (e.g. stop the DNS server).</p>
<p>Finally, you can stop all the containers and remove the networks with the command:</p>

<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="ex">docker-compose</span> down</span></code></pre></div>

<div class="tip"><p>If you want to restart your network but haven’t changed the setup you can simply run <code>docker-compose up -d</code>, without the <code>--build</code> flag, and it will be much faster than the first time!</p>
</div>
    </section>
    <section class="content">
<h1 id="optional-exercises">Optional Exercises</h1>
<h2 id="routing-from-the-rpi-to-the-docker-services">Routing from the RPi to the Docker services</h2>
<p><strong>–&gt; In your RPi VM</strong></p>

<div class="steps"><ol type="1">
<li>Can you <code>ping</code> the container ‘router0’? Why or why not?</li>
<li>How does your routing table look like? Do you need to add or remove any entry?</li>
<li><strong>After having IP connectivity</strong>, attempt to open or <code>ping</code> the web server using the hostname ‘www.ttm4175.com’. What happens? Why? How can you fix it?</li>
</ol>
</div>
    </section>
</div>


<footer></footer>
</body>
</html>
