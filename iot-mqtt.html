<html lang="en-US"><head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1"/>

<title>TTM4175</title>
<meta property="og:title" content="TTM4175">
<meta property="og:locale" content="en_US">
<meta name="description" content="Introduction to Communication Technology and Digital Security">
<meta property="og:description" content="Introduction to Communication Technology and Digital Security">


<link rel="stylesheet" href="assets/bootstrap.min.css">
<script src="assets/jquery-3.5.1.min.js"></script>
<script src="assets/bootstrap.min.js"></script>
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.1/css/all.css" integrity="sha384-gfdkjb5BdAXd+lj+gudLWI+BXq4IuLW5IT+brZEZsLFm++aCMlF1V92rMkPaX4PP" crossorigin="anonymous">
<link rel="stylesheet" type="text/css" href="assets/style.css" />
<script src="assets/anchor.js"></script>
<script src="assets/script-aside.js"></script>
</head>
<body id="top">

<nav class="navbar navbar-expand-md navbar-dark " style="background-color:#666666"#2B65EC"> <!-- fixed-top -->
        <ul class="nav nav-pills">
        <li class="nav-item">
    <a class="nav-link" href="index.html" style="font-weight: bold")>TTM4175</a>
  </li>

  <li class="nav-item dropdown">
    <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">Teknostart</a>
    <div class="dropdown-menu">
      <a class="dropdown-item" href="day1-2021.html">Dag 1</a>
      <a class="dropdown-item" href="day2-2021.html">Dag 2</a>
      <a class="dropdown-item" href="day3-2021.html">Dag 3</a>
      <div class="dropdown-divider"></div>
      <a class="dropdown-item" href="day0-2020.html">(2020) Dag 0: Getting Started</a>
      <a class="dropdown-item" href="day1-2020.html">(2020) Dag 1: Virtual Box</a>
      <a class="dropdown-item" href="day2-2020.html">(2020) Dag 2: Linux Command Line</a>
      <a class="dropdown-item" href="day3-2020.html">(2020) Dag 3: SSH and HTML</a>
      <div class="dropdown-divider"></div>
      <a class="dropdown-item" href="tips.html">Tips</a>
    </div>
  </li>
        
  <li class="nav-item dropdown">
    <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">Preparation</a>
    <div class="dropdown-menu">
      <a class="dropdown-item disabled"><strong>Security</strong></a>
      <a class="dropdown-item" href="prep-security-1-2021.html">Security 1</a>
      <a class="dropdown-item" href="prep-security-2-2021.html">Security 2</a>
      <a class="dropdown-item" href="prep-security-3-2021.html">Security 3</a>
      <a class="dropdown-item" href="prep-security-4-2021.html">Security 4</a>
      <a class="dropdown-item" href="prep-security-5-2021.html">Security 5</a>
      <div class="dropdown-divider"></div>
      <a class="dropdown-item disabled"><strong>Networking (2020)</strong></a>
      <a class="dropdown-item" href="prep-networking-1-2020.html">Binary and IP addresses</a>
      <a class="dropdown-item" href="prep-networking-2-2020.html">Layers and Docker</a>
      <a class="dropdown-item" href="prep-networking-3-2020.html">Webservers and DNS</a>
      <div class="dropdown-divider"></div>
      <a class="dropdown-item disabled"><strong>Security (2020)</strong></a>
      <a class="dropdown-item" href="prep-security-1-2020.html">Security 1: Cyber Security and Ethical Hacking </a>
      <a class="dropdown-item" href="prep-security-2-2020.html">Security 2: Authentication, Authorization, and Password Storage</a>
      <a class="dropdown-item" href="prep-security-3-2020.html">Security 3: Passwords and Cryptography</a>
      <a class="dropdown-item" href="prep-security-4-2020.html">Security 4: Security Vulnerabilities</a>
      <div class="dropdown-divider"></div>
      <a class="dropdown-item disabled"><strong>Internet of Things (2020)</strong></a>
      <a class="dropdown-item" href="prep-iot-intro.html">IoT 1: Introduction</a>
      <a class="dropdown-item" href="prep-iot-devices.html">IoT 1: Installation</a>
      <a class="dropdown-item" href="prep-iot-stm.html">IoT 2: State Machines</a>
      <a class="dropdown-item" href="prep-iot-stmpy.html">IoT 2: State Machines in Micro Python</a>
      <a class="dropdown-item" href="prep-iot-http-json.html">IoT 3: HTTP and JSON</a>
      <a class="dropdown-item" href="prep-iot-mqtt.html">IoT 4: MQTT</a>
      <!--
      <a class="dropdown-item" href="prep-iot-api.html">IoT 4: APIs</a>
      <a class="dropdown-item" href="prep-iot-nb-iot.html">NB-IoT (Extra)</a>-->
    </div>
  </li>
  
  <li class="nav-item dropdown">
    <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">Labs</a>
    <div class="dropdown-menu">
        <a class="dropdown-item disabled"><strong>Security</strong></a>
        <a class="dropdown-item" href="security-1-2021.html">Security 1</a>
        <a class="dropdown-item" href="security-2-2021.html">Security 2</a>
        <a class="dropdown-item" href="security-3-2021.html">Security 3</a>
        <a class="dropdown-item" href="security-4-2021.html">Security 4</a>
        <a class="dropdown-item" href="security-5-2021.html">Security 5</a>
        <div class="dropdown-divider"></div>
        <a class="dropdown-item disabled"><strong>Networking (2020)</strong></a>
        <a class="dropdown-item" href="networking-1-2020.html">Binary and IP addresses</a>
        <a class="dropdown-item" href="networking-2-2020.html">Layers and Docker</a>
        <a class="dropdown-item" href="networking-3-2020.html">Webservers and DNS</a>
        <div class="dropdown-divider"></div>
        <a class="dropdown-item disabled"><strong>Security (2020)</strong></a>
        <a class="dropdown-item" href="security-1-2020.html">Security 1</a>
        <a class="dropdown-item" href="security-2-2020.html">Security 2</a>
        <a class="dropdown-item" href="security-3-2020.html">Security 3</a>
        <a class="dropdown-item" href="security-4-2020.html">Security 4</a>
        <div class="dropdown-divider"></div>
        <a class="dropdown-item disabled"><strong>Internet of Things (2020)</strong></a>
        <a class="dropdown-item" href="iot-devices.html">IoT 1: Programming Devices</a>
        <a class="dropdown-item" href="iot-stm.html">IoT 2: State Machines</a>
        <a class="dropdown-item" href="iot-http-json-2020.html">IoT 3: HTTP and JSON</a>
        <a class="dropdown-item" href="iot-http-json-2020-solution.html">IoT 3: HTTP and JSON (Solution and Revised Tasks)</a>
        <a class="dropdown-item" href="iot-mqtt-chat.html">IoT 4: MQTT Chat</a>
        <!--
        <a class="dropdown-item" href="iot-lopy.html">LoPy</a>
        <a class="dropdown-item" href="iot-mqtt.html">MQTT</a>
        <a class="dropdown-item" href="iot-lorawan.html">LoRaWAN / NB-IoT</a>
        <a class="dropdown-item" href="iot-api.html">API</a>-->
      </div>
  </li>
  
  <li class="nav-item dropdown">
    <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">Extra</a>
    <div class="dropdown-menu">
      <a class="dropdown-item disabled"><strong>Learning</strong></a>
      <a class="dropdown-item" href="learning-rats.html">RATs</a>
      <a class="dropdown-item" href="feedback.html">Tilbakemelding</a>
      <a class="dropdown-item" href="reports.html">Rapporter</a>
      <a class="dropdown-item" href="teams.html">Teams</a>
      <a class="dropdown-item" href="working-in-teams.html">Working in Teams</a>
      <a class="dropdown-item" href="tools.html">Learning Tools</a>
      <div class="dropdown-divider"></div>
      <a class="dropdown-item disabled"><strong>Material</strong></a>
      <a class="dropdown-item" href="commands-help.html">Help on Commands</a>
      <a class="dropdown-item" href="commands.html">List of Commands</a>
      <a class="dropdown-item" href="computer-history.html">Extra Videos</a>
      <div class="dropdown-divider"></div>
      <a class="dropdown-item disabled"><strong>Tools</strong></a>
      <a class="dropdown-item" href="virtual-box-mac.html">Virtual Box for Mac</a>
      <a class="dropdown-item" href="virtual-box-win.html">Virtual Box for Windows</a>
      <a class="dropdown-item" href="shell-mac.html">Terminal and SSH on Mac</a>
      <a class="dropdown-item" href="shell-win.html">Terminal and SSH on Windows</a>
    </div>
  </li>
  
  <!--
  <li class="nav-item">
    <a class="nav-link" href="#">Blackboard</a>
  </li>-->
</ul>

<div class="navbar-nav flex-row ml-md-auto d-none d-md-flex"></div>
             <a class="navbar-brand" href="https://ntnu.edu">
      	<svg width="100" height="30">
      		<image xlink:href="https://innsida.ntnu.no/innsida-theme/images/ntnu-graphics/ntnu_logo_white.svg" 
      		src="https://innsida.ntnu.no/innsida-theme/images/ntnu-graphics/ntnu_logo_white.png" width="100%" height="100%"></image>
      	</svg>
      </a>
    </nav>


<div class="page">
    </section>
    <section class="content">
<h1 id="mqtt">MQTT</h1>
<p>In this lab, we learn how to use a publish-subscribe protocol to send data between devices. In particular, we will be using the Paho-mqtt library for Python and MQTT.fx to connect the two Raspberry Pis to each other, and to a laptop.</p>
<p>Before we start, just as a repetition, since it’s easy to lose the overview when so many different parts are involved:</p>
<ul>
<li><strong>MQTT</strong> is the publish-subscribe protocol that we are using today.</li>
<li><strong>Mosquitto</strong> is the software to run your own MQTT broker.</li>
<li><strong>Paho-mqtt</strong> is a library for Pyhton to run an MQTT <em>client</em>, which connects to a broker, and can publish messages and subscribe to topics.</li>
<li><strong>MQTT.fx</strong> is a helping program to manually publish messages and subscribe to topics.</li>
</ul>
<p><strong>For the Report:</strong> Before we used HTTP. Describe in a few words the difference of MQTT and HTTP. Do you see situations where each of them has their strengths? When would you use which protocols?</p>

    </section>
    <section class="content">
<h1 id="mqtt.fx">MQTT.fx</h1>
<p>The goal in this exercise is to get familiar with MQTT.fx. You should get so familiar with it that you can “trust it”, in the sense that you know what is going on in a system under construction, and can use MQTT.fx to figure out situations.</p>
<h2 id="installation-and-connection">Installation and Connection</h2>
<p><a href="https://mqttfx.jensd.de">Install MQTT.FX</a> on your own laptop. Ideally, install it on more than one laptop, so you can send messages between them.</p>
<h2 id="subscribing">Subscribing</h2>
<ul>
<li>Connect to an open broker, one listed on <a href="https://github.com/mqtt/mqtt.github.io/wiki/public_brokers">this list</a>. (Not all are up and running at all times. Last I used <code>test.mosquitto.org</code>.)</li>
<li>Subscribe to the topic <code>/#</code> and watch what happens. (Not all brokers allow you to do that.)</li>
<li>Try to catch some of the payloads that are transported, and some of the topics that are used.</li>
<li>Unsubscribe from the topic <code>/#</code> again and instead subscribe to a specific topic that you have observed in the trace.</li>
<li>Figure out if there is any meaning in the messages.</li>
</ul>
<p><strong>Tip:</strong> You can also use the <em>Topics Collector</em> in the lower left corner of the Subscribe Tab in MQTT.fx. With that function, you can list all the topics that are currently used on the broker.</p>

<h2 id="publish-and-subscribe">Publish and Subscribe</h2>
<p>Now let’s communicate, only by using MQTT.fx.</p>
<ul>
<li>Find another team.</li>
<li>Agree together on a (unique) topic that you want to use.</li>
<li>make sure you are connected to the same broker.</li>
<li>Use this topic to send messages back and forth using MQTT.FX, like in a chat.</li>
</ul>

    </section>
    <section class="content">
<h1 id="starting-your-own-mqtt-broker">Starting Your Own MQTT Broker</h1>
<p><strong>Goal:</strong> Install your own broker on a Raspberry Pi, and use MQTT.fx to verify that all is setup correct. Send some messages back and forth.</p>

<h2 id="install-mosquitto-on-the-raspberry-pi">Install Mosquitto on the Raspberry Pi</h2>
<p>Install Mosquitto using <code>apt</code>. (We first update apt’s index, then install Mosquitto.)</p>

<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb1-1" title="1"><span class="fu">sudo</span> apt update</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="fu">sudo</span> apt install -y mosquitto mosquitto-clients</a></code></pre></div>

<h2 id="testing-your-broker">Testing Your Broker</h2>
<p>Start Mosquitto:</p>

<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb1-1" title="1"><span class="ex">mosquitto</span> -v</a></code></pre></div>

<p>The result should look like this:</p>

<div class="figure">
<img src="figures/iot/mosquitto-running.png" width="100%"/>
</div>
<p>You can also check which ports it is connected to:</p>

<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb1-1" title="1"><span class="fu">netstat</span> –at </a></code></pre></div>

<p><strong>For the report:</strong> Document this output.</p>

<h2 id="playing-with-mosquitto">Playing with Mosquitto</h2>

<p><strong>Tasks:</strong></p>

<div class="steps"><ol type="1">
<li>Find which IP address your Pi has, you need this when connecting to your broker.</li>
<li>Use MQTT.fx (on your laptop) and connect to the Raspberry Pi. Use the IP address of the Pi, and usually Port 1883.</li>
<li>Use MQTT.fx on another laptop, and also connect to the broker.</li>
<li>Send messages from laptop to laptop via the broker. (Select any topic you want.)</li>
</ol>
</div>
<p><strong>For the Report:</strong></p>
<ul>
<li>Show a sequence diagram of a message exchange between laptop 1, broker, laptop 2 when you send a few messages back and forth.</li>
<li>Include a screenshot of MQTT.fx.</li>
</ul>

    </section>
    <section class="content">
<h1 id="mqtt-in-python">MQTT in Python</h1>
<p><strong>Goal:</strong> You can publish a message to an MQTT broker from Python, and you can subscribe to an MQTT topic from Python.</p>
<p><strong>Tips:</strong></p>
<ul>
<li>Use the MQTT broker that you just installed on the Raspberry Pi.</li>
<li>You can work with Python on the same Pi that runs the broker, or use the other one. (We will later connect both Pis, so it does not matter on which of them the broker runs.)</li>
</ul>

<h2 id="installing-mqtt-paho-clients-for-python">Installing MQTT Paho Clients for Python</h2>
<p>Install the Python poackage for MQTT clients:</p>

<pre><code>pip3 install paho-mqtt</code></pre>

<p>Documentation for the Paho clients is here:</p>
<ul>
<li><a href="prep-iot-mqtt.html/#mqtt-clients-in-python">Preparation for this Unit</a></li>
<li><a href="https://pypi.org/project/paho-mqtt/">Paho MQTT on PyPi</a></li>
<li><a href="https://www.eclipse.org/paho/clients/python/docs/">Paho MQTT on Eclipse IoT</a></li>
</ul>

<p><strong>Tasks:</strong></p>
<ul>
<li>Install Paho MQTT on the Pi. This is a Python library for an MQTT client that can connect to the broker.</li>
<li><a href="https://pypi.python.org/pypi/paho-mqtt/">https://pypi.python.org/pypi/paho-mqtt/</a></li>
<li>Write a simple Python program that subscribes to a topic, and prints out whatever you sent as payload in your message.</li>
<li>Send something to the chosen topic from your laptop using MQTT.fx. Can you see the output in your Python program?</li>
<li>Write another simple Python program that publishes a message with some payload to a topic.</li>
<li>Subscribe with MQTT.fx on your laptop to that topic and check if you can receive the message sent via Python.</li>
</ul>
<p><strong>For the Report:</strong></p>
<ul>
<li>Include the (few) lines to publish a message and to subscribe to a topic, and document your work, also using some screenshots of MQTT.fx.</li>
</ul>

    </section>
    <section class="content">
<h1 id="back-to-the-sense-hat">Back to the Sense HAT</h1>
<p><strong>Goal:</strong> Create a program on the Sense HAT that uses the joystick and the LED. We will use this program later for some remote communication.</p>
<p><strong>Tips:</strong></p>
<ul>
<li>Have a look at the <a href="https://github.com/astro-pi/python-sense-hat/blob/master/examples/README.md">example programs</a></li>
<li>Run some of them, and try to understand how they work</li>
<li>Can you build a simple program that just moves a pixel on the LED matrix?</li>
</ul>

    </section>
    <section class="content">
<h1 id="remote-control-of-the-sense-hat">Remote Control of the Sense HAT</h1>
<p><strong>Goal:</strong> You can remotely control the moving Pixel of the Pi of another team with the joystick on your Pi, and the other team can control the pixel on your screen with their joystick.</p>
<p><strong>Tips:</strong></p>
<ul>
<li>Use different topics for up, down, left, right. (In this way, you can ignore any payload of the message.)</li>
<li>Use the joystick to send these commands as MQTT messages to different topics.</li>
<li>Let the pixel be controlled by subscribing to the corresponding topics.</li>
<li>Make first a version that runs with your MQTT broker, and which control your pixel with your joystick, simply by publishing and subscribing to the corresponding topics.</li>
<li>Use MQTT.fx for testing, either by sending messages that should move the pixel, or by checking that the joystick triggers the correct messages.</li>
<li>Agree with another team which topics to use. You can use a single MQTT broker, of either team</li>
</ul>

    </section>
    <section class="content">
<h1 id="final-steps">Final Steps</h1>
<h3 id="learning-goals">Learning Goals</h3>
<p>Reflect about what you learned today. Write a few sentences that capture (in your own words) what you learned and why it can be useful. Share these few sentences with everyone in the team. (You should use this text in the individual reflection below.)</p>

<h3 id="individual-reflection">Individual Reflection</h3>
<p>Fill out the <a href="https://forms.office.com/Pages/ResponsePage.aspx?id=cgahCS-CZ0SluluzdZZ8BSxiepoCd7lKk70IThBWqdJUQzJJUEVaQlBBMlFaSFBaTllITkcxRDEzNi4u" class="arrow">individual reflection survey</a>.</p>

<h3 id="cleaning-up">Cleaning Up</h3>

<div class="todo"><ul>
<li>Put all hardware back into the box.</li>
<li>Store the box in one of the lockers in the lab, using the combination lock.</li>
<li>Connect all parts of the PC back to it (keyboard, mouse, monitor).</li>
<li>Take out any trash. (Even if its not yours… thank you!)</li>
<li>Put the chairs back to the table.</li>
</ul>
<h3 id="individual-exercises">Individual Exercises</h3>
<p>We recommend that you take some time to consider if there are any parts of this unit that you want to repeat individually, at your own pace. If you decide to do so, you have several options:</p>
<ul>
<li>You have access to the hardware box at all times from the lockers. Just make sure everyone in your team knows where the box is, and put it back into the locker.</li>
<li>Install a Raspberry Pi Image on a Virtual Box in your PC. With this, you always have a Raspberry Pi with you.</li>
<li>Some of the Linux-related exercises also work on the Linux-PCs in the lab.</li>
</ul>
</div>
    </section>
</div>


<footer></footer>
<script>
    anchors.add('h1').add('h2').add('h3');
    anchors.options.visible = 'always';
</script>
</body>
</html>
